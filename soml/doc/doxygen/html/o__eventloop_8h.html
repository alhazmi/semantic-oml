<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>oml2: o_eventloop.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="oml_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">oml2
   &#160;<span id="projectnumber">2.12.0pre.79-58cf-dirty</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('o__eventloop_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">o_eventloop.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;time.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="o__socket_8h_source.html">ocomm/o_socket.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for o_eventloop.h:</div>
<div class="dyncontent">
<div class="center"><img src="o__eventloop_8h__incl.png" border="0" usemap="#o__eventloop_8h" alt=""/></div>
<map name="o__eventloop_8h" id="o__eventloop_8h">
<area shape="rect" id="node5" href="o__socket_8h.html" title="Header file for the OComm Socket library. OSockets are a thin abstraction layer that manages sockets ..." alt="" coords="116,83,249,112"/></map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="o__eventloop_8h__dep__incl.png" border="0" usemap="#o__eventloop_8hdep" alt=""/></div>
<map name="o__eventloop_8hdep" id="o__eventloop_8hdep">
<area shape="rect" id="node3" href="eventloop_8c.html" title="Callback&#45;based event loop supporting file descriptors, socket and timers." alt="" coords="225,83,313,112"/><area shape="rect" id="node5" href="socket_8c.html" title="OComm Socket (OSocket) are a thin abstraction layer that manages sockets and provides some additional..." alt="" coords="337,83,409,112"/><area shape="rect" id="node7" href="oml2-proxy-server_8c.html" title="Implement the proxy server&#39;s top&#45;level main() and its supporting functions." alt="" coords="5,160,141,189"/><area shape="rect" id="node9" href="proxy__client_8h.html" title="proxy_client.h" alt="" coords="484,83,585,112"/><area shape="rect" id="node22" href="client__handler_8c.html" title="The client handler receives callbacks from the eventloop and processes messages in either OML&#39;s text ..." alt="" coords="696,160,808,189"/><area shape="rect" id="node24" href="client__handler_8h.html" title="client_handler.h" alt="" coords="915,83,1027,112"/><area shape="rect" id="node27" href="oml2-server_8c.html" title="Main oml2&#45;server functions." alt="" coords="832,160,933,189"/><area shape="rect" id="node31" href="check__server_8h.html" title="check_server.h" alt="" coords="1059,160,1168,189"/><area shape="rect" id="node34" href="check__server_8c.html" title="check_server.c" alt="" coords="1201,237,1311,267"/><area shape="rect" id="node12" href="proxy__client_8c.html" title="Functions to manage the Client structure." alt="" coords="272,160,373,189"/><area shape="rect" id="node14" href="receiver_8c.html" title="Functions responsible for implementing the receive loop that reads stores meessages in the message qu..." alt="" coords="397,160,475,189"/><area shape="rect" id="node16" href="sender_8c.html" title="Implements half&#45;async sender which uses a background thread to send messages to the OML server..." alt="" coords="499,160,571,189"/><area shape="rect" id="node18" href="session_8c.html" title="Session management functions." alt="" coords="595,160,672,189"/><area shape="rect" id="node20" href="msgloop_8c.html" title="msgloop.c" alt="" coords="165,160,248,189"/><area shape="rect" id="node29" href="check__binary__protocol_8c.html" title="check_binary_protocol.c" alt="" coords="1015,237,1177,267"/><area shape="rect" id="node36" href="check__text__protocol_8c.html" title="check_text_protocol.c" alt="" coords="841,237,991,267"/></map>
</div>
</div>
<p><a href="o__eventloop_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__TimerEvtSource.html">_TimerEvtSource</a></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__sockEvtSource.html">_sockEvtSource</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a69ccb1d41842c4521908f2a87a1c4516"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__TimerEvtSource.html">_TimerEvtSource</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a69ccb1d41842c4521908f2a87a1c4516">TimerEvtSource</a></td></tr>
<tr class="memitem:ac2b8421423a2691d90489400dc948fb3"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct__sockEvtSource.html">_sockEvtSource</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a></td></tr>
<tr class="memitem:a579723a800874d33587042781a60af86"><td class="memItemLeft" align="right" valign="top">typedef enum <a class="el" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29">_SockStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a579723a800874d33587042781a60af86">SocketStatus</a></td></tr>
<tr class="memitem:a733f21784c10a082418e714bc49ff59d"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a733f21784c10a082418e714bc49ff59d">o_el_timer_callback</a> )(<a class="el" href="o__eventloop_8h.html#a69ccb1d41842c4521908f2a87a1c4516">TimerEvtSource</a> *source, void *handle)</td></tr>
<tr class="memitem:aa9d559820eb607fcd57861960cd6b244"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#aa9d559820eb607fcd57861960cd6b244">o_el_read_socket_callback</a> )(<a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *source, void *handle, void *buffer, int buf_size)</td></tr>
<tr class="memitem:a8c31a7c37ae71a853bcb1fd3de2cf21a"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a8c31a7c37ae71a853bcb1fd3de2cf21a">o_el_monitor_socket_callback</a> )(<a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *source, void *handle)</td></tr>
<tr class="memitem:a9de4addeab0021b31ea314fb4f0df6e7"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a> )(<a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *source, <a class="el" href="o__eventloop_8h.html#a579723a800874d33587042781a60af86">SocketStatus</a> status, int error, void *handle)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ad4b72d4e70e1ef536d14bf0543890a29"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29">_SockStatus</a> { <br/>
&#160;&#160;<a class="el" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29a43ab64a7bd7e3173e5f65203d28f1c93">SOCKET_UNKNOWN</a> =  -1, 
<a class="el" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29a6dad79a3e1614d8a599fe02701689299">SOCKET_WRITEABLE</a>, 
<a class="el" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29adc51a996c8067046c7bb75ff6591dc74">SOCKET_CONN_CLOSED</a>, 
<a class="el" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29add457ce25f1904fe8dd9fae79657c58f">SOCKET_CONN_REFUSED</a>, 
<br/>
&#160;&#160;<a class="el" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29a704eefbe39ac96f64426944661b2a626">SOCKET_DROPPED</a>, 
<a class="el" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29aa78a3802f09a9c7a0361f52fc743c038">SOCKET_IDLE</a>
<br/>
 }</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3a481ec84bd7470fc132207e78f58329"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a3a481ec84bd7470fc132207e78f58329">socket_status_string</a> (<a class="el" href="o__eventloop_8h.html#a579723a800874d33587042781a60af86">SocketStatus</a> status)</td></tr>
<tr class="memitem:a61363e92c10f69d4e3839d2ae38b5e9e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a61363e92c10f69d4e3839d2ae38b5e9e">eventloop_init</a> (void)</td></tr>
<tr class="memitem:a60c04e3ab6cdc2f705115ab382dc47c9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a60c04e3ab6cdc2f705115ab382dc47c9">eventloop_set_socket_timeout</a> (unsigned int to)</td></tr>
<tr class="memitem:a560818d86a02ed2ba93715aa3a13466e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a560818d86a02ed2ba93715aa3a13466e">eventloop_run</a> (void)</td></tr>
<tr class="memitem:a8b8ce3652087cc77534f7e4b6a346435"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a8b8ce3652087cc77534f7e4b6a346435">eventloop_stop</a> (int reason)</td></tr>
<tr class="memitem:a9905b32a4a5d3a24c90f44ecb5e0e459"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a9905b32a4a5d3a24c90f44ecb5e0e459">eventloop_terminate</a> (int reason)</td></tr>
<tr class="memitem:a833ccf1602c1aceb3212b4803d1ba4e0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a833ccf1602c1aceb3212b4803d1ba4e0">eventloop_report</a> (int loglevel)</td></tr>
<tr class="memitem:af83b5f2beb881a21ef75171d072ff7f8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="o__eventloop_8h.html#a69ccb1d41842c4521908f2a87a1c4516">TimerEvtSource</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#af83b5f2beb881a21ef75171d072ff7f8">eventloop_every</a> (char *<a class="el" href="check__text__protocol_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, int period, <a class="el" href="o__eventloop_8h.html#a733f21784c10a082418e714bc49ff59d">o_el_timer_callback</a> callback, void *handle)</td></tr>
<tr class="memitem:a1dcf3cfdfad5652d9b323f41edb5d491"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a1dcf3cfdfad5652d9b323f41edb5d491">eventloop_timer_stop</a> (<a class="el" href="o__eventloop_8h.html#a69ccb1d41842c4521908f2a87a1c4516">TimerEvtSource</a> *timer)</td></tr>
<tr class="memitem:a7976bcaf2ec18816b4ecf3d13509e1a3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a7976bcaf2ec18816b4ecf3d13509e1a3">eventloop_on_stdin</a> (<a class="el" href="o__eventloop_8h.html#aa9d559820eb607fcd57861960cd6b244">o_el_read_socket_callback</a> callback, void *handle)</td></tr>
<tr class="memitem:a157aac6cff6a7846642262957a7b7b92"><td class="memItemLeft" align="right" valign="top"><a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a157aac6cff6a7846642262957a7b7b92">eventloop_on_monitor_in_channel</a> (<a class="el" href="structSocket.html">Socket</a> *socket, <a class="el" href="o__eventloop_8h.html#a8c31a7c37ae71a853bcb1fd3de2cf21a">o_el_monitor_socket_callback</a> monitor_cbk, <a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a> status_cbk, void *handle)</td></tr>
<tr class="memitem:a38c2768f989f1c537db87db9d2fee016"><td class="memItemLeft" align="right" valign="top"><a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a38c2768f989f1c537db87db9d2fee016">eventloop_on_read_in_channel</a> (<a class="el" href="structSocket.html">Socket</a> *socket, <a class="el" href="o__eventloop_8h.html#aa9d559820eb607fcd57861960cd6b244">o_el_read_socket_callback</a> data_cbk, <a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a> status_cbk, void *handle)</td></tr>
<tr class="memitem:ad867a2d07ee0caff7cff417c495a39b4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#ad867a2d07ee0caff7cff417c495a39b4">eventloop_on_out_channel</a> (<a class="el" href="structSocket.html">Socket</a> *socket, <a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a> status_cbk, void *handle)</td></tr>
<tr class="memitem:a99ee2a1e2528b25fe3ccde5f6d475a06"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a99ee2a1e2528b25fe3ccde5f6d475a06">eventloop_socket_activate</a> (<a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *source, int flag)</td></tr>
<tr class="memitem:ac5492e61cfa3174503923e3ed541a3a1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#ac5492e61cfa3174503923e3ed541a3a1">eventloop_socket_release</a> (<a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *source)</td></tr>
<tr class="memitem:a5a3644a8f05609def4e6c259ebc4d68b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="o__eventloop_8h.html#a5a3644a8f05609def4e6c259ebc4d68b">eventloop_socket_remove</a> (<a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *source)</td></tr>
</table>
<h2>Typedef Documentation</h2>
<a class="anchor" id="a8c31a7c37ae71a853bcb1fd3de2cf21a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* o_el_monitor_socket_callback)(<a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *source, void *handle)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Monitoring callback prototype for sockets.</p>
<p>This callback is a fallback when no data-read callback. Listening sockets, for example, do not need to read any data, but need to be warned of incoming connections. This is the role of this callback.</p>
<p>XXX: Couldn't this be wrapped to a default read callback?</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>SockEvtSource from which the event originated </td></tr>
    <tr><td class="paramname">handle</td><td>pointer to application-supplied data </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="o__eventloop_8h_source.html#l00129">129</a> of file <a class="el" href="o__eventloop_8h_source.html">o_eventloop.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa9d559820eb607fcd57861960cd6b244"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* o_el_read_socket_callback)(<a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *source, void *handle, void *buffer, int buf_size)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Data-read callback prototype for sockets.</p>
<p>The EventLoop takes care of recv(2)ing data from a socket ready to be read, then passes this data to this callback.</p>
<p>Called on POLLIN, and POLLHUP before o_el_state_socket_callback if some data remains to be read.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>SockEvtSource from which the event originated </td></tr>
    <tr><td class="paramname">handle</td><td>pointer to application-supplied data </td></tr>
    <tr><td class="paramname">buffer</td><td>pointer to a buffer containing the read data </td></tr>
    <tr><td class="paramname">buf_size</td><td>size of data in buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a> </dd>
<dd>
poll(3) </dd></dl>

<p>Definition at line <a class="el" href="o__eventloop_8h_source.html#l00116">116</a> of file <a class="el" href="o__eventloop_8h_source.html">o_eventloop.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9de4addeab0021b31ea314fb4f0df6e7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* o_el_state_socket_callback)(<a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *source, <a class="el" href="o__eventloop_8h.html#a579723a800874d33587042781a60af86">SocketStatus</a> status, int error, void *handle)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>State-changes callback prototype for sockets.</p>
<p>If defined, this callback should release and free both application data, pointed by handle, and the socket, in source-&gt;socket, on termination conditions.</p>
<p>By default (no callback), source-&gt;socket is closed on SOCKET_CONN_CLOSED, SOCKET_CONN_REFUSED, SOCKET_DROPPED and SOCKET_IDLE.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>SockEvtSource from which the event originated </td></tr>
    <tr><td class="paramname">status</td><td>SocketStatus new status for the socket </td></tr>
    <tr><td class="paramname">error</td><td>errno related to that status </td></tr>
    <tr><td class="paramname">handle</td><td>pointer to application-supplied data</td></tr>
  </table>
  </dd>
</dl>
<p>XXX: This prototype is not very regular, with status and error appearing before handle, unlike, e.g., o_el_read_socket_callback.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="o__eventloop_8h.html#a579723a800874d33587042781a60af86">SocketStatus</a>, <a class="el" href="o__eventloop_8h.html#aa9d559820eb607fcd57861960cd6b244">o_el_read_socket_callback</a> </dd>
<dd>
errno(3) </dd></dl>

<p>Definition at line <a class="el" href="o__eventloop_8h_source.html#l00151">151</a> of file <a class="el" href="o__eventloop_8h_source.html">o_eventloop.h</a>.</p>

</div>
</div>
<a class="anchor" id="a733f21784c10a082418e714bc49ff59d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* o_el_timer_callback)(<a class="el" href="o__eventloop_8h.html#a69ccb1d41842c4521908f2a87a1c4516">TimerEvtSource</a> *source, void *handle)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Timout callback prototype for timers.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>TimerEvtSource which expired </td></tr>
    <tr><td class="paramname">handle</td><td>pointer to application-supplied data </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="o__eventloop_8h_source.html#l00097">97</a> of file <a class="el" href="o__eventloop_8h_source.html">o_eventloop.h</a>.</p>

</div>
</div>
<a class="anchor" id="a579723a800874d33587042781a60af86"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef enum <a class="el" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29">_SockStatus</a>  <a class="el" href="o__eventloop_8h.html#a579723a800874d33587042781a60af86">SocketStatus</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Possible socket statuses after state change.</p>
<p>Depends on poll(3) revents and additional condition during further processing (e.g., read from FD).</p>
<p>XXX: Make sure to update socket_status_string when adding values here.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a>, <a class="el" href="o__eventloop_8h.html#a3a481ec84bd7470fc132207e78f58329">socket_status_string</a> </dd>
<dd>
poll(3) </dd></dl>

</div>
</div>
<a class="anchor" id="ac2b8421423a2691d90489400dc948fb3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__sockEvtSource.html">_sockEvtSource</a>  <a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Socket-based event source base class for the EventLoop. </p>

</div>
</div>
<a class="anchor" id="a69ccb1d41842c4521908f2a87a1c4516"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__TimerEvtSource.html">_TimerEvtSource</a>  <a class="el" href="o__eventloop_8h.html#a69ccb1d41842c4521908f2a87a1c4516">TimerEvtSource</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Prototypes and interfaces for the OComm EventLoop </p>
<dl class="section author"><dt>Author</dt><dd>Max Ott (<a href="#" onclick="location.href='mai'+'lto:'+'max'+'@w'+'inl'+'ab'+'.ru'+'tg'+'ers'+'.e'+'du'; return false;">max@w<span style="display: none;">.nosp@m.</span>inla<span style="display: none;">.nosp@m.</span>b.rut<span style="display: none;">.nosp@m.</span>gers<span style="display: none;">.nosp@m.</span>.edu</a>)</dd></dl>
<p>XXX: Names 'SockEvtSource' and 'Channel' would make more sense it they were swapped, or something like 'ChannelEvtSource' and 'ChannelInt', to match the Timer*'s regularity. Also, note SockEvtSources and Channels are used for STDIN.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="o__eventloop_8h.html#a61363e92c10f69d4e3839d2ae38b5e9e">eventloop_init</a>, <a class="el" href="o__eventloop_8h.html#a560818d86a02ed2ba93715aa3a13466e">eventloop_run</a>, <a class="el" href="o__eventloop_8h.html#a8b8ce3652087cc77534f7e4b6a346435">eventloop_stop</a> , <a class="el" href="o__eventloop_8h.html#a157aac6cff6a7846642262957a7b7b92">eventloop_on_monitor_in_channel</a>, <a class="el" href="o__eventloop_8h.html#a38c2768f989f1c537db87db9d2fee016">eventloop_on_read_in_channel</a>, <a class="el" href="o__eventloop_8h.html#ad867a2d07ee0caff7cff417c495a39b4">eventloop_on_out_channel</a> </dd>
<dd>
<a class="el" href="o__eventloop_8h.html#a733f21784c10a082418e714bc49ff59d">o_el_timer_callback</a>, <a class="el" href="o__eventloop_8h.html#aa9d559820eb607fcd57861960cd6b244">o_el_read_socket_callback</a>, <a class="el" href="o__eventloop_8h.html#a8c31a7c37ae71a853bcb1fd3de2cf21a">o_el_monitor_socket_callback</a>, <a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a>, <a class="el" href="o__eventloop_8h.html#a733f21784c10a082418e714bc49ff59d">o_el_timer_callback</a> </dd>
<dd>
poll(3)Timer-based event source base class for the <a class="el" href="eventloop_8c.html#a6a91dd940f3a6821090956426ecfc39c">EventLoop</a>. </dd></dl>

</div>
</div>
<h2>Enumeration Type Documentation</h2>
<a class="anchor" id="ad4b72d4e70e1ef536d14bf0543890a29"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29">_SockStatus</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Possible socket statuses after state change.</p>
<p>Depends on poll(3) revents and additional condition during further processing (e.g., read from FD).</p>
<p>XXX: Make sure to update socket_status_string when adding values here.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a>, <a class="el" href="o__eventloop_8h.html#a3a481ec84bd7470fc132207e78f58329">socket_status_string</a> </dd>
<dd>
poll(3) </dd></dl>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ad4b72d4e70e1ef536d14bf0543890a29a43ab64a7bd7e3173e5f65203d28f1c93"></a>SOCKET_UNKNOWN</em>&nbsp;</td><td>
<p>Unknown POLLERR </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad4b72d4e70e1ef536d14bf0543890a29a6dad79a3e1614d8a599fe02701689299"></a>SOCKET_WRITEABLE</em>&nbsp;</td><td>
<p>POLLOUT </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad4b72d4e70e1ef536d14bf0543890a29adc51a996c8067046c7bb75ff6591dc74"></a>SOCKET_CONN_CLOSED</em>&nbsp;</td><td>
<p>POLLHUP or POLLIN and no data read (for sockets only) </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad4b72d4e70e1ef536d14bf0543890a29add457ce25f1904fe8dd9fae79657c58f"></a>SOCKET_CONN_REFUSED</em>&nbsp;</td><td>
<p>If relevant on POLLERR </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad4b72d4e70e1ef536d14bf0543890a29a704eefbe39ac96f64426944661b2a626"></a>SOCKET_DROPPED</em>&nbsp;</td><td>
<p>POLLNVAL </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad4b72d4e70e1ef536d14bf0543890a29aa78a3802f09a9c7a0361f52fc743c038"></a>SOCKET_IDLE</em>&nbsp;</td><td>
<p>No data was receveid for more than DEF_SOCKET_TIMEOUT s </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="o__eventloop_8h_source.html#l00075">75</a> of file <a class="el" href="o__eventloop_8h_source.html">o_eventloop.h</a>.</p>
<div class="fragment"><div class="line">                         {</div>
<div class="line">  <a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29a43ab64a7bd7e3173e5f65203d28f1c93">SOCKET_UNKNOWN</a> = -1,</div>
<div class="line">  <a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29a6dad79a3e1614d8a599fe02701689299">SOCKET_WRITEABLE</a>,</div>
<div class="line">  <a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29adc51a996c8067046c7bb75ff6591dc74">SOCKET_CONN_CLOSED</a>,</div>
<div class="line">  <a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29add457ce25f1904fe8dd9fae79657c58f">SOCKET_CONN_REFUSED</a>,</div>
<div class="line">  <a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29a704eefbe39ac96f64426944661b2a626">SOCKET_DROPPED</a>,</div>
<div class="line">  <a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29aa78a3802f09a9c7a0361f52fc743c038">SOCKET_IDLE</a>,</div>
<div class="line">} <a class="code" href="o__eventloop_8h.html#a579723a800874d33587042781a60af86">SocketStatus</a>;</div>
</div><!-- fragment -->
</div>
</div>
<h2>Function Documentation</h2>
<a class="anchor" id="af83b5f2beb881a21ef75171d072ff7f8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="o__eventloop_8h.html#a69ccb1d41842c4521908f2a87a1c4516">TimerEvtSource</a>* eventloop_every </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>period</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="o__eventloop_8h.html#a733f21784c10a082418e714bc49ff59d">o_el_timer_callback</a>&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>handle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register a new periodic timer to the event loop</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>name of this object, used for debugging </td></tr>
    <tr><td class="paramname">period</td><td>period [s] of the timer </td></tr>
    <tr><td class="paramname">timer_cbk</td><td>function called when the state of the timer expires </td></tr>
    <tr><td class="paramname">handle</td><td>pointer to opaque data passed to callback functions </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to the newly-created TimerInt, cast as a TimerEvtSource</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="o__eventloop_8h.html#a733f21784c10a082418e714bc49ff59d">o_el_timer_callback</a>, <a class="el" href="o__eventloop_8h.html#a1dcf3cfdfad5652d9b323f41edb5d491">eventloop_timer_stop</a> </dd></dl>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00490">490</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="eventloop_8c_source.html#l00081">_timerInt::callback</a>, <a class="el" href="eventloop_8c_source.html#l00078">_timerInt::due_time</a>, <a class="el" href="eventloop_8c_source.html#l00084">_timerInt::handle</a>, <a class="el" href="eventloop_8c_source.html#l00069">_timerInt::is_active</a>, <a class="el" href="eventloop_8c_source.html#l00072">_timerInt::is_periodic</a>, <a class="el" href="eventloop_8c_source.html#l00065">_timerInt::name</a>, <a class="el" href="eventloop_8c_source.html#l00090">_timerInt::nameBuf</a>, <a class="el" href="eventloop_8c_source.html#l00087">_timerInt::next</a>, <a class="el" href="mem_8c_source.html#l00157">oml_malloc()</a>, and <a class="el" href="eventloop_8c_source.html#l00075">_timerInt::period</a>.</p>
<div class="fragment"><div class="line">  {</div>
<div class="line">  <a class="code" href="struct__timerInt.html">TimerInt</a>* t = (<a class="code" href="struct__timerInt.html">TimerInt</a>*)<a class="code" href="omlc_8h.html#a8616cb714d6589098267bba8fc7b48c2">oml_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="struct__timerInt.html">TimerInt</a>));</div>
<div class="line">  memset(t, 0, <span class="keyword">sizeof</span>(<a class="code" href="struct__timerInt.html">TimerInt</a>));</div>
<div class="line"></div>
<div class="line">  t-&gt;<a class="code" href="struct__timerInt.html#a09a1e2b4be0326c5783dcfe8e538aed4">name</a> = t-&gt;<a class="code" href="struct__timerInt.html#aa4d05b61463c0f24b875cfe8b2ffec55">nameBuf</a>;</div>
<div class="line">  strcpy(t-&gt;<a class="code" href="struct__timerInt.html#a09a1e2b4be0326c5783dcfe8e538aed4">name</a>, <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"></div>
<div class="line">  t-&gt;<a class="code" href="struct__timerInt.html#a65afeba6d9c83fb3b1e38e6235e74040">is_active</a> = 1;</div>
<div class="line">  t-&gt;<a class="code" href="struct__timerInt.html#a5841f7dcbe9406391fe13f96de033c0a">is_periodic</a> = 1;</div>
<div class="line">  t-&gt;<a class="code" href="struct__timerInt.html#a19c5e56df49cc945bbe3aab19b20ad80">period</a> = period;</div>
<div class="line">  t-&gt;<a class="code" href="struct__timerInt.html#ac7e641ad31a71346cb8ef0d7996b0dd3">due_time</a> = time(NULL) + period;</div>
<div class="line">  t-&gt;<a class="code" href="struct__timerInt.html#a6fa48cae2749192e45eddc6d9dc17c59">callback</a> = callback;</div>
<div class="line">  t-&gt;<a class="code" href="struct__timerInt.html#ae1a42cfe36e6842a46215365e6672860">handle</a> = handle;</div>
<div class="line"></div>
<div class="line">  t-&gt;<a class="code" href="struct__timerInt.html#ad7d02f335c9fa6a0cba9750bf4797856">next</a> = <span class="keyword">self</span>.timers;</div>
<div class="line">  <span class="keyword">self</span>.timers = t;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> (<a class="code" href="struct__TimerEvtSource.html">TimerEvtSource</a>*)t;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a61363e92c10f69d4e3839d2ae38b5e9e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void eventloop_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialise the global EventLoop </p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="o__eventloop_8h.html#a560818d86a02ed2ba93715aa3a13466e">eventloop_run</a>, <a class="el" href="o__eventloop_8h.html#a8b8ce3652087cc77534f7e4b6a346435">eventloop_stop</a>, <a class="el" href="o__eventloop_8h.html#a9905b32a4a5d3a24c90f44ecb5e0e459">eventloop_terminate</a> </dd></dl>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00210">210</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="eventloop_8c_source.html#l00041">DEF_SOCKET_TIMEOUT</a>, and <a class="el" href="eventloop_8c_source.html#l00231">eventloop_set_socket_timeout()</a>.</p>

<p>Referenced by <a class="el" href="oml2-proxy-server_8c_source.html#l00307">main()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  memset(&amp;<span class="keyword">self</span>, 0, <span class="keyword">sizeof</span>(<a class="code" href="struct__eventLoop.html">EventLoop</a>));</div>
<div class="line"></div>
<div class="line">  <span class="keyword">self</span>.fds = NULL;</div>
<div class="line">  <span class="keyword">self</span>.channels = NULL;</div>
<div class="line">  <span class="keyword">self</span>.timers = NULL;</div>
<div class="line"></div>
<div class="line">  <span class="keyword">self</span>.size = 0;</div>
<div class="line">  <span class="keyword">self</span>.length = 0;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="eventloop_8c.html#a60c04e3ab6cdc2f705115ab382dc47c9">eventloop_set_socket_timeout</a>(<a class="code" href="eventloop_8c.html#a1535d7e6a619efc9844f10e653c2c9cd">DEF_SOCKET_TIMEOUT</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Just to be sure we initialise everything */</span></div>
<div class="line">  <span class="keyword">self</span>.start = <span class="keyword">self</span>.now = <span class="keyword">self</span>.last_reaped = -1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a157aac6cff6a7846642262957a7b7b92"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a>* eventloop_on_monitor_in_channel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSocket.html">Socket</a> *&#160;</td>
          <td class="paramname"><em>socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="o__eventloop_8h.html#a8c31a7c37ae71a853bcb1fd3de2cf21a">o_el_monitor_socket_callback</a>&#160;</td>
          <td class="paramname"><em>monitor_cbk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a>&#160;</td>
          <td class="paramname"><em>status_cbk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>handle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register a <a class="el" href="structSocket.html">Socket</a> as a new channel to monitor (e.g., listening socket).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">socket</td><td>OComm <a class="el" href="structSocket.html">Socket</a> </td></tr>
    <tr><td class="paramname">monitor_cbk</td><td>monitoring callback called when a new event arrives, can be NULL </td></tr>
    <tr><td class="paramname">status_cbk</td><td>status-change callback, can be NULL </td></tr>
    <tr><td class="paramname">handle</td><td>pointer to opaque data passed to callback functions </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to a new Channel cast as a SockEvtSource</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="structSocket.html">Socket</a>, <a class="el" href="o__eventloop_8h.html#a8c31a7c37ae71a853bcb1fd3de2cf21a">o_el_monitor_socket_callback</a>, <a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a> </dd></dl>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00620">620</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="o__socket_8h_source.html#l00048">Socket::get_sockfd</a>, <a class="el" href="o__socket_8h_source.html#l00045">Socket::name</a>, <a class="el" href="log_8c_source.html#l00048">o_log</a>, <a class="el" href="o__log_8h_source.html#l00023">O_LOG_ERROR</a>, and <a class="el" href="eventloop_8c_source.html#l00102">_channel::socket</a>.</p>

<p>Referenced by <a class="el" href="socket_8c_source.html#l00464">socket_server_new()</a>.</p>
<div class="fragment"><div class="line">  {</div>
<div class="line">  <span class="keywordflow">if</span> (socket == NULL) {</div>
<div class="line">    <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a5ea1f1d02dfda13b474ec771f7bd1a3a">O_LOG_ERROR</a>, <span class="stringliteral">&quot;EventLoop: Missing socket\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="struct__channel.html">Channel</a>* ch;</div>
<div class="line">  ch = eventloop_on_in_fd(socket-&gt;<a class="code" href="structSocket.html#a0777b306460511cf44c7ff0935e14348">name</a>, socket-&gt;<a class="code" href="structSocket.html#aee00150dbd6ba7bbd639f4171b954dc3">get_sockfd</a>(socket),</div>
<div class="line">              NULL, monitor_cbk, status_cbk, handle);</div>
<div class="line">  ch-&gt;<a class="code" href="struct__channel.html#ae73bf1decca1085202d452c579c9a709">socket</a> = socket;</div>
<div class="line">  <span class="keywordflow">return</span> (<a class="code" href="struct__sockEvtSource.html">SockEvtSource</a>*)ch;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad867a2d07ee0caff7cff417c495a39b4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a>* eventloop_on_out_channel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSocket.html">Socket</a> *&#160;</td>
          <td class="paramname"><em>socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a>&#160;</td>
          <td class="paramname"><em>status_cbk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>handle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register a <a class="el" href="structSocket.html">Socket</a> as a new output channel.</p>
<p>In essence, this only registers status-change callback to allow reception of a SOCKET_WRITEABLE SocketStatus.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">socket</td><td>OComm <a class="el" href="structSocket.html">Socket</a> </td></tr>
    <tr><td class="paramname">status_cbk</td><td>status-change callback, can be NULL </td></tr>
    <tr><td class="paramname">handle</td><td>pointer to opaque data passed to callback functions </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to a new Channel cast as a SockEvtSource</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="structSocket.html">Socket</a>, <a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a>, <a class="el" href="o__eventloop_8h.html#a579723a800874d33587042781a60af86">SocketStatus</a> </dd></dl>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00649">649</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="o__socket_8h_source.html#l00048">Socket::get_sockfd</a>, <a class="el" href="o__socket_8h_source.html#l00045">Socket::name</a>, <a class="el" href="log_8c_source.html#l00048">o_log</a>, <a class="el" href="o__log_8h_source.html#l00023">O_LOG_ERROR</a>, and <a class="el" href="eventloop_8c_source.html#l00102">_channel::socket</a>.</p>
<div class="fragment"><div class="line">  {</div>
<div class="line">  <span class="keywordflow">if</span> (socket == NULL) {</div>
<div class="line">    <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a5ea1f1d02dfda13b474ec771f7bd1a3a">O_LOG_ERROR</a>, <span class="stringliteral">&quot;EventLoop: Missing socket\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="struct__channel.html">Channel</a>* ch;</div>
<div class="line">  ch = eventloop_on_out_fd(socket-&gt;<a class="code" href="structSocket.html#a0777b306460511cf44c7ff0935e14348">name</a>, socket-&gt;<a class="code" href="structSocket.html#aee00150dbd6ba7bbd639f4171b954dc3">get_sockfd</a>(socket),</div>
<div class="line">              status_cbk, handle);</div>
<div class="line">  ch-&gt;<a class="code" href="struct__channel.html#ae73bf1decca1085202d452c579c9a709">socket</a> = socket;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> (<a class="code" href="struct__sockEvtSource.html">SockEvtSource</a>*)ch;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a38c2768f989f1c537db87db9d2fee016"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a>* eventloop_on_read_in_channel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSocket.html">Socket</a> *&#160;</td>
          <td class="paramname"><em>socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="o__eventloop_8h.html#aa9d559820eb607fcd57861960cd6b244">o_el_read_socket_callback</a>&#160;</td>
          <td class="paramname"><em>data_cbk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a>&#160;</td>
          <td class="paramname"><em>status_cbk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>handle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register a <a class="el" href="structSocket.html">Socket</a> as a new input channel to read data from.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">socket</td><td>OComm <a class="el" href="structSocket.html">Socket</a> </td></tr>
    <tr><td class="paramname">data_cbk</td><td>read callback called with freshly-read data, can be NULL </td></tr>
    <tr><td class="paramname">status_cbk</td><td>status-change callback, can be NULL </td></tr>
    <tr><td class="paramname">handle</td><td>pointer to opaque data passed to callback functions </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to a new Channel cast as a SockEvtSource</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="structSocket.html">Socket</a>, <a class="el" href="o__eventloop_8h.html#aa9d559820eb607fcd57861960cd6b244">o_el_read_socket_callback</a>, <a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a> </dd></dl>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00592">592</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="o__socket_8h_source.html#l00048">Socket::get_sockfd</a>, <a class="el" href="eventloop_8c_source.html#l00142">_channel::last_activity</a>, <a class="el" href="o__socket_8h_source.html#l00045">Socket::name</a>, <a class="el" href="log_8c_source.html#l00048">o_log</a>, <a class="el" href="o__log_8h_source.html#l00023">O_LOG_ERROR</a>, and <a class="el" href="eventloop_8c_source.html#l00102">_channel::socket</a>.</p>

<p>Referenced by <a class="el" href="client__handler_8c_source.html#l00206">client_handler_new()</a>, <a class="el" href="oml2-proxy-server_8c_source.html#l00143">on_connect()</a>, and <a class="el" href="oml2-proxy-server_8c_source.html#l00261">on_control_connect()</a>.</p>
<div class="fragment"><div class="line">  {</div>
<div class="line">  <span class="keywordflow">if</span> (socket == NULL) {</div>
<div class="line">    <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a5ea1f1d02dfda13b474ec771f7bd1a3a">O_LOG_ERROR</a>, <span class="stringliteral">&quot;EventLoop: Missing socket\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="struct__channel.html">Channel</a>* ch;</div>
<div class="line">  ch = eventloop_on_in_fd(socket-&gt;<a class="code" href="structSocket.html#a0777b306460511cf44c7ff0935e14348">name</a>, socket-&gt;<a class="code" href="structSocket.html#aee00150dbd6ba7bbd639f4171b954dc3">get_sockfd</a>(socket),</div>
<div class="line">              data_cbk, NULL, status_cbk, handle);</div>
<div class="line">  ch-&gt;<a class="code" href="struct__channel.html#ae73bf1decca1085202d452c579c9a709">socket</a> = socket;</div>
<div class="line">  ch-&gt;<a class="code" href="struct__channel.html#a7e0c9f5f0588df9326338e58293b305a">last_activity</a> = <span class="keyword">self</span>.now;</div>
<div class="line">  <span class="keywordflow">return</span> (<a class="code" href="struct__sockEvtSource.html">SockEvtSource</a>*)ch;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7976bcaf2ec18816b4ecf3d13509e1a3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a>* eventloop_on_stdin </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="o__eventloop_8h.html#aa9d559820eb607fcd57861960cd6b244">o_el_read_socket_callback</a>&#160;</td>
          <td class="paramname"><em>read_cbk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>handle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register STDIN as a new input channel to read data from.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data_cbk</td><td>read callback called with freshly-read data, can be NULL </td></tr>
    <tr><td class="paramname">status_cbk</td><td>status-change callback, can be NULL </td></tr>
    <tr><td class="paramname">handle</td><td>pointer to opaque data passed to callback functions </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to a new Channel cast as a SockEvtSource</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="o__eventloop_8h.html#aa9d559820eb607fcd57861960cd6b244">o_el_read_socket_callback</a>, <a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a> </dd></dl>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00570">570</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>Referenced by <a class="el" href="oml2-proxy-server_8c_source.html#l00307">main()</a>.</p>
<div class="fragment"><div class="line">  {</div>
<div class="line">  <span class="keywordtype">char</span>* s = <span class="stringliteral">&quot;stdin&quot;</span>;</div>
<div class="line">  <a class="code" href="struct__channel.html">Channel</a>* ch;</div>
<div class="line"></div>
<div class="line">  ch = eventloop_on_in_fd(s, 0, read_cbk, NULL, NULL, handle);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> (<a class="code" href="struct__sockEvtSource.html">SockEvtSource</a>*)ch;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a833ccf1602c1aceb3212b4803d1ba4e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void eventloop_report </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>loglevel</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Log a summary of resource usage.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">loglevel</td><td>log level at which the message should be issued </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="mem_8h.html#ab1907374ac905e4f7b6f05bb9eb16ca8">oml_memsummary</a> </dd></dl>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00473">473</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="log_8c_source.html#l00048">o_log</a>, and <a class="el" href="mem_8c_source.html#l00121">oml_memsummary()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(loglevel, <span class="stringliteral">&quot;EventLoop: Open file descriptors: %d/%d\n&quot;</span>, <span class="keyword">self</span>.size, <span class="keyword">self</span>.<a class="code" href="structoml__message.html#a2ec2e3b0ab3f3fff27bbcc78a795c01a">length</a>);</div>
<div class="line">  <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(loglevel, <span class="stringliteral">&quot;EventLoop: Memory usage: %s\n&quot;</span>, <a class="code" href="mem_8c.html#ab1907374ac905e4f7b6f05bb9eb16ca8">oml_memsummary</a>());</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a560818d86a02ed2ba93715aa3a13466e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int eventloop_run </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Run the global EventLoop until <a class="el" href="eventloop_8c.html#a8b8ce3652087cc77534f7e4b6a346435">eventloop_stop()</a> or <a class="el" href="eventloop_8c.html#a9905b32a4a5d3a24c90f44ecb5e0e459">eventloop_terminate()</a> is called.</p>
<p>The loop is based around the poll(3) system call. It monitor event sources such as Channel or Timers, registered in the respective fields of the global EventLoop object self. It first consider all timers to find whether some have expired and to set the timeout for the poll(3) call. It then calls poll(3) on the file descriptors (STDIN or sockets) related to active Channels, and runs the relevant callbacks for those with pending events. It finally executes the callback functions of the expired timers. The loop will not return until <a class="el" href="eventloop_8c.html#a8b8ce3652087cc77534f7e4b6a346435">eventloop_stop()</a> or <a class="el" href="eventloop_8c.html#a9905b32a4a5d3a24c90f44ecb5e0e459">eventloop_terminate()</a> is called. In the former case, it will try to wait until all active sockets are close, while not in the latter.</p>
<dl class="section return"><dt>Returns</dt><dd>the (non-zero) value passed to <a class="el" href="eventloop_8c.html#a8b8ce3652087cc77534f7e4b6a346435">eventloop_stop()</a> or <a class="el" href="eventloop_8c.html#a9905b32a4a5d3a24c90f44ecb5e0e459">eventloop_terminate()</a></dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="o__eventloop_8h.html#a61363e92c10f69d4e3839d2ae38b5e9e">eventloop_init</a>, <a class="el" href="o__eventloop_8h.html#a8b8ce3652087cc77534f7e4b6a346435">eventloop_stop</a>, <a class="el" href="o__eventloop_8h.html#a9905b32a4a5d3a24c90f44ecb5e0e459">eventloop_terminate</a> , <a class="el" href="o__eventloop_8h.html#a157aac6cff6a7846642262957a7b7b92">eventloop_on_monitor_in_channel</a>, <a class="el" href="o__eventloop_8h.html#a38c2768f989f1c537db87db9d2fee016">eventloop_on_read_in_channel</a>, <a class="el" href="o__eventloop_8h.html#ad867a2d07ee0caff7cff417c495a39b4">eventloop_on_out_channel</a> </dd>
<dd>
<a class="el" href="o__eventloop_8h.html#a733f21784c10a082418e714bc49ff59d">o_el_timer_callback</a>, <a class="el" href="o__eventloop_8h.html#aa9d559820eb607fcd57861960cd6b244">o_el_read_socket_callback</a>, <a class="el" href="o__eventloop_8h.html#a8c31a7c37ae71a853bcb1fd3de2cf21a">o_el_monitor_socket_callback</a>, <a class="el" href="o__eventloop_8h.html#a9de4addeab0021b31ea314fb4f0df6e7">o_el_state_socket_callback</a>, <a class="el" href="o__eventloop_8h.html#a733f21784c10a082418e714bc49ff59d">o_el_timer_callback</a> </dd>
<dd>
poll(3) </dd></dl>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00257">257</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="eventloop_8c_source.html#l00081">_timerInt::callback</a>, <a class="el" href="stddev__0_8c_source.html#l00021">count</a>, <a class="el" href="eventloop_8c_source.html#l00078">_timerInt::due_time</a>, <a class="el" href="eventloop_8c_source.html#l00675">eventloop_socket_activate()</a>, <a class="el" href="eventloop_8c_source.html#l00698">eventloop_socket_release()</a>, <a class="el" href="eventloop_8c_source.html#l00714">eventloop_socket_remove()</a>, <a class="el" href="eventloop_8c_source.html#l00084">_timerInt::handle</a>, <a class="el" href="eventloop_8c_source.html#l00069">_timerInt::is_active</a>, <a class="el" href="eventloop_8c_source.html#l00072">_timerInt::is_periodic</a>, <a class="el" href="eventloop_8c_source.html#l00115">_channel::is_removable</a>, <a class="el" href="eventloop_8c_source.html#l00111">_channel::is_shutting_down</a>, <a class="el" href="eventloop_8c_source.html#l00142">_channel::last_activity</a>, <a class="el" href="eventloop_8c_source.html#l00038">MAX_READ_BUFFER_SIZE</a>, <a class="el" href="eventloop_8c_source.html#l00065">_timerInt::name</a>, <a class="el" href="eventloop_8c_source.html#l00100">_channel::name</a>, <a class="el" href="eventloop_8c_source.html#l00087">_timerInt::next</a>, <a class="el" href="log_8c_source.html#l00048">o_log</a>, <a class="el" href="o__log_8h_source.html#l00027">O_LOG_DEBUG2</a>, <a class="el" href="o__log_8h_source.html#l00028">O_LOG_DEBUG3</a>, <a class="el" href="o__log_8h_source.html#l00029">O_LOG_DEBUG4</a>, <a class="el" href="o__log_8h_source.html#l00023">O_LOG_ERROR</a>, <a class="el" href="o__log_8h_source.html#l00024">O_LOG_WARN</a>, <a class="el" href="eventloop_8c_source.html#l00075">_timerInt::period</a>, <a class="el" href="eventloop_8c_source.html#l00118">_channel::read_cbk</a>, <a class="el" href="eventloop_8c_source.html#l00102">_channel::socket</a>, <a class="el" href="o__eventloop_8h_source.html#l00081">SOCKET_CONN_CLOSED</a>, <a class="el" href="o__eventloop_8h_source.html#l00083">SOCKET_CONN_REFUSED</a>, <a class="el" href="o__eventloop_8h_source.html#l00085">SOCKET_DROPPED</a>, <a class="el" href="o__eventloop_8h_source.html#l00087">SOCKET_IDLE</a>, <a class="el" href="o__eventloop_8h_source.html#l00077">SOCKET_UNKNOWN</a>, <a class="el" href="o__eventloop_8h_source.html#l00079">SOCKET_WRITEABLE</a>, and <a class="el" href="eventloop_8c_source.html#l00125">_channel::status_cbk</a>.</p>

<p>Referenced by <a class="el" href="oml2-proxy-server_8c_source.html#l00307">main()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> i;</div>
<div class="line">  <span class="keyword">self</span>.stopping = 0;</div>
<div class="line">  <span class="keyword">self</span>.force_stop = 0;</div>
<div class="line">  <span class="keyword">self</span>.start = <span class="keyword">self</span>.now = <span class="keyword">self</span>.last_reaped = time(NULL);</div>
<div class="line">  <span class="keywordflow">while</span> (!<span class="keyword">self</span>.stopping || (<span class="keyword">self</span>.size&gt;0 &amp;&amp; !<span class="keyword">self</span>.force_stop)) {</div>
<div class="line">    <span class="comment">// Check for active timers</span></div>
<div class="line">    <span class="keywordtype">int</span> timeout = -1;</div>
<div class="line">    <a class="code" href="struct__timerInt.html">TimerInt</a>* t = <span class="keyword">self</span>.timers;</div>
<div class="line">    <span class="keywordflow">while</span> (t != NULL) {</div>
<div class="line">      <span class="keywordflow">if</span> (t-&gt;<a class="code" href="struct__timerInt.html#a65afeba6d9c83fb3b1e38e6235e74040">is_active</a>) {</div>
<div class="line">        <span class="keywordtype">int</span> delta = 1000 * (t-&gt;<a class="code" href="struct__timerInt.html#ac7e641ad31a71346cb8ef0d7996b0dd3">due_time</a> - <span class="keyword">self</span>.now);</div>
<div class="line">        <span class="keywordflow">if</span> (delta &lt; 0) delta = 0; <span class="comment">// overdue</span></div>
<div class="line">        <span class="keywordflow">if</span> (delta &lt; timeout || timeout &lt; 0) timeout = delta;</div>
<div class="line">      }</div>
<div class="line">      t = t-&gt;<a class="code" href="struct__timerInt.html#ad7d02f335c9fa6a0cba9750bf4797856">next</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (timeout != -1)</div>
<div class="line">      <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#ab2683e0414199b1eef59181ad32cc38a">O_LOG_DEBUG3</a>, <span class="stringliteral">&quot;EventLoop: Timeout = %d\n&quot;</span>, timeout);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">self</span>.fds_dirty)</div>
<div class="line">      <span class="keywordflow">if</span> (update_fds()&lt;1 &amp;&amp; timeout &lt; 0) <span class="comment">/* No FD nor timeout */</span></div>
<div class="line">        <span class="keywordflow">continue</span>;</div>
<div class="line">    <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#aa4503761ebdf855082a620f66df1c76d">O_LOG_DEBUG4</a>, <span class="stringliteral">&quot;EventLoop: About to poll() on %d FDs with a timeout of %ds\n&quot;</span>, <span class="keyword">self</span>.size, timeout);</div>
<div class="line">    <span class="comment">/* for(i=0; i &lt; self.size; i++) {</span></div>
<div class="line"><span class="comment">      o_log(O_LOG_DEBUG4, &quot;EventLoop: FD %d-&gt;%s\n&quot;, self.fds[i].fd, self.fds_channels[i]-&gt;name);</span></div>
<div class="line"><span class="comment">    } */</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> <a class="code" href="stddev__0_8c.html#af16d1aad57793bdd673526c79ac6fbfe">count</a> = poll(<span class="keyword">self</span>.fds, <span class="keyword">self</span>.size, timeout);</div>
<div class="line">    <span class="keyword">self</span>.now = time(NULL);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (count &lt; 1) {</div>
<div class="line">      <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#aa4503761ebdf855082a620f66df1c76d">O_LOG_DEBUG4</a>, <span class="stringliteral">&quot;EventLoop: Timeout\n&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// Check sockets</span></div>
<div class="line">      i = 0;</div>
<div class="line">      <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#aa4503761ebdf855082a620f66df1c76d">O_LOG_DEBUG4</a>, <span class="stringliteral">&quot;EventLoop: Got events\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">for</span> (; i &lt; <span class="keyword">self</span>.size; i++) {</div>
<div class="line">        <a class="code" href="struct__channel.html">Channel</a>* ch = <span class="keyword">self</span>.fds_channels[i];</div>
<div class="line">        <span class="keywordflow">if</span> (<span class="keyword">self</span>.fds[i].revents &amp; POLLERR) {</div>
<div class="line">          <span class="keywordtype">char</span> buf[32];</div>
<div class="line">          <a class="code" href="o__eventloop_8h.html#a579723a800874d33587042781a60af86">SocketStatus</a> status;</div>
<div class="line">          <span class="keywordtype">int</span> len;</div>
<div class="line"></div>
<div class="line">          <span class="keywordflow">if</span> ((len = recv(<span class="keyword">self</span>.fds[i].fd, buf, 32, 0)) &lt;= 0) {</div>
<div class="line">            <span class="keywordflow">switch</span> (errno) {</div>
<div class="line">            <span class="keywordflow">case</span> ECONNREFUSED:</div>
<div class="line">              status = <a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29add457ce25f1904fe8dd9fae79657c58f">SOCKET_CONN_REFUSED</a>;</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">              status = <a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29a43ab64a7bd7e3173e5f65203d28f1c93">SOCKET_UNKNOWN</a>;</div>
<div class="line">              <span class="keywordflow">if</span> (!ch-&gt;<a class="code" href="struct__channel.html#a89744ad6f5d1308ecdee90c452d920e5">status_cbk</a>) {</div>
<div class="line">                <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a5ea1f1d02dfda13b474ec771f7bd1a3a">O_LOG_ERROR</a>, <span class="stringliteral">&quot;EventLoop: While reading from socket &#39;%s&#39;: (%d) %s\n&quot;</span>,</div>
<div class="line">                      ch-&gt;<a class="code" href="struct__channel.html#a1c5ae84da3cf77dae172b9d099b6bb5a">name</a>, errno, strerror(errno));</div>
<div class="line">              }</div>
<div class="line">            }</div>
<div class="line">            <a class="code" href="eventloop_8c.html#a99ee2a1e2528b25fe3ccde5f6d475a06">eventloop_socket_activate</a>((<a class="code" href="struct__sockEvtSource.html">SockEvtSource</a>*)ch, 0);</div>
<div class="line">            do_status_callback (ch, status, errno);</div>
<div class="line">          } <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a5ea1f1d02dfda13b474ec771f7bd1a3a">O_LOG_ERROR</a>, <span class="stringliteral">&quot;EventLoop: Expected error on socket &#39;%s&#39; but read &#39;%s&#39;\n&quot;</span>, ch-&gt;<a class="code" href="struct__channel.html#a1c5ae84da3cf77dae172b9d099b6bb5a">name</a>, buf);</div>
<div class="line">          }</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">self</span>.fds[i].revents &amp; POLLHUP) {</div>
<div class="line">          <a class="code" href="eventloop_8c.html#a99ee2a1e2528b25fe3ccde5f6d475a06">eventloop_socket_activate</a>((<a class="code" href="struct__sockEvtSource.html">SockEvtSource</a>*)ch, 0);</div>
<div class="line"></div>
<div class="line">          <span class="comment">/* Client closed the connection, but there might still be bytes</span></div>
<div class="line"><span class="comment">             for us to read from our end of the connection. */</span></div>
<div class="line">          <span class="keywordtype">int</span> len;</div>
<div class="line">          <span class="keywordtype">int</span> fd = <span class="keyword">self</span>.fds[i].fd;</div>
<div class="line">          <span class="keywordtype">char</span> buf[<a class="code" href="eventloop_8c.html#ac09134c54ec876860ef342a9e9e03095">MAX_READ_BUFFER_SIZE</a>];</div>
<div class="line">          <span class="keywordflow">do</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (fd == 0) {</div>
<div class="line">              len = read(fd, buf, <a class="code" href="eventloop_8c.html#ac09134c54ec876860ef342a9e9e03095">MAX_READ_BUFFER_SIZE</a>);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">              len = recv(fd, buf, 512, 0);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (len &gt; 0) {</div>
<div class="line">              <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#ab2683e0414199b1eef59181ad32cc38a">O_LOG_DEBUG3</a>, <span class="stringliteral">&quot;EventLoop: Received last %i bytes\n&quot;</span>, len);</div>
<div class="line">              do_read_callback (ch, buf, len);</div>
<div class="line">            }</div>
<div class="line">          } <span class="keywordflow">while</span> (len &gt; 0);</div>
<div class="line">          do_status_callback (ch, <a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29adc51a996c8067046c7bb75ff6591dc74">SOCKET_CONN_CLOSED</a>, 0);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">self</span>.fds[i].revents &amp; POLLIN) {</div>
<div class="line">          <span class="keywordtype">char</span> buf[<a class="code" href="eventloop_8c.html#ac09134c54ec876860ef342a9e9e03095">MAX_READ_BUFFER_SIZE</a>];</div>
<div class="line">          <span class="keywordflow">if</span> (ch-&gt;<a class="code" href="struct__channel.html#af210ef246c498ae80185865c87c42f32">read_cbk</a>) {</div>
<div class="line">            <span class="keywordtype">int</span> len;</div>
<div class="line">            <span class="keywordtype">int</span> fd = <span class="keyword">self</span>.fds[i].fd;</div>
<div class="line">            <span class="keywordflow">if</span> (fd == 0) {</div>
<div class="line">              <span class="comment">// stdin</span></div>
<div class="line">              len = read(fd, buf, <a class="code" href="eventloop_8c.html#ac09134c54ec876860ef342a9e9e03095">MAX_READ_BUFFER_SIZE</a>);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">              <span class="comment">// socket</span></div>
<div class="line">              len = recv(fd, buf, 512, 0);</div>
<div class="line">            }</div>
<div class="line">            ch-&gt;<a class="code" href="struct__channel.html#a7e0c9f5f0588df9326338e58293b305a">last_activity</a> = <span class="keyword">self</span>.now;</div>
<div class="line">            <span class="keywordflow">if</span> (len &gt; 0) {</div>
<div class="line">              <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#ab2683e0414199b1eef59181ad32cc38a">O_LOG_DEBUG3</a>, <span class="stringliteral">&quot;EventLoop: Received %i bytes\n&quot;</span>, len);</div>
<div class="line">              do_read_callback (ch, buf, len);</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len == 0 &amp;&amp; ch-&gt;<a class="code" href="struct__channel.html#ae73bf1decca1085202d452c579c9a709">socket</a> != NULL) {  <span class="comment">// skip stdin</span></div>
<div class="line">              <span class="comment">// closed down</span></div>
<div class="line">              <a class="code" href="eventloop_8c.html#a99ee2a1e2528b25fe3ccde5f6d475a06">eventloop_socket_activate</a>((<a class="code" href="struct__sockEvtSource.html">SockEvtSource</a>*)ch, 0);</div>
<div class="line">              do_status_callback (ch, <a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29adc51a996c8067046c7bb75ff6591dc74">SOCKET_CONN_CLOSED</a>, 0);</div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt; 0) {</div>
<div class="line">              <span class="keywordflow">if</span> (errno == ENOTSOCK) {</div>
<div class="line">                <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a5ea1f1d02dfda13b474ec771f7bd1a3a">O_LOG_ERROR</a>,</div>
<div class="line">                      <span class="stringliteral">&quot;EventLoop: Monitored socket &#39;%s&#39; is now invalid; &quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;removing from monitored set\n&quot;</span>,</div>
<div class="line">                      ch-&gt;<a class="code" href="struct__channel.html#a1c5ae84da3cf77dae172b9d099b6bb5a">name</a>);</div>
<div class="line">                <a class="code" href="eventloop_8c.html#a5a3644a8f05609def4e6c259ebc4d68b">eventloop_socket_remove</a> ((<a class="code" href="struct__sockEvtSource.html">SockEvtSource</a>*)ch);</div>
<div class="line">              } <span class="keywordflow">else</span> {</div>
<div class="line">                <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a5ea1f1d02dfda13b474ec771f7bd1a3a">O_LOG_ERROR</a>, <span class="stringliteral">&quot;EventLoop: Unrecognized read error not handled (errno=%d)\n&quot;</span>,</div>
<div class="line">                      errno);</div>
<div class="line">              }</div>
<div class="line">            }</div>
<div class="line">          } <span class="keywordflow">else</span> {</div>
<div class="line">            do_monitor_callback (ch);</div>
<div class="line">          }</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch-&gt;<a class="code" href="struct__channel.html#a5b71a6f886a253ba5e223b9aa2b5cd60">is_shutting_down</a>) {</div>
<div class="line">          <span class="comment">/* The socket was shutting down, and nothing new has appeared;</span></div>
<div class="line"><span class="comment">           * We flushed the buffers, mark it as removable */</span></div>
<div class="line">          <a class="code" href="eventloop_8c.html#ac5492e61cfa3174503923e3ed541a3a1">eventloop_socket_release</a>((<a class="code" href="struct__sockEvtSource.html">SockEvtSource</a>*)ch);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<span class="keyword">self</span>.fds[i].revents &amp; POLLOUT) {</div>
<div class="line">          do_status_callback(ch, <a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29a6dad79a3e1614d8a599fe02701689299">SOCKET_WRITEABLE</a>, 0);</div>
<div class="line">          <span class="keywordflow">if</span> (0 != ch-&gt;<a class="code" href="struct__channel.html#a7e0c9f5f0588df9326338e58293b305a">last_activity</a>) {</div>
<div class="line">            <span class="comment">/* If we track the activity of this socket */</span></div>
<div class="line">            ch-&gt;<a class="code" href="struct__channel.html#a7e0c9f5f0588df9326338e58293b305a">last_activity</a> = <span class="keyword">self</span>.now;</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<span class="keyword">self</span>.fds[i].revents &amp; POLLNVAL) {</div>
<div class="line">          <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a56a33f447cce1b983d6d689f46c8fc87">O_LOG_WARN</a>, <span class="stringliteral">&quot;EventLoop: socket &#39;%s&#39; invalid, deactivating...\n&quot;</span>, ch-&gt;<a class="code" href="struct__channel.html#a1c5ae84da3cf77dae172b9d099b6bb5a">name</a>);</div>
<div class="line">          <a class="code" href="eventloop_8c.html#a99ee2a1e2528b25fe3ccde5f6d475a06">eventloop_socket_activate</a>((<a class="code" href="struct__sockEvtSource.html">SockEvtSource</a>*)ch, 0);</div>
<div class="line">          do_status_callback(ch, <a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29a704eefbe39ac96f64426944661b2a626">SOCKET_DROPPED</a>, 0);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* We reap idle channels as we go through the list.  XXX: There might</span></div>
<div class="line"><span class="comment">         * be a corner case where all FDs are already used, and some of them</span></div>
<div class="line"><span class="comment">         * idle, however a new a new connection (on one listening socket early</span></div>
<div class="line"><span class="comment">         * in the list) would be dropped before cleanup triggered by its</span></div>
<div class="line"><span class="comment">         * arrival freed the resources it needs (from the idle sockets further</span></div>
<div class="line"><span class="comment">         * towards the end of the list. See #959.*/</span></div>
<div class="line">        <span class="keywordflow">if</span> (ch-&gt;<a class="code" href="struct__channel.html#a7e0c9f5f0588df9326338e58293b305a">last_activity</a> != 0 &amp;&amp;</div>
<div class="line">            <span class="keyword">self</span>.socket_timeout &gt; 0 &amp;&amp;</div>
<div class="line">            <span class="keyword">self</span>.now - ch-&gt;<a class="code" href="struct__channel.html#a7e0c9f5f0588df9326338e58293b305a">last_activity</a> &gt; <span class="keyword">self</span>.socket_timeout) {</div>
<div class="line">            <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#aad44cd3a2bea1816db26d7127fc8ced8">O_LOG_DEBUG2</a>, <span class="stringliteral">&quot;EventLoop: Socket &#39;%s&#39; idle for %ds, reaping...\n&quot;</span>, ch-&gt;<a class="code" href="struct__channel.html#a1c5ae84da3cf77dae172b9d099b6bb5a">name</a>, <span class="keyword">self</span>.now - ch-&gt;<a class="code" href="struct__channel.html#a7e0c9f5f0588df9326338e58293b305a">last_activity</a>);</div>
<div class="line">          do_status_callback(ch, <a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29aa78a3802f09a9c7a0361f52fc743c038">SOCKET_IDLE</a>, 0);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">self</span>.size; i++) {</div>
<div class="line">        <a class="code" href="struct__channel.html">Channel</a>* ch = <span class="keyword">self</span>.fds_channels[i];</div>
<div class="line">        <span class="keywordflow">if</span> (ch-&gt;<a class="code" href="struct__channel.html#ab58b41c63afaafad9285db3f63191399">is_removable</a>)</div>
<div class="line">          <a class="code" href="eventloop_8c.html#a5a3644a8f05609def4e6c259ebc4d68b">eventloop_socket_remove</a> ((<a class="code" href="struct__sockEvtSource.html">SockEvtSource</a>*)ch);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (timeout &gt;= 0) {</div>
<div class="line">      <span class="comment">// check timers</span></div>
<div class="line">      <a class="code" href="struct__timerInt.html">TimerInt</a>* t = <span class="keyword">self</span>.timers;</div>
<div class="line">      <span class="keywordflow">while</span> (t != NULL) {</div>
<div class="line">        <span class="keywordflow">if</span> (t-&gt;<a class="code" href="struct__timerInt.html#a65afeba6d9c83fb3b1e38e6235e74040">is_active</a>) {</div>
<div class="line">          <span class="keywordflow">if</span> (t-&gt;<a class="code" href="struct__timerInt.html#ac7e641ad31a71346cb8ef0d7996b0dd3">due_time</a> &lt;= <span class="keyword">self</span>.now) {</div>
<div class="line">            <span class="comment">// fires</span></div>
<div class="line">            <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#aad44cd3a2bea1816db26d7127fc8ced8">O_LOG_DEBUG2</a>, <span class="stringliteral">&quot;EventLoop: Timer &#39;%s&#39; fired\n&quot;</span>, t-&gt;<a class="code" href="struct__timerInt.html#a09a1e2b4be0326c5783dcfe8e538aed4">name</a>);</div>
<div class="line">            <span class="keywordflow">if</span> (t-&gt;<a class="code" href="struct__timerInt.html#a6fa48cae2749192e45eddc6d9dc17c59">callback</a>) t-&gt;<a class="code" href="struct__timerInt.html#a6fa48cae2749192e45eddc6d9dc17c59">callback</a>((<a class="code" href="struct__TimerEvtSource.html">TimerEvtSource</a>*)t, t-&gt;<a class="code" href="struct__timerInt.html#ae1a42cfe36e6842a46215365e6672860">handle</a>);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (t-&gt;<a class="code" href="struct__timerInt.html#a5841f7dcbe9406391fe13f96de033c0a">is_periodic</a>) {</div>
<div class="line">              <span class="keywordflow">while</span> ((t-&gt;<a class="code" href="struct__timerInt.html#ac7e641ad31a71346cb8ef0d7996b0dd3">due_time</a> += t-&gt;<a class="code" href="struct__timerInt.html#a19c5e56df49cc945bbe3aab19b20ad80">period</a>) &lt; <span class="keyword">self</span>.now) {</div>
<div class="line">                <span class="comment">// should really only happen during debugging</span></div>
<div class="line">                <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a56a33f447cce1b983d6d689f46c8fc87">O_LOG_WARN</a>, <span class="stringliteral">&quot;EventLoop: Skipped timer period for &#39;%s&#39;\n&quot;</span>,</div>
<div class="line">                      t-&gt;<a class="code" href="struct__timerInt.html#a09a1e2b4be0326c5783dcfe8e538aed4">name</a>);</div>
<div class="line">              }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">              t-&gt;<a class="code" href="struct__timerInt.html#a65afeba6d9c83fb3b1e38e6235e74040">is_active</a> = 0;</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">        t = t-&gt;<a class="code" href="struct__timerInt.html#ad7d02f335c9fa6a0cba9750bf4797856">next</a>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">self</span>.stopping;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a60c04e3ab6cdc2f705115ab382dc47c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void eventloop_set_socket_timeout </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>to</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set the timeout, in seconds, after which idle sockets are reaped.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">to</td><td>timeout [s], 0 to disable </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00231">231</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="log_8c_source.html#l00048">o_log</a>, and <a class="el" href="o__log_8h_source.html#l00027">O_LOG_DEBUG2</a>.</p>

<p>Referenced by <a class="el" href="eventloop_8c_source.html#l00210">eventloop_init()</a>, and <a class="el" href="oml2-server_8c_source.html#l00292">main()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#aad44cd3a2bea1816db26d7127fc8ced8">O_LOG_DEBUG2</a>, <span class="stringliteral">&quot;EventLoop: Setting socket idleness timeout to %ds\n&quot;</span>, to);</div>
<div class="line">  <span class="keyword">self</span>.socket_timeout = to;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a99ee2a1e2528b25fe3ccde5f6d475a06"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void eventloop_socket_activate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mark socket event source (channel) as active or not.</p>
<p>This triggers FD update if need be.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>SockEvtSource to (de)activate </td></tr>
    <tr><td class="paramname">flag</td><td>0 to deactivate, anything else to activate (use 1)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd>update_fds </dd></dl>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00675">675</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="eventloop_8c_source.html#l00106">_channel::is_active</a>.</p>

<p>Referenced by <a class="el" href="eventloop_8c_source.html#l00257">eventloop_run()</a>, <a class="el" href="eventloop_8c_source.html#l00698">eventloop_socket_release()</a>, and <a class="el" href="eventloop_8c_source.html#l00714">eventloop_socket_remove()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="struct__channel.html">Channel</a>* ch = (<a class="code" href="struct__channel.html">Channel</a>*)source;</div>
<div class="line">  <span class="keywordflow">if</span> (ch-&gt;<a class="code" href="struct__channel.html#ada8ea216193a7abebc42f7418bbe79b7">is_active</a> != flag) {</div>
<div class="line">    ch-&gt;<a class="code" href="struct__channel.html#ada8ea216193a7abebc42f7418bbe79b7">is_active</a> = flag;</div>
<div class="line">    <span class="keyword">self</span>.fds_dirty = 1;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac5492e61cfa3174503923e3ed541a3a1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void eventloop_socket_release </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *&#160;</td>
          <td class="paramname"><em>source</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Tell the EventLoop to release a channel.</p>
<p>This marks the socket as "removable", but does not remove it immediately. The next time the event loop finishes processing events, it will scan the list of channels/sockets for ones that are removable, and will call <a class="el" href="eventloop_8c.html#a5a3644a8f05609def4e6c259ebc4d68b">eventloop_socket_remove()</a> on them.</p>
<p>At that point, the socket data structure will be destroyed.</p>
<p>After this function is called on a socket, the eventloop will no longer generate callbacks for that socket, therefore the client code must ensure that it has already disposed of the socket's <code>handle</code> data structure, otherwise a memory leak might occur. </p>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00698">698</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="eventloop_8c_source.html#l00675">eventloop_socket_activate()</a>, <a class="el" href="eventloop_8c_source.html#l00128">_channel::handle</a>, and <a class="el" href="eventloop_8c_source.html#l00115">_channel::is_removable</a>.</p>

<p>Referenced by <a class="el" href="client__handler_8c_source.html#l00227">client_handler_free()</a>, and <a class="el" href="eventloop_8c_source.html#l00257">eventloop_run()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="struct__channel.html">Channel</a> *ch = (<a class="code" href="struct__channel.html">Channel</a>*)source;</div>
<div class="line">  <a class="code" href="eventloop_8c.html#a99ee2a1e2528b25fe3ccde5f6d475a06">eventloop_socket_activate</a>(source, 0);</div>
<div class="line">  ch-&gt;<a class="code" href="struct__channel.html#ab58b41c63afaafad9285db3f63191399">is_removable</a> = 1;</div>
<div class="line">  ch-&gt;<a class="code" href="struct__channel.html#a1a9ce20a5007cfcc2a3fa40f9a319e4f">handle</a> = NULL;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5a3644a8f05609def4e6c259ebc4d68b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void eventloop_socket_remove </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="o__eventloop_8h.html#ac2b8421423a2691d90489400dc948fb3">SockEvtSource</a> *&#160;</td>
          <td class="paramname"><em>source</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove channels from monitoring of the EventLoop.</p>
<p>The EventLoop calls this function on its own when sockets have been released using <a class="el" href="eventloop_8c.html#ac5492e61cfa3174503923e3ed541a3a1">eventloop_socket_release()</a>. You probably want to use that one instead.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>SockEvtSource to remove and free </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="o__eventloop_8h.html#ac5492e61cfa3174503923e3ed541a3a1">eventloop_socket_release</a>, channel_free </dd></dl>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00714">714</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="eventloop_8c_source.html#l00675">eventloop_socket_activate()</a>, and <a class="el" href="eventloop_8c_source.html#l00136">_channel::next</a>.</p>

<p>Referenced by <a class="el" href="oml2-proxy-server_8c_source.html#l00081">client_callback()</a>, <a class="el" href="eventloop_8c_source.html#l00257">eventloop_run()</a>, and <a class="el" href="oml2-proxy-server_8c_source.html#l00114">status_callback()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="struct__channel.html">Channel</a>* ch = (<a class="code" href="struct__channel.html">Channel</a>*)source;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="eventloop_8c.html#a99ee2a1e2528b25fe3ccde5f6d475a06">eventloop_socket_activate</a>(source, 0);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Update the linked list */</span></div>
<div class="line">  <span class="keywordflow">if</span> (<span class="keyword">self</span>.channels == ch) {</div>
<div class="line">    <span class="keyword">self</span>.channels = ch-&gt;<a class="code" href="struct__channel.html#a4a1927f192e1227328ec7e0173de05e9">next</a>;</div>
<div class="line"></div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="struct__channel.html">Channel</a>* prev = <span class="keyword">self</span>.channels;</div>
<div class="line">    <a class="code" href="struct__channel.html">Channel</a>* p = prev-&gt;<a class="code" href="struct__channel.html#a4a1927f192e1227328ec7e0173de05e9">next</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span> (p != NULL) {</div>
<div class="line">      <span class="keywordflow">if</span> (p == ch) {</div>
<div class="line">        prev-&gt;<a class="code" href="struct__channel.html#a4a1927f192e1227328ec7e0173de05e9">next</a> = ch-&gt;<a class="code" href="struct__channel.html#a4a1927f192e1227328ec7e0173de05e9">next</a>;</div>
<div class="line">        p = NULL; <span class="comment">/* We&#39;re done */</span></div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        prev = p;</div>
<div class="line">        p = p-&gt;<a class="code" href="struct__channel.html#a4a1927f192e1227328ec7e0173de05e9">next</a>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  channel_free(ch);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8b8ce3652087cc77534f7e4b6a346435"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void eventloop_stop </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>reason</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Stop the eventloop,</p>
<p>The eventloop will try to gracefully finish by waiting for all active FDs to be closed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">reason</td><td>a non-zero reason for stopping the loop; default to 1, with a warning </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00447">447</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="log_8c_source.html#l00048">o_log</a>, and <a class="el" href="o__log_8h_source.html#l00024">O_LOG_WARN</a>.</p>

<p>Referenced by <a class="el" href="eventloop_8c_source.html#l00462">eventloop_terminate()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(reason) {</div>
<div class="line">    <span class="keyword">self</span>.stopping = reason;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a56a33f447cce1b983d6d689f46c8fc87">O_LOG_WARN</a>, <span class="stringliteral">&quot;EventLoop: Tried to stop with no reason, defaulting to 1&quot;</span>);</div>
<div class="line">    <span class="keyword">self</span>.stopping = 1;</div>
<div class="line">  }</div>
<div class="line">  terminate_fds();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9905b32a4a5d3a24c90f44ecb5e0e459"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void eventloop_terminate </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>reason</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Terminate the eventloop,</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">reason</td><td>a non-zero reason for stopping the loop; default to 1, with a warning </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00462">462</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="eventloop_8c_source.html#l00447">eventloop_stop()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keyword">self</span>.force_stop = 1;</div>
<div class="line">    <a class="code" href="eventloop_8c.html#a8b8ce3652087cc77534f7e4b6a346435">eventloop_stop</a>(reason);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1dcf3cfdfad5652d9b323f41edb5d491"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void eventloop_timer_stop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="o__eventloop_8h.html#a69ccb1d41842c4521908f2a87a1c4516">TimerEvtSource</a> *&#160;</td>
          <td class="paramname"><em>timer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Stop timer and free its allocated memory</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timer</td><td>TimerEvtSource to terminate and free</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="o__eventloop_8h.html#af83b5f2beb881a21ef75171d072ff7f8">eventloop_every</a> </dd>
<dd>
<a class="el" href="mem_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a> </dd></dl>

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00534">534</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="eventloop_8c_source.html#l00087">_timerInt::next</a>.</p>
<div class="fragment"><div class="line">                                                 {</div>
<div class="line">  <a class="code" href="struct__timerInt.html">TimerInt</a> *t = (<a class="code" href="struct__timerInt.html">TimerInt</a> *)timer;</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Update the linked list */</span></div>
<div class="line">  <span class="keywordflow">if</span> (<span class="keyword">self</span>.timers == t) {</div>
<div class="line">    <span class="keyword">self</span>.timers = t-&gt;<a class="code" href="struct__timerInt.html#ad7d02f335c9fa6a0cba9750bf4797856">next</a>;</div>
<div class="line"></div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="struct__timerInt.html">TimerInt</a>* prev = <span class="keyword">self</span>.timers;</div>
<div class="line">    <a class="code" href="struct__timerInt.html">TimerInt</a>* p = prev-&gt;<a class="code" href="struct__timerInt.html#ad7d02f335c9fa6a0cba9750bf4797856">next</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span> (p != NULL) {</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">if</span> (p == t) {</div>
<div class="line">        prev-&gt;<a class="code" href="struct__timerInt.html#ad7d02f335c9fa6a0cba9750bf4797856">next</a> = t-&gt;<a class="code" href="struct__timerInt.html#ad7d02f335c9fa6a0cba9750bf4797856">next</a>;</div>
<div class="line">        p = NULL; <span class="comment">/* We&#39;re done */</span></div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        prev = p;</div>
<div class="line">        p = p-&gt;<a class="code" href="struct__timerInt.html#ad7d02f335c9fa6a0cba9750bf4797856">next</a>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  eventloop_timer_free(t);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3a481ec84bd7470fc132207e78f58329"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* socket_status_string </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="o__eventloop_8h.html#a579723a800874d33587042781a60af86">SocketStatus</a>&#160;</td>
          <td class="paramname"><em>status</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="eventloop_8c_source.html#l00045">45</a> of file <a class="el" href="eventloop_8c_source.html">eventloop.c</a>.</p>

<p>References <a class="el" href="eventloop_8c_source.html#l00044">case_string</a>, <a class="el" href="o__eventloop_8h_source.html#l00081">SOCKET_CONN_CLOSED</a>, <a class="el" href="o__eventloop_8h_source.html#l00083">SOCKET_CONN_REFUSED</a>, <a class="el" href="o__eventloop_8h_source.html#l00085">SOCKET_DROPPED</a>, <a class="el" href="o__eventloop_8h_source.html#l00087">SOCKET_IDLE</a>, <a class="el" href="o__eventloop_8h_source.html#l00077">SOCKET_UNKNOWN</a>, and <a class="el" href="o__eventloop_8h_source.html#l00079">SOCKET_WRITEABLE</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordflow">switch</span>(status) {</div>
<div class="line">    <a class="code" href="eventloop_8c.html#ac89f36b2cd8546bed1c6840aea720885">case_string</a>(<a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29a43ab64a7bd7e3173e5f65203d28f1c93">SOCKET_UNKNOWN</a>);</div>
<div class="line">    <a class="code" href="eventloop_8c.html#ac89f36b2cd8546bed1c6840aea720885">case_string</a>(<a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29a6dad79a3e1614d8a599fe02701689299">SOCKET_WRITEABLE</a>);</div>
<div class="line">    <a class="code" href="eventloop_8c.html#ac89f36b2cd8546bed1c6840aea720885">case_string</a>(<a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29adc51a996c8067046c7bb75ff6591dc74">SOCKET_CONN_CLOSED</a>);</div>
<div class="line">    <a class="code" href="eventloop_8c.html#ac89f36b2cd8546bed1c6840aea720885">case_string</a>(<a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29add457ce25f1904fe8dd9fae79657c58f">SOCKET_CONN_REFUSED</a>);</div>
<div class="line">    <a class="code" href="eventloop_8c.html#ac89f36b2cd8546bed1c6840aea720885">case_string</a>(<a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29a704eefbe39ac96f64426944661b2a626">SOCKET_DROPPED</a>);</div>
<div class="line">    <a class="code" href="eventloop_8c.html#ac89f36b2cd8546bed1c6840aea720885">case_string</a>(<a class="code" href="o__eventloop_8h.html#ad4b72d4e70e1ef536d14bf0543890a29aa78a3802f09a9c7a0361f52fc743c038">SOCKET_IDLE</a>);</div>
<div class="line">  <span class="keywordflow">default</span>:</div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown SocketStatus&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_080c3098bae5c5c65083e8b807d57c04.html">ocomm</a></li><li class="navelem"><a class="el" href="dir_0f38bba985ddb336f6f8794e4f55706a.html">ocomm</a></li><li class="navelem"><a class="el" href="o__eventloop_8h.html">o_eventloop.h</a></li>
    <li class="footer">Generated on Thu Jun 25 2015 15:31:55 for oml2 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
