<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>oml2: blobgen.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="oml_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">oml2
   &#160;<span id="projectnumber">2.12.0pre.79-58cf-dirty</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('blobgen_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">blobgen.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A blob generator saving its data to plain files. It is used in the system tests to report data to the server, and make sure it has been properly written in the backend.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;sys/stat.h&gt;</code><br/>
<code>#include &lt;sys/time.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;limits.h&gt;</code><br/>
<code>#include &lt;popt.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="omlc_8h_source.html">oml2/omlc.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for blobgen.c:</div>
<div class="dyncontent">
<div class="center"><img src="blobgen_8c__incl.png" border="0" usemap="#blobgen_8c" alt=""/></div>
<map name="blobgen_8c" id="blobgen_8c">
<area shape="rect" id="node21" href="omlc_8h.html" title="Public API of the OML client library." alt="" coords="192,83,285,112"/><area shape="rect" id="node33" href="o__log_8h.html" title="ocomm/o_log.h" alt="" coords="481,160,591,189"/></map>
</div>
</div>
<p><a href="blobgen_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a6cb8e33b91b89ff70fd23280cc2f7b85"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blobgen_8c.html#a6cb8e33b91b89ff70fd23280cc2f7b85">MAX_BLOB</a>&#160;&#160;&#160;(1024 * 1024)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7f16cee7dc23902c3b5d140f738b2600"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blobgen_8c.html#a7f16cee7dc23902c3b5d140f738b2600">randgen</a> (size_t *n)</td></tr>
<tr class="memitem:a7c09e0e3975a6025576f1d9bd4db63e4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blobgen_8c.html#a7c09e0e3975a6025576f1d9bd4db63e4">write_blob_bin</a> (int fd, void *blob, size_t n)</td></tr>
<tr class="memitem:a081bd9459ad15e187610450c7e1f5e78"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blobgen_8c.html#a081bd9459ad15e187610450c7e1f5e78">write_blob_hex</a> (int fd, void *blob, size_t n)</td></tr>
<tr class="memitem:ad3bbadb58bf716108d378649cd8bd4a1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blobgen_8c.html#ad3bbadb58bf716108d378649cd8bd4a1">blob_to_file</a> (int index, void *blob, size_t n)</td></tr>
<tr class="memitem:a0bf2ae46faca21ea5db3bc88571bfd86"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blobgen_8c.html#a0bf2ae46faca21ea5db3bc88571bfd86">difftv</a> (struct timeval t1, struct timeval t2)</td></tr>
<tr class="memitem:ae8130ac74a8b5d1d8276c99a284d3cd5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blobgen_8c.html#ae8130ac74a8b5d1d8276c99a284d3cd5">meta_to_file</a> (const char *key, const char *value, const char *mpname, const char *fname)</td></tr>
<tr class="memitem:a05e0ffe612d44e6d7f3a9ae5b9df56a2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blobgen_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2">run</a> (void)</td></tr>
<tr class="memitem:a217dbf8b442f20279ea00b898af96f52"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blobgen_8c.html#a217dbf8b442f20279ea00b898af96f52">main</a> (int argc, const char **argv)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2e48d05a30e5baae3312f63532cd9c21"><td class="memItemLeft" align="right" valign="top">struct poptOption&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blobgen_8c.html#a2e48d05a30e5baae3312f63532cd9c21">options</a> []</td></tr>
<tr class="memitem:a8f5ec90394e42efb227d03ce038b0377"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOmlMP.html">OmlMP</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blobgen_8c.html#a8f5ec90394e42efb227d03ce038b0377">mp</a></td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>A blob generator saving its data to plain files. It is used in the system tests to report data to the server, and make sure it has been properly written in the backend. </p>

<p>Definition in file <a class="el" href="blobgen_8c_source.html">blobgen.c</a>.</p>
</div><h2>Macro Definition Documentation</h2>
<a class="anchor" id="a6cb8e33b91b89ff70fd23280cc2f7b85"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_BLOB&#160;&#160;&#160;(1024 * 1024)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="blobgen_8c_source.html#l00045">45</a> of file <a class="el" href="blobgen_8c_source.html">blobgen.c</a>.</p>

<p>Referenced by <a class="el" href="blobgen_8c_source.html#l00048">randgen()</a>.</p>

</div>
</div>
<h2>Function Documentation</h2>
<a class="anchor" id="ad3bbadb58bf716108d378649cd8bd4a1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void blob_to_file </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>blob</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="blobgen_8c_source.html#l00100">100</a> of file <a class="el" href="blobgen_8c_source.html">blobgen.c</a>.</p>

<p>References <a class="el" href="blobgen_8c_source.html#l00076">write_blob_bin()</a>, and <a class="el" href="blobgen_8c_source.html#l00082">write_blob_hex()</a>.</p>

<p>Referenced by <a class="el" href="blobgen_8c_source.html#l00168">run()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span> s[64];</div>
<div class="line">  <span class="keywordtype">int</span> fd, result;</div>
<div class="line"></div>
<div class="line">  snprintf (s, <span class="keyword">sizeof</span>(s), <span class="stringliteral">&quot;g%d.%s&quot;</span>, index, hex ? <span class="stringliteral">&quot;hex&quot;</span> : <span class="stringliteral">&quot;bin&quot;</span>);</div>
<div class="line">  fd = open (s, O_RDWR | O_CREAT | O_TRUNC, S_IRWXU);</div>
<div class="line">  <span class="keywordflow">if</span> (fd == -1) {</div>
<div class="line">    fprintf (stderr, <span class="stringliteral">&quot;# blobgen: could not open file %s: %s\n&quot;</span>, s, strerror (errno));</div>
<div class="line">    exit (1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  result = (hex ? <a class="code" href="blobgen_8c.html#a081bd9459ad15e187610450c7e1f5e78">write_blob_hex</a> : <a class="code" href="blobgen_8c.html#a7c09e0e3975a6025576f1d9bd4db63e4">write_blob_bin</a>) (fd, blob, n);</div>
<div class="line">  <span class="keywordflow">if</span> (result == -1) {</div>
<div class="line">    fprintf (stderr, <span class="stringliteral">&quot;# blobgen: writing blob (%lu bytes) to file: %s\n&quot;</span>, n, strerror (errno));</div>
<div class="line">    close (fd);</div>
<div class="line">    exit (1);</div>
<div class="line">  }</div>
<div class="line">  close (fd);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0bf2ae46faca21ea5db3bc88571bfd86"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double difftv </td>
          <td>(</td>
          <td class="paramtype">struct timeval&#160;</td>
          <td class="paramname"><em>t1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct timeval&#160;</td>
          <td class="paramname"><em>t2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="blobgen_8c_source.html#l00121">121</a> of file <a class="el" href="blobgen_8c_source.html">blobgen.c</a>.</p>

<p>Referenced by <a class="el" href="blobgen_8c_source.html#l00168">run()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> (((<span class="keywordtype">double</span>)(t1.tv_sec - t2.tv_sec)) + (<span class="keywordtype">double</span>)(t1.tv_usec - t2.tv_usec)/1000000.);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a217dbf8b442f20279ea00b898af96f52"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="blobgen_8c_source.html#l00216">216</a> of file <a class="el" href="blobgen_8c_source.html">blobgen.c</a>.</p>

<p>References <a class="el" href="init_8c_source.html#l00365">omlc_add_mp()</a>, <a class="el" href="init_8c_source.html#l00637">omlc_close()</a>, <a class="el" href="init_8c_source.html#l00096">omlc_init()</a>, <a class="el" href="init_8c_source.html#l00539">omlc_start()</a>, <a class="el" href="oml2-proxy-server_8c_source.html#l00057">options</a>, and <a class="el" href="generator_8c_source.html#l00037">run()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> c;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="init_8c.html#a7d59c725c0197f45301bf777dec8a49d">omlc_init</a> (<span class="stringliteral">&quot;blobgen&quot;</span>, &amp;argc, argv, NULL);</div>
<div class="line">  <a class="code" href="structmp.html">mp</a> = <a class="code" href="init_8c.html#a13e1026b136bfacfbb3764d454241db0">omlc_add_mp</a> (<span class="stringliteral">&quot;blobmp&quot;</span>, <a class="code" href="check__liboml2__api_8c.html#a9d503c9a0a61f5c6e40caecb28b523be">mpdef</a>);</div>
<div class="line">  <a class="code" href="init_8c.html#a2e2497cb5b09c1c6d9b634d2d60db587">omlc_start</a> ();</div>
<div class="line"></div>
<div class="line">  poptContext optcon = poptGetContext (NULL, argc, argv, <a class="code" href="oml2-proxy-server_8c.html#a2e48d05a30e5baae3312f63532cd9c21">options</a>, 0);</div>
<div class="line">  <span class="keywordflow">while</span> ((c = poptGetNextOpt(optcon)) &gt;= 0);</div>
<div class="line"></div>
<div class="line">  interval *= 1000; <span class="comment">/* usleep(3) expect microseconds */</span></div>
<div class="line"></div>
<div class="line">  <a class="code" href="generator_8c.html#ada122d7d14069ea8f373954d02899592">run</a>();</div>
<div class="line">  <a class="code" href="init_8c.html#a5870e99b923df20b3d7c16397bb88d87">omlc_close</a> ();</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae8130ac74a8b5d1d8276c99a284d3cd5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void meta_to_file </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>mpname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="blobgen_8c_source.html#l00127">127</a> of file <a class="el" href="blobgen_8c_source.html">blobgen.c</a>.</p>

<p>Referenced by <a class="el" href="blobgen_8c_source.html#l00168">run()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span> s[64];</div>
<div class="line">  FILE *fd;</div>
<div class="line">  <span class="keywordtype">int</span> result;</div>
<div class="line"></div>
<div class="line">  snprintf (s, <span class="keyword">sizeof</span>(s), <span class="stringliteral">&quot;g%s.meta&quot;</span>, key);</div>
<div class="line">  fd = fopen (s, <span class="stringliteral">&quot;a&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (fd == NULL) {</div>
<div class="line">    fprintf (stderr, <span class="stringliteral">&quot;# blobgen: could not open file %s: %s\n&quot;</span>, s, strerror (errno));</div>
<div class="line">    exit (1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (NULL == mpname) {         <span class="comment">/* Nothing */</span></div>
<div class="line">    result = fprintf (fd, <span class="stringliteral">&quot;.|%s\n&quot;</span>, value);</div>
<div class="line"></div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL == fname) {   <span class="comment">/* Just mpname */</span></div>
<div class="line">    result = fprintf (fd, <span class="stringliteral">&quot;.blobgen_%s|%s\n&quot;</span>, mpname, value); <span class="comment">/* Currently, the library prefixes the application name...</span></div>
<div class="line"><span class="comment">                                                               * See #1055 */</span></div>
<div class="line">  } <span class="keywordflow">else</span> {              <span class="comment">/* Everything */</span></div>
<div class="line">    result = fprintf (fd, <span class="stringliteral">&quot;.blobgen_%s.%s|%s\n&quot;</span>, mpname, fname, value);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (result &lt; 0) {</div>
<div class="line">    fprintf (stderr, <span class="stringliteral">&quot;# blobgen: error writing meta to file: %s\n&quot;</span>, strerror (errno));</div>
<div class="line">    fclose (fd);</div>
<div class="line">    exit (1);</div>
<div class="line">  }</div>
<div class="line">  fclose (fd);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7f16cee7dc23902c3b5d140f738b2600"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* randgen </td>
          <td>(</td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="blobgen_8c_source.html#l00048">48</a> of file <a class="el" href="blobgen_8c_source.html">blobgen.c</a>.</p>

<p>References <a class="el" href="blobgen_8c_source.html#l00045">MAX_BLOB</a>.</p>

<p>Referenced by <a class="el" href="blobgen_8c_source.html#l00168">run()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">long</span> length;</div>
<div class="line">  <span class="keywordtype">int</span> i;</div>
<div class="line">  uint8_t *data = NULL;</div>
<div class="line">  <span class="comment">// 10000 bytes lee-way on short blobs</span></div>
<div class="line">  <span class="keywordtype">size_t</span> max_size = longblob ? <a class="code" href="blobgen_8c.html#a6cb8e33b91b89ff70fd23280cc2f7b85">MAX_BLOB</a> : USHRT_MAX - 10000;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (fixed_size &gt; 0)</div>
<div class="line">    length = fixed_size;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <span class="keywordflow">while</span> ((<span class="keywordtype">size_t</span>)(length = random()) &gt; max_size);</div>
<div class="line"></div>
<div class="line">  data = malloc (length);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (data == NULL) {</div>
<div class="line">    perror(<span class="stringliteral">&quot;randgen()&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; length; i++)</div>
<div class="line">    data[i] = (uint8_t)(random() &amp; 0xFF);</div>
<div class="line"></div>
<div class="line">  *n = length;</div>
<div class="line">  <span class="keywordflow">return</span> data;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a05e0ffe612d44e6d7f3a9ae5b9df56a2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void run </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="blobgen_8c_source.html#l00168">168</a> of file <a class="el" href="blobgen_8c_source.html">blobgen.c</a>.</p>

<p>References <a class="el" href="blobgen_8c_source.html#l00100">blob_to_file()</a>, <a class="el" href="blobgen_8c_source.html#l00121">difftv()</a>, <a class="el" href="blobgen_8c_source.html#l00127">meta_to_file()</a>, <a class="el" href="omlc_8h_source.html#l00039">OML_STRING_VALUE</a>, <a class="el" href="api_8c_source.html#l00149">omlc_inject()</a>, <a class="el" href="api_8c_source.html#l00218">omlc_inject_metadata()</a>, <a class="el" href="omlc_8h_source.html#l00535">omlc_reset_blob</a>, <a class="el" href="omlc_8h_source.html#l00457">omlc_reset_string</a>, <a class="el" href="omlc_8h_source.html#l00538">omlc_set_blob</a>, <a class="el" href="omlc_8h_source.html#l00281">omlc_set_int32</a>, <a class="el" href="omlc_8h_source.html#l00505">omlc_set_string</a>, <a class="el" href="omlc_8h_source.html#l00217">omlc_zero_array</a>, and <a class="el" href="blobgen_8c_source.html#l00048">randgen()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> i = 0;</div>
<div class="line">  <span class="keywordtype">void</span> *blob = NULL;</div>
<div class="line">  <span class="keywordtype">size_t</span> blob_length = 0, totlength = 0;</div>
<div class="line">  <span class="keywordtype">char</span> s[64];</div>
<div class="line">  <span class="keyword">struct </span>timeval beg, end;</div>
<div class="line">  <span class="keywordtype">double</span> deltaT;</div>
<div class="line">  <a class="code" href="unionOmlValueU.html">OmlValueU</a> v[3];</div>
<div class="line">  <a class="code" href="omlc_8h.html#a40c74c037cf8ff96b0159ccdbad3a5a9">omlc_zero_array</a>(v, 3);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Piggyback on v[0] which should later contain a string */</span></div>
<div class="line">  <a class="code" href="omlc_8h.html#a13be9537ef85ccdc463a6172d4716d3a">omlc_set_string</a>(v[0], <span class="stringliteral">&quot;v1&quot;</span>);</div>
<div class="line">  <a class="code" href="api_8c.html#a8c8205b04c4b8d19a38404ee5d4b3229">omlc_inject_metadata</a>(<a class="code" href="structmp.html">mp</a>, <span class="stringliteral">&quot;k1&quot;</span>, &amp;v[0], <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012a42b33eb7c21f79727a894a530a05b559">OML_STRING_VALUE</a>, NULL);</div>
<div class="line">  <a class="code" href="blobgen_8c.html#ae8130ac74a8b5d1d8276c99a284d3cd5">meta_to_file</a>(<span class="stringliteral">&quot;k1&quot;</span>, <span class="stringliteral">&quot;v1&quot;</span>, <span class="stringliteral">&quot;blobmp&quot;</span>, NULL);</div>
<div class="line"></div>
<div class="line">  gettimeofday(&amp;beg, NULL);</div>
<div class="line">  fprintf (stderr, <span class="stringliteral">&quot;# blobgen: writing blobs:&quot;</span>);</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; samples != 0; i++, samples--) {</div>
<div class="line">    snprintf (s, <span class="keyword">sizeof</span>(s)-1, <span class="stringliteral">&quot;sample-%04d\n&quot;</span>, i);</div>
<div class="line">    blob = <a class="code" href="blobgen_8c.html#a7f16cee7dc23902c3b5d140f738b2600">randgen</a> (&amp;blob_length);</div>
<div class="line">    <a class="code" href="blobgen_8c.html#ad3bbadb58bf716108d378649cd8bd4a1">blob_to_file</a> (i + 1, blob, blob_length);</div>
<div class="line">    totlength += blob_length;</div>
<div class="line">    fprintf (stderr, <span class="stringliteral">&quot; %d (%dB)&quot;</span>, i, (<span class="keywordtype">int</span>)blob_length);</div>
<div class="line">    <a class="code" href="omlc_8h.html#a13be9537ef85ccdc463a6172d4716d3a">omlc_set_string</a> (v[0], s);</div>
<div class="line">    <a class="code" href="omlc_8h.html#aa8a1827db1559f247bf8a4023e466873">omlc_set_int32</a> (v[1], i);</div>
<div class="line">    <a class="code" href="omlc_8h.html#af59728cba3c4fd80c107c58fa9a1179c">omlc_set_blob</a> (v[2], blob, blob_length);</div>
<div class="line">    <a class="code" href="api_8c.html#ac714a82b22dfcc34a6b6130e047f2ab7">omlc_inject</a> (<a class="code" href="structmp.html">mp</a>, v);</div>
<div class="line">    fflush(stderr);</div>
<div class="line">    usleep(interval);</div>
<div class="line">  }</div>
<div class="line">  gettimeofday(&amp;end, NULL);</div>
<div class="line">  deltaT = <a class="code" href="blobgen_8c.html#a0bf2ae46faca21ea5db3bc88571bfd86">difftv</a>(end, beg);</div>
<div class="line">  fprintf (stderr, <span class="stringliteral">&quot; (%d injects and %dB in %fs: %fips, %fBps).\n&quot;</span>, i, (<span class="keywordtype">int</span>)totlength, deltaT,</div>
<div class="line">      (<span class="keywordtype">double</span>)i/deltaT, (<span class="keywordtype">double</span>)totlength/deltaT);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="omlc_8h.html#a13be9537ef85ccdc463a6172d4716d3a">omlc_set_string</a>(v[0], <span class="stringliteral">&quot;v2&quot;</span>);</div>
<div class="line">  <a class="code" href="api_8c.html#a8c8205b04c4b8d19a38404ee5d4b3229">omlc_inject_metadata</a>(<a class="code" href="structmp.html">mp</a>, <span class="stringliteral">&quot;k2&quot;</span>, &amp;v[0], <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012a42b33eb7c21f79727a894a530a05b559">OML_STRING_VALUE</a>, <span class="stringliteral">&quot;blob&quot;</span>);</div>
<div class="line">  <a class="code" href="blobgen_8c.html#ae8130ac74a8b5d1d8276c99a284d3cd5">meta_to_file</a>(<span class="stringliteral">&quot;k2&quot;</span>, <span class="stringliteral">&quot;v2&quot;</span>, <span class="stringliteral">&quot;blobmp&quot;</span>, <span class="stringliteral">&quot;blob&quot;</span>);</div>
<div class="line">  <a class="code" href="api_8c.html#a8c8205b04c4b8d19a38404ee5d4b3229">omlc_inject_metadata</a>(<a class="code" href="structmp.html">mp</a>, <span class="stringliteral">&quot;k1&quot;</span>, &amp;v[0], <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012a42b33eb7c21f79727a894a530a05b559">OML_STRING_VALUE</a>, NULL);</div>
<div class="line">  <a class="code" href="blobgen_8c.html#ae8130ac74a8b5d1d8276c99a284d3cd5">meta_to_file</a>(<span class="stringliteral">&quot;k1&quot;</span>, <span class="stringliteral">&quot;v2&quot;</span>, <span class="stringliteral">&quot;blobmp&quot;</span>, NULL);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="omlc_8h.html#a1434bd8b5a841357336609930bdb05c3">omlc_reset_string</a>(v[0]);</div>
<div class="line">  <a class="code" href="omlc_8h.html#afd4a7d8b9b3f9c09228329b443e07afd">omlc_reset_blob</a>(v[2]);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7c09e0e3975a6025576f1d9bd4db63e4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int write_blob_bin </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>blob</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="blobgen_8c_source.html#l00076">76</a> of file <a class="el" href="blobgen_8c_source.html">blobgen.c</a>.</p>

<p>Referenced by <a class="el" href="blobgen_8c_source.html#l00100">blob_to_file()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> write (fd, blob, n);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a081bd9459ad15e187610450c7e1f5e78"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int write_blob_hex </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>blob</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="blobgen_8c_source.html#l00082">82</a> of file <a class="el" href="blobgen_8c_source.html">blobgen.c</a>.</p>

<p>Referenced by <a class="el" href="blobgen_8c_source.html#l00100">blob_to_file()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span> hex [] = <span class="stringliteral">&quot;0123456789ABCDEF&quot;</span>;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;</div>
<div class="line">  uint8_t *hexblob = malloc (2 * n);</div>
<div class="line">  <span class="keywordtype">int</span> result = 0;</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {</div>
<div class="line">    uint8_t *nybbles = (uint8_t*)hexblob + 2 * i;</div>
<div class="line">    uint8_t *data = (uint8_t*)blob + i;</div>
<div class="line">    nybbles[0] = hex[(*data &gt;&gt; 4) &amp; 0xF];</div>
<div class="line">    nybbles[1] = hex[*data &amp; 0xF];</div>
<div class="line">  }</div>
<div class="line">  result = write (fd, hexblob, 2 * n);</div>
<div class="line">  free (hexblob);</div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<h2>Variable Documentation</h2>
<a class="anchor" id="a8f5ec90394e42efb227d03ce038b0377"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOmlMP.html">OmlMP</a>* <a class="el" href="structmp.html">mp</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="blobgen_8c_source.html#l00165">165</a> of file <a class="el" href="blobgen_8c_source.html">blobgen.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2e48d05a30e5baae3312f63532cd9c21"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct poptOption options[]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"> {</div>
<div class="line">  POPT_AUTOHELP</div>
<div class="line">  { <span class="stringliteral">&quot;long&quot;</span>, <span class="charliteral">&#39;l&#39;</span>, POPT_ARG_NONE, &amp;longblob, 0, <span class="stringliteral">&quot;Generate long blobs (&gt; 64KiB)&quot;</span>, NULL},</div>
<div class="line">  { <span class="stringliteral">&quot;fixed&quot;</span>, <span class="charliteral">&#39;f&#39;</span>, POPT_ARG_INT, &amp;fixed_size, 0, <span class="stringliteral">&quot;Used fixed size blobs&quot;</span>, <span class="stringliteral">&quot;SIZE&quot;</span> },</div>
<div class="line">  { <span class="stringliteral">&quot;samples&quot;</span>, <span class="charliteral">&#39;n&#39;</span>, POPT_ARG_INT, &amp;samples, 0, <span class="stringliteral">&quot;Number of samples to generate. Default=forever&quot;</span>, <span class="stringliteral">&quot;SAMPLES&quot;</span>},</div>
<div class="line">  { <span class="stringliteral">&quot;hex&quot;</span>, <span class="charliteral">&#39;h&#39;</span>, POPT_ARG_NONE, &amp;hex, 0, <span class="stringliteral">&quot;Generate HEX file output instead of binary&quot;</span>, NULL},</div>
<div class="line">  { <span class="stringliteral">&quot;interval&quot;</span>, <span class="charliteral">&#39;i&#39;</span>, POPT_ARG_INT, &amp;interval, 0, <span class="stringliteral">&quot;Interval between tuple generation [ms]&quot;</span>, NULL},</div>
<div class="line">  { <span class="stringliteral">&quot;quiet&quot;</span>, <span class="charliteral">&#39;q&#39;</span>, POPT_ARG_NONE, &amp;quiet, 0, <span class="stringliteral">&quot;If set, don&#39;t print&quot;</span>, NULL},</div>
<div class="line">  { NULL, 0, 0, NULL, 0, NULL, NULL }</div>
<div class="line">}</div>
</div><!-- fragment -->
<p>Definition at line <a class="el" href="blobgen_8c_source.html#l00034">34</a> of file <a class="el" href="blobgen_8c_source.html">blobgen.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_13e138d54eb8818da29c3992edef070a.html">test</a></li><li class="navelem"><a class="el" href="dir_d6e0b434a1e4084fe65e99ac6ef67606.html">system</a></li><li class="navelem"><a class="el" href="blobgen_8c.html">blobgen.c</a></li>
    <li class="footer">Generated on Thu Jun 25 2015 15:31:54 for oml2 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
