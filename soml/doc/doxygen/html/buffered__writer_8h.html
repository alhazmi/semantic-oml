<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>oml2: buffered_writer.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="oml_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">oml2
   &#160;<span id="projectnumber">2.12.0pre.79-58cf-dirty</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('buffered__writer_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">buffered_writer.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="oml__out__stream_8h_source.html">oml2/oml_out_stream.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="oml__writer_8h_source.html">oml2/oml_writer.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="mbuf_8h_source.html">mbuf.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for buffered_writer.h:</div>
<div class="dyncontent">
<div class="center"><img src="buffered__writer_8h__incl.png" border="0" usemap="#buffered__writer_8h" alt=""/></div>
<map name="buffered__writer_8h" id="buffered__writer_8h">
<area shape="rect" id="node3" href="oml__out__stream_8h.html" title="Abstract interface for output streams." alt="" coords="5,83,163,112"/><area shape="rect" id="node7" href="oml__writer_8h.html" title="Abstract interface for writers." alt="" coords="245,83,371,112"/><area shape="rect" id="node26" href="mbuf_8h.html" title="mbuf.h" alt="" coords="145,160,207,189"/><area shape="rect" id="node9" href="omlc_8h.html" title="Public API of the OML client library." alt="" coords="319,160,412,189"/><area shape="rect" id="node22" href="o__log_8h.html" title="ocomm/o_log.h" alt="" coords="476,237,585,267"/></map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="buffered__writer_8h__dep__incl.png" border="0" usemap="#buffered__writer_8hdep" alt=""/></div>
<map name="buffered__writer_8hdep" id="buffered__writer_8hdep">
<area shape="rect" id="node3" href="api_8c.html" title="Implement the user&#45;visible API of OML." alt="" coords="5,83,56,112"/><area shape="rect" id="node5" href="bin__writer_8c.html" title="An implementation of the OmlWriter interface functions (see oml2/oml_writer.h) that writes messages u..." alt="" coords="80,83,168,112"/><area shape="rect" id="node7" href="buffered__writer_8c.html" title="A non&#45;blocking, self&#45;draining FIFO queue using threads." alt="" coords="192,83,309,112"/><area shape="rect" id="node9" href="text__writer_8c.html" title="An implementation of the OmlWriter interface functions (see oml2/oml_writer.h) that serializes measur..." alt="" coords="333,83,427,112"/></map>
</div>
</div>
<p><a href="buffered__writer_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a6c7b6e2449b53ddc1281283affe6f728"><td class="memItemLeft" align="right" valign="top">typedef void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3a51495a6deaf2674098b9e0d61a35cf"><td class="memItemLeft" align="right" valign="top"><a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffered__writer_8h.html#a3a51495a6deaf2674098b9e0d61a35cf">bw_create</a> (<a class="el" href="structOmlOutStream.html">OmlOutStream</a> *outStream, long queueCapacity, long chainSize)</td></tr>
<tr class="memitem:a90784ae73efa5b57d70d55fc138bb01e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffered__writer_8h.html#a90784ae73efa5b57d70d55fc138bb01e">bw_close</a> (<a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a> instance)</td></tr>
<tr class="memitem:ad5fdd44c102c8224b0da00cc1b74c6d7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffered__writer_8h.html#ad5fdd44c102c8224b0da00cc1b74c6d7">bw_push</a> (<a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a> instance, uint8_t *data, size_t size)</td></tr>
<tr class="memitem:a803be524a17411415aa746d3e530314c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffered__writer_8h.html#a803be524a17411415aa746d3e530314c">_bw_push</a> (<a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a> instance, uint8_t *data, size_t size)</td></tr>
<tr class="memitem:a340954ddbe7cb9a0fa2fffb55f833756"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffered__writer_8h.html#a340954ddbe7cb9a0fa2fffb55f833756">bw_push_meta</a> (<a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a> instance, uint8_t *data, size_t size)</td></tr>
<tr class="memitem:a9d52a2dcbf537e5016bdd44ac2213009"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffered__writer_8h.html#a9d52a2dcbf537e5016bdd44ac2213009">_bw_push_meta</a> (<a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a> instance, uint8_t *data, size_t size)</td></tr>
<tr class="memitem:aa930114cedda627a64814995fcb8e594"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffered__writer_8h.html#aa930114cedda627a64814995fcb8e594">bw_msgcount_add</a> (<a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a> instance, int nmessages)</td></tr>
<tr class="memitem:ab71dac6af457bb451eb7bc8e5ea2071c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffered__writer_8h.html#ab71dac6af457bb451eb7bc8e5ea2071c">bw_msgcount_reset</a> (<a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a> instance)</td></tr>
<tr class="memitem:a3607c79d254a965b65617d7d75317569"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffered__writer_8h.html#a3607c79d254a965b65617d7d75317569">bw_nlost_reset</a> (<a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a> instance)</td></tr>
<tr class="memitem:a8ab3bcd67075871e97f247571741b600"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structMBuffer.html">MBuffer</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffered__writer_8h.html#a8ab3bcd67075871e97f247571741b600">bw_get_write_buf</a> (<a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a> instance, int exclusive)</td></tr>
<tr class="memitem:a2aab7df1fbebfba70a027e1e48fd43c1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buffered__writer_8h.html#a2aab7df1fbebfba70a027e1e48fd43c1">bw_unlock_buf</a> (<a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a> instance)</td></tr>
</table>
<h2>Typedef Documentation</h2>
<a class="anchor" id="a6c7b6e2449b53ddc1281283affe6f728"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void* <a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="buffered__writer_8h_source.html#l00021">21</a> of file <a class="el" href="buffered__writer_8h_source.html">buffered_writer.h</a>.</p>

</div>
</div>
<h2>Function Documentation</h2>
<a class="anchor" id="a803be524a17411415aa746d3e530314c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _bw_push </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a>&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add some data to the end of the queue (lock must be held).</p>
<p>This function is the same as bw_push except it assumes that the lock is already acquired.</p>
<p>Add some data to the end of the queue.This function tries to acquire the lock on the <a class="el" href="structBufferedWriter.html">BufferedWriter</a>, and releases it when done.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td><a class="el" href="structBufferedWriter.html">BufferedWriter</a> handle </td></tr>
    <tr><td class="paramname">data</td><td>Pointer to data to add </td></tr>
    <tr><td class="paramname">size</td><td>size of data </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if success, 0 otherwise</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="buffered__writer_8h.html#a803be524a17411415aa746d3e530314c">_bw_push</a> </dd></dl>
</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="buffered__writer_8h.html#ad5fdd44c102c8224b0da00cc1b74c6d7">bw_push</a> </dd></dl>

<p>Definition at line <a class="el" href="buffered__writer_8c_source.html#l00232">232</a> of file <a class="el" href="buffered__writer_8c_source.html">buffered_writer.c</a>.</p>

<p>References <a class="el" href="buffered__writer_8c_source.html#l00039">BufferChunk::mbuf</a>, <a class="el" href="mbuf_8c_source.html#l00155">mbuf_wr_remaining()</a>, and <a class="el" href="mbuf_8c_source.html#l00381">mbuf_write()</a>.</p>

<p>Referenced by <a class="el" href="buffered__writer_8c_source.html#l00211">bw_push()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structBufferedWriter.html">BufferedWriter</a>* <span class="keyword">self</span> = (<a class="code" href="structBufferedWriter.html">BufferedWriter</a>*)instance;</div>
<div class="line">  <span class="keywordflow">if</span> (!self-&gt;active) { <span class="keywordflow">return</span> 0; }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="structBufferChunk.html">BufferChunk</a>* chunk = <span class="keyword">self</span>-&gt;writerChunk;</div>
<div class="line">  <span class="keywordflow">if</span> (chunk == NULL) { <span class="keywordflow">return</span> 0; }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="mbuf_8c.html#a6bb8514a1a3dd56456f64fb05dc4b334">mbuf_wr_remaining</a>(chunk-&gt;<a class="code" href="structBufferChunk.html#a6ab77302c97df6605e0c583fbca50093">mbuf</a>) &lt; size) {</div>
<div class="line">    chunk = getNextWriteChunk(<span class="keyword">self</span>, chunk);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="mbuf_8c.html#acb5cd36b259b0df7a3173259835dbba0">mbuf_write</a>(chunk-&gt;<a class="code" href="structBufferChunk.html#a6ab77302c97df6605e0c583fbca50093">mbuf</a>, data, size) &lt; 0) {</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_cond_signal(&amp;self-&gt;semaphore);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9d52a2dcbf537e5016bdd44ac2213009"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _bw_push_meta </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a>&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add some data to the end of the header buffer (lock must be held).</p>
<p>This function is the same as bw_push_meta except it assumes that the lock is already acquired.</p>
<p>Add some data to the end of the header buffer.This function tries to acquire the lock on the <a class="el" href="structBufferedWriter.html">BufferedWriter</a>, and releases it when done.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td><a class="el" href="structBufferedWriter.html">BufferedWriter</a> handle </td></tr>
    <tr><td class="paramname">data</td><td>Pointer to data to add </td></tr>
    <tr><td class="paramname">size</td><td>size of data </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if success, 0 otherwise</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="buffered__writer_8h.html#a9d52a2dcbf537e5016bdd44ac2213009">_bw_push_meta</a> </dd></dl>
</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="buffered__writer_8h.html#a340954ddbe7cb9a0fa2fffb55f833756">bw_push_meta</a> </dd></dl>

<p>Definition at line <a class="el" href="buffered__writer_8c_source.html#l00288">288</a> of file <a class="el" href="buffered__writer_8c_source.html">buffered_writer.c</a>.</p>

<p>References <a class="el" href="mbuf_8c_source.html#l00381">mbuf_write()</a>.</p>

<p>Referenced by <a class="el" href="buffered__writer_8c_source.html#l00266">bw_push_meta()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structBufferedWriter.html">BufferedWriter</a>* <span class="keyword">self</span> = (<a class="code" href="structBufferedWriter.html">BufferedWriter</a>*)instance;</div>
<div class="line">  <span class="keywordtype">int</span> result = 0;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (!self-&gt;active) { <span class="keywordflow">return</span> 0; }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="mbuf_8c.html#acb5cd36b259b0df7a3173259835dbba0">mbuf_write</a>(self-&gt;meta_buf, data, size) &gt; 0) {</div>
<div class="line">    result = 1;</div>
<div class="line">    <span class="comment">/* XXX: There is no point in signalling the semaphore as the</span></div>
<div class="line"><span class="comment">     * writer will not be able to do anything with the new data.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * Also, it puts everything in a deadlock otherwise */</span></div>
<div class="line">    <span class="comment">/* pthread_cond_signal(&amp;self-&gt;semaphore); */</span></div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a90784ae73efa5b57d70d55fc138bb01e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bw_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a>&#160;</td>
          <td class="paramname"><em>instance</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Close an output stream and destroy the objects.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td>handle (i.e., pointer) to a <a class="el" href="structBufferedWriter.html">BufferedWriter</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="buffered__writer_8c_source.html#l00165">165</a> of file <a class="el" href="buffered__writer_8c_source.html">buffered_writer.c</a>.</p>

<p>References <a class="el" href="buffered__writer_8c_source.html#l00053">BufferedWriter::active</a>, <a class="el" href="log_8c_source.html#l00333">logdebug()</a>, <a class="el" href="log_8c_source.html#l00297">logerror()</a>, <a class="el" href="log_8c_source.html#l00321">loginfo()</a>, <a class="el" href="log_8c_source.html#l00309">logwarn()</a>, <a class="el" href="mem_8c_source.html#l00240">oml_free()</a>, <a class="el" href="misc_8c_source.html#l00052">oml_lock()</a>, and <a class="el" href="misc_8c_source.html#l00070">oml_unlock()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> *retval;</div>
<div class="line">  <a class="code" href="structBufferedWriter.html">BufferedWriter</a> *<span class="keyword">self</span> = (<a class="code" href="structBufferedWriter.html">BufferedWriter</a>*)instance;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(!<span class="keyword">self</span>) { <span class="keywordflow">return</span>; }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="client_8h.html#a861bb71000024af9ccc3f6b5fe9a9e43">oml_lock</a> (&amp;self-&gt;lock, __FUNCTION__)) { <span class="keywordflow">return</span>; }</div>
<div class="line">  <span class="keyword">self</span>-&gt;<a class="code" href="structBufferedWriter.html#a83e77ab1c1d9b5e6116ff907a5681e1a">active</a> = 0;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="log_8c.html#aea4dca1a8e24794377ba1bf45fbbfce8">loginfo</a> (<span class="stringliteral">&quot;%s: Waiting for buffered queue thread to drain...\n&quot;</span>, self-&gt;outStream-&gt;dest);</div>
<div class="line"></div>
<div class="line">  pthread_cond_signal (&amp;self-&gt;semaphore);</div>
<div class="line">  <a class="code" href="client_8h.html#ab63adbadcb0c3da575b790cfebfe99b3">oml_unlock</a> (&amp;self-&gt;lock, __FUNCTION__);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(pthread_join (self-&gt;readerThread, (<span class="keywordtype">void</span>**)&amp;retval)) {</div>
<div class="line">    <a class="code" href="log_8c.html#ac65b3f90d3228474368b2b48a488cd44">logwarn</a> (<span class="stringliteral">&quot;%s: Cannot join buffered queue reader thread: %s\n&quot;</span>,</div>
<div class="line">        self-&gt;outStream-&gt;dest, strerror(errno));</div>
<div class="line"></div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">if</span> (1 == *retval) {</div>
<div class="line">      <a class="code" href="log_8c.html#a1db1902215b0897e1ec8c2a8766465b2">logdebug</a> (<span class="stringliteral">&quot;%s: Buffered queue fully drained\n&quot;</span>, self-&gt;outStream-&gt;dest);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a> (<span class="stringliteral">&quot;%s: Buffered queue did not fully drain\n&quot;</span>,</div>
<div class="line">          self-&gt;outStream-&gt;dest, *retval);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keyword">self</span>-&gt;outStream-&gt;close(self-&gt;outStream);</div>
<div class="line">  destroyBufferChain(<span class="keyword">self</span>);</div>
<div class="line">  <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(<span class="keyword">self</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3a51495a6deaf2674098b9e0d61a35cf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a> bw_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOmlOutStream.html">OmlOutStream</a> *&#160;</td>
          <td class="paramname"><em>outStream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>queueCapacity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>chunkSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a <a class="el" href="structBufferedWriter.html">BufferedWriter</a> instance</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">outStream</td><td>opaque <a class="el" href="structOmlOutStream.html">OmlOutStream</a> handler </td></tr>
    <tr><td class="paramname">queueCapacity</td><td>maximal size [B] of the internal queue queueCapaity/chunkSize will be used (at least 2) </td></tr>
    <tr><td class="paramname">chunkSize</td><td>size [B] of buffer space allocated at a time, set to 0 for default (DEF_CHAIN_BUFFER_SIZE) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>an instance pointer if successful, NULL otherwise</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="buffered__writer_8c.html#a1ba56efdf7f410e622c731d75e19fff3">DEF_CHAIN_BUFFER_SIZE</a> </dd></dl>

<p>Definition at line <a class="el" href="buffered__writer_8c_source.html#l00108">108</a> of file <a class="el" href="buffered__writer_8c_source.html">buffered_writer.c</a>.</p>

<p>References <a class="el" href="buffered__writer_8c_source.html#l00030">DEF_CHAIN_BUFFER_SIZE</a>, <a class="el" href="log_8c_source.html#l00333">logdebug()</a>, <a class="el" href="mbuf_8c_source.html#l00043">mbuf_create()</a>, <a class="el" href="mem_8c_source.html#l00240">oml_free()</a>, and <a class="el" href="mem_8c_source.html#l00157">oml_malloc()</a>.</p>

<p>Referenced by <a class="el" href="bin__writer_8c_source.html#l00091">bin_writer_new()</a>, and <a class="el" href="text__writer_8c_source.html#l00083">text_writer_new()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">long</span> nchunks;</div>
<div class="line">  <a class="code" href="structBufferedWriter.html">BufferedWriter</a>* <span class="keyword">self</span> = NULL;</div>
<div class="line"></div>
<div class="line">  assert(outStream&gt;=0);</div>
<div class="line">  assert(queueCapacity&gt;=0);</div>
<div class="line">  assert(chunkSize&gt;=0);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>((<span class="keyword">self</span> = (<a class="code" href="structBufferedWriter.html">BufferedWriter</a>*)<a class="code" href="omlc_8h.html#a8616cb714d6589098267bba8fc7b48c2">oml_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structBufferedWriter.html">BufferedWriter</a>)))) {</div>
<div class="line">    memset(<span class="keyword">self</span>, 0, <span class="keyword">sizeof</span>(<a class="code" href="structBufferedWriter.html">BufferedWriter</a>));</div>
<div class="line"></div>
<div class="line">    <span class="keyword">self</span>-&gt;outStream = outStream;</div>
<div class="line">    <span class="comment">/* This forces a &#39;connected&#39; INFO message upon first connection */</span></div>
<div class="line">    <span class="keyword">self</span>-&gt;backoff = 1;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">self</span>-&gt;bufSize = chunkSize &gt; 0 ? chunkSize : <a class="code" href="buffered__writer_8c.html#a1ba56efdf7f410e622c731d75e19fff3">DEF_CHAIN_BUFFER_SIZE</a>;</div>
<div class="line"></div>
<div class="line">    nchunks = queueCapacity / <span class="keyword">self</span>-&gt;bufSize;</div>
<div class="line">    <span class="keyword">self</span>-&gt;unallocatedBuffers = (nchunks &gt; 2) ? nchunks : 2; <span class="comment">/* at least two chunks */</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="log_8c.html#a1db1902215b0897e1ec8c2a8766465b2">logdebug</a> (<span class="stringliteral">&quot;%s: Buffer size %dB (%d chunks of %dB)\n&quot;</span>,</div>
<div class="line">        self-&gt;outStream-&gt;dest,</div>
<div class="line">        self-&gt;unallocatedBuffers*self-&gt;bufSize,</div>
<div class="line">        self-&gt;unallocatedBuffers, self-&gt;bufSize);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(NULL == (self-&gt;writerChunk = self-&gt;firstChunk = createBufferChunk(<span class="keyword">self</span>))) {</div>
<div class="line">      <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(<span class="keyword">self</span>);</div>
<div class="line">      <span class="keyword">self</span> = NULL;</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(NULL == (self-&gt;meta_buf = <a class="code" href="mbuf_8c.html#a765ec3ef2a50e81e94bdbde95973e362">mbuf_create</a>())) {</div>
<div class="line">      destroyBufferChain(<span class="keyword">self</span>);</div>
<div class="line">      <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(<span class="keyword">self</span>);</div>
<div class="line">      <span class="keyword">self</span> = NULL;</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">/* Initialize mutex and condition variable objects */</span></div>
<div class="line">      pthread_cond_init(&amp;self-&gt;semaphore, NULL);</div>
<div class="line">      pthread_mutex_init(&amp;self-&gt;lock, NULL);</div>
<div class="line"></div>
<div class="line">      <span class="comment">/* Initialize and set thread detached attribute */</span></div>
<div class="line">      pthread_attr_t tattr;</div>
<div class="line">      pthread_attr_init(&amp;tattr);</div>
<div class="line">      pthread_attr_setdetachstate(&amp;tattr, PTHREAD_CREATE_JOINABLE);</div>
<div class="line">      <span class="keyword">self</span>-&gt;active = 1;</div>
<div class="line">      pthread_create(&amp;self-&gt;readerThread, &amp;tattr, threadStart, (<span class="keywordtype">void</span>*)<span class="keyword">self</span>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> (<a class="code" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a>)<span class="keyword">self</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8ab3bcd67075871e97f247571741b600"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structMBuffer.html">MBuffer</a>* bw_get_write_buf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a>&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>exclusive</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return an <a class="el" href="structMBuffer.html">MBuffer</a> with (optional) exclusive write access</p>
<p>If exclusive access is required, the caller is in charge of releasing the lock with bw_unlock_buf.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td><a class="el" href="structBufferedWriter.html">BufferedWriter</a> handle </td></tr>
    <tr><td class="paramname">exclusive</td><td>indicate whether the entire <a class="el" href="structBufferedWriter.html">BufferedWriter</a> should be locked</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>an <a class="el" href="structMBuffer.html">MBuffer</a> instance if success to write in, NULL otherwise </dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="buffered__writer_8h.html#a2aab7df1fbebfba70a027e1e48fd43c1">bw_unlock_buf</a> </dd></dl>

<p>Definition at line <a class="el" href="buffered__writer_8c_source.html#l00365">365</a> of file <a class="el" href="buffered__writer_8c_source.html">buffered_writer.c</a>.</p>

<p>References <a class="el" href="buffered__writer_8c_source.html#l00039">BufferChunk::mbuf</a>, <a class="el" href="mbuf_8c_source.html#l00203">mbuf_write_offset()</a>, <a class="el" href="misc_8c_source.html#l00052">oml_lock()</a>, <a class="el" href="misc_8c_source.html#l00070">oml_unlock()</a>, and <a class="el" href="buffered__writer_8c_source.html#l00041">BufferChunk::targetBufSize</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structBufferedWriter.html">BufferedWriter</a>* <span class="keyword">self</span> = (<a class="code" href="structBufferedWriter.html">BufferedWriter</a>*)instance;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="client_8h.html#a861bb71000024af9ccc3f6b5fe9a9e43">oml_lock</a>(&amp;self-&gt;lock, __FUNCTION__)) { <span class="keywordflow">return</span> 0; }</div>
<div class="line">  <span class="keywordflow">if</span> (!self-&gt;active) { <span class="keywordflow">return</span> 0; }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="structBufferChunk.html">BufferChunk</a>* chunk = <span class="keyword">self</span>-&gt;writerChunk;</div>
<div class="line">  <span class="keywordflow">if</span> (chunk == NULL) { <span class="keywordflow">return</span> 0; }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="structMBuffer.html">MBuffer</a>* mbuf = chunk-&gt;<a class="code" href="structBufferChunk.html#a6ab77302c97df6605e0c583fbca50093">mbuf</a>;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="mbuf_8c.html#aca2b308379cb7bb52d20642811238a2c">mbuf_write_offset</a>(mbuf) &gt;= chunk-&gt;<a class="code" href="structBufferChunk.html#a95cfe55eee06c492ee8147acfc034e67">targetBufSize</a>) {</div>
<div class="line">    chunk = getNextWriteChunk(<span class="keyword">self</span>, chunk);</div>
<div class="line">    mbuf = chunk-&gt;<a class="code" href="structBufferChunk.html#a6ab77302c97df6605e0c583fbca50093">mbuf</a>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (! exclusive) {</div>
<div class="line">    <a class="code" href="client_8h.html#ab63adbadcb0c3da575b790cfebfe99b3">oml_unlock</a>(&amp;self-&gt;lock, __FUNCTION__);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> mbuf;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa930114cedda627a64814995fcb8e594"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bw_msgcount_add </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a>&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nmessages</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Count the addition (or deletion) of a full message in the current <a class="el" href="structBufferChunk.html">BufferChunk</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td><a class="el" href="structBufferedWriter.html">BufferedWriter</a> handle </td></tr>
    <tr><td class="paramname">nmessages</td><td>number of messages to count (can be negative)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the (new) current number of messages in the current writer <a class="el" href="structBufferChunk.html">BufferChunk</a></dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="buffered__writer_8h.html#ab71dac6af457bb451eb7bc8e5ea2071c">bw_msgcount_reset</a>, <a class="el" href="buffered__writer_8h.html#a3607c79d254a965b65617d7d75317569">bw_nlost_reset</a> </dd></dl>

<p>Definition at line <a class="el" href="buffered__writer_8c_source.html#l00316">316</a> of file <a class="el" href="buffered__writer_8c_source.html">buffered_writer.c</a>.</p>

<p>References <a class="el" href="buffered__writer_8c_source.html#l00046">BufferChunk::nmessages</a>, and <a class="el" href="buffered__writer_8c_source.html#l00064">BufferedWriter::writerChunk</a>.</p>
<div class="fragment"><div class="line">                                                           {</div>
<div class="line">  <a class="code" href="structBufferedWriter.html">BufferedWriter</a>* <span class="keyword">self</span> = (<a class="code" href="structBufferedWriter.html">BufferedWriter</a>*)instance;</div>
<div class="line">  <span class="keyword">self</span>-&gt;<a class="code" href="structBufferedWriter.html#a9f2e1e5dd138e56cf8a55f268eb46a40">writerChunk</a>-&gt;<a class="code" href="structBufferChunk.html#ab3bf73ed87453ddfda7ae787e5d7e7d1">nmessages</a> += 1;</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;writerChunk-&gt;nmessages;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab71dac6af457bb451eb7bc8e5ea2071c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bw_msgcount_reset </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a>&#160;</td>
          <td class="paramname"><em>instance</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset the message count in the current <a class="el" href="structBufferChunk.html">BufferChunk</a> and return its previous value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td><a class="el" href="structBufferedWriter.html">BufferedWriter</a> handle</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the number of messages in the current writer <a class="el" href="structBufferChunk.html">BufferChunk</a> before resetting</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="buffered__writer_8h.html#aa930114cedda627a64814995fcb8e594">bw_msgcount_add</a>, <a class="el" href="buffered__writer_8h.html#a3607c79d254a965b65617d7d75317569">bw_nlost_reset</a> </dd></dl>

<p>Definition at line <a class="el" href="buffered__writer_8c_source.html#l00331">331</a> of file <a class="el" href="buffered__writer_8c_source.html">buffered_writer.c</a>.</p>

<p>References <a class="el" href="buffered__writer_8c_source.html#l00046">BufferChunk::nmessages</a>, and <a class="el" href="buffered__writer_8c_source.html#l00064">BufferedWriter::writerChunk</a>.</p>
<div class="fragment"><div class="line">                                              {</div>
<div class="line">  <a class="code" href="structBufferedWriter.html">BufferedWriter</a>* <span class="keyword">self</span> = (<a class="code" href="structBufferedWriter.html">BufferedWriter</a>*)instance;</div>
<div class="line">  <span class="keywordtype">int</span> n = <span class="keyword">self</span>-&gt;<a class="code" href="structBufferedWriter.html#a9f2e1e5dd138e56cf8a55f268eb46a40">writerChunk</a>-&gt;<a class="code" href="structBufferChunk.html#ab3bf73ed87453ddfda7ae787e5d7e7d1">nmessages</a>;</div>
<div class="line">  <span class="keyword">self</span>-&gt;writerChunk-&gt;nmessages = 0;</div>
<div class="line">  <span class="keywordflow">return</span> n;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3607c79d254a965b65617d7d75317569"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bw_nlost_reset </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a>&#160;</td>
          <td class="paramname"><em>instance</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset the number of messages lost by the <a class="el" href="structBufferedWriter.html">BufferedWriter</a> and return its previous value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td><a class="el" href="structBufferedWriter.html">BufferedWriter</a> handle</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the number of lost messages in the <a class="el" href="structBufferedWriter.html">BufferedWriter</a> before resetting</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="buffered__writer_8h.html#aa930114cedda627a64814995fcb8e594">bw_msgcount_add</a>, <a class="el" href="buffered__writer_8h.html#ab71dac6af457bb451eb7bc8e5ea2071c">bw_msgcount_reset</a> </dd></dl>

<p>Definition at line <a class="el" href="buffered__writer_8c_source.html#l00347">347</a> of file <a class="el" href="buffered__writer_8c_source.html">buffered_writer.c</a>.</p>

<p>References <a class="el" href="buffered__writer_8c_source.html#l00087">BufferedWriter::nlost</a>.</p>

<p>Referenced by <a class="el" href="api_8c_source.html#l00149">omlc_inject()</a>.</p>
<div class="fragment"><div class="line">                                           {</div>
<div class="line">  <a class="code" href="structBufferedWriter.html">BufferedWriter</a>* <span class="keyword">self</span> = (<a class="code" href="structBufferedWriter.html">BufferedWriter</a>*)instance;</div>
<div class="line">  <span class="keywordtype">int</span> n = <span class="keyword">self</span>-&gt;<a class="code" href="structBufferedWriter.html#a15aa4a14c2f5ebba380d8537fff8a614">nlost</a>;</div>
<div class="line">  <span class="keyword">self</span>-&gt;nlost = 0;</div>
<div class="line">  <span class="keywordflow">return</span> n;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad5fdd44c102c8224b0da00cc1b74c6d7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bw_push </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a>&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add some data to the end of the queue.</p>
<p>This function tries to acquire the lock on the <a class="el" href="structBufferedWriter.html">BufferedWriter</a>, and releases it when done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td><a class="el" href="structBufferedWriter.html">BufferedWriter</a> handle </td></tr>
    <tr><td class="paramname">data</td><td>Pointer to data to add </td></tr>
    <tr><td class="paramname">size</td><td>size of data </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if success, 0 otherwise</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="buffered__writer_8h.html#a803be524a17411415aa746d3e530314c">_bw_push</a> </dd></dl>

<p>Definition at line <a class="el" href="buffered__writer_8c_source.html#l00211">211</a> of file <a class="el" href="buffered__writer_8c_source.html">buffered_writer.c</a>.</p>

<p>References <a class="el" href="buffered__writer_8c_source.html#l00232">_bw_push()</a>, <a class="el" href="misc_8c_source.html#l00052">oml_lock()</a>, and <a class="el" href="misc_8c_source.html#l00070">oml_unlock()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> result = 0;</div>
<div class="line">  <a class="code" href="structBufferedWriter.html">BufferedWriter</a>* <span class="keyword">self</span> = (<a class="code" href="structBufferedWriter.html">BufferedWriter</a>*)instance;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="client_8h.html#a861bb71000024af9ccc3f6b5fe9a9e43">oml_lock</a>(&amp;self-&gt;lock, __FUNCTION__) == 0) {</div>
<div class="line">    result =<a class="code" href="buffered__writer_8c.html#a803be524a17411415aa746d3e530314c">_bw_push</a>(instance, data, size);</div>
<div class="line">    <a class="code" href="client_8h.html#ab63adbadcb0c3da575b790cfebfe99b3">oml_unlock</a>(&amp;self-&gt;lock, __FUNCTION__);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a340954ddbe7cb9a0fa2fffb55f833756"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bw_push_meta </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a>&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add some data to the end of the header buffer.</p>
<p>This function tries to acquire the lock on the <a class="el" href="structBufferedWriter.html">BufferedWriter</a>, and releases it when done.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td><a class="el" href="structBufferedWriter.html">BufferedWriter</a> handle </td></tr>
    <tr><td class="paramname">data</td><td>Pointer to data to add </td></tr>
    <tr><td class="paramname">size</td><td>size of data </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if success, 0 otherwise</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="buffered__writer_8h.html#a9d52a2dcbf537e5016bdd44ac2213009">_bw_push_meta</a> </dd></dl>

<p>Definition at line <a class="el" href="buffered__writer_8c_source.html#l00266">266</a> of file <a class="el" href="buffered__writer_8c_source.html">buffered_writer.c</a>.</p>

<p>References <a class="el" href="buffered__writer_8c_source.html#l00288">_bw_push_meta()</a>, <a class="el" href="misc_8c_source.html#l00052">oml_lock()</a>, and <a class="el" href="misc_8c_source.html#l00070">oml_unlock()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> result = 0;</div>
<div class="line">  <a class="code" href="structBufferedWriter.html">BufferedWriter</a>* <span class="keyword">self</span> = (<a class="code" href="structBufferedWriter.html">BufferedWriter</a>*)instance;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="client_8h.html#a861bb71000024af9ccc3f6b5fe9a9e43">oml_lock</a>(&amp;self-&gt;lock, __FUNCTION__) == 0) {</div>
<div class="line">    result = <a class="code" href="buffered__writer_8c.html#a9d52a2dcbf537e5016bdd44ac2213009">_bw_push_meta</a>(instance, data, size);</div>
<div class="line">    <a class="code" href="client_8h.html#ab63adbadcb0c3da575b790cfebfe99b3">oml_unlock</a>(&amp;self-&gt;lock, __FUNCTION__);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2aab7df1fbebfba70a027e1e48fd43c1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bw_unlock_buf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="buffered__writer_8h.html#a6c7b6e2449b53ddc1281283affe6f728">BufferedWriterHdl</a>&#160;</td>
          <td class="paramname"><em>instance</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return and unlock <a class="el" href="structMBuffer.html">MBuffer</a> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td><a class="el" href="structBufferedWriter.html">BufferedWriter</a> handle for which a buffer was previously obtained through bw_get_write_buf</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="buffered__writer_8h.html#a8ab3bcd67075871e97f247571741b600">bw_get_write_buf</a> </dd></dl>

<p>Definition at line <a class="el" href="buffered__writer_8c_source.html#l00392">392</a> of file <a class="el" href="buffered__writer_8c_source.html">buffered_writer.c</a>.</p>

<p>References <a class="el" href="misc_8c_source.html#l00070">oml_unlock()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structBufferedWriter.html">BufferedWriter</a>* <span class="keyword">self</span> = (<a class="code" href="structBufferedWriter.html">BufferedWriter</a>*)instance;</div>
<div class="line">  pthread_cond_signal(&amp;self-&gt;semaphore); <span class="comment">/* assume we locked for a reason */</span></div>
<div class="line">  <a class="code" href="client_8h.html#ab63adbadcb0c3da575b790cfebfe99b3">oml_unlock</a>(&amp;self-&gt;lock, __FUNCTION__);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_faf4e77b1ae3fad210f246d6190ea8fa.html">client</a></li><li class="navelem"><a class="el" href="buffered__writer_8h.html">buffered_writer.h</a></li>
    <li class="footer">Generated on Thu Jun 25 2015 15:31:54 for oml2 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
