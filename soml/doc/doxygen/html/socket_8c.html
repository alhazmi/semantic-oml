<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>oml2: socket.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="oml_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">oml2
   &#160;<span id="projectnumber">2.12.0pre.79-58cf-dirty</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('socket_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">socket.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>OComm <a class="el" href="structSocket.html">Socket</a> (OSocket) are a thin abstraction layer that manages sockets and provides some additional state management functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;assert.h&gt;</code><br/>
<code>#include &lt;sys/timeb.h&gt;</code><br/>
<code>#include &lt;sys/stat.h&gt;</code><br/>
<code>#include &lt;netdb.h&gt;</code><br/>
<code>#include &lt;sys/socket.h&gt;</code><br/>
<code>#include &lt;netinet/in.h&gt;</code><br/>
<code>#include &lt;arpa/inet.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;sys/ioctl.h&gt;</code><br/>
<code>#include &lt;net/if.h&gt;</code><br/>
<code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="mem_8h_source.html">mem.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="o__log_8h_source.html">ocomm/o_log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="o__socket_8h_source.html">ocomm/o_socket.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="o__eventloop_8h_source.html">ocomm/o_eventloop.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for socket.c:</div>
<div class="dyncontent">
<div class="center"><img src="socket_8c__incl.png" border="0" usemap="#socket_8c" alt=""/></div>
<map name="socket_8c" id="socket_8c">
<area shape="rect" id="node35" href="mem_8h.html" title="mem.h" alt="" coords="701,83,763,112"/><area shape="rect" id="node40" href="o__log_8h.html" title="ocomm/o_log.h" alt="" coords="789,160,899,189"/><area shape="rect" id="node45" href="o__socket_8h.html" title="Header file for the OComm Socket library. OSockets are a thin abstraction layer that manages sockets ..." alt="" coords="360,160,493,189"/><area shape="rect" id="node52" href="o__eventloop_8h.html" title="ocomm/o_eventloop.h" alt="" coords="427,83,576,112"/></map>
</div>
</div>
<p><a href="socket_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structSocketInt.html">SocketInt</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aa8cecfc5c5c054d2875c03e77b7be15d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>&#160;&#160;&#160;1</td></tr>
<tr class="memitem:aa93f0eb578d23995850d61f7d61c55c1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>&#160;&#160;&#160;!<a class="el" href="socket_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></td></tr>
<tr class="memitem:a5a4ce614ee179a0ebd2506ec4f3204db"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#a5a4ce614ee179a0ebd2506ec4f3204db">MAX_SOCKET_INSTANCES</a>&#160;&#160;&#160;100</td></tr>
<tr class="memitem:aaed8cc9d26720635595ffb924fd59ef0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#aaed8cc9d26720635595ffb924fd59ef0">HOSTLEN</a>&#160;&#160;&#160;256 /* RFC 1035, section 2.3.4 + 1 */</td></tr>
<tr class="memitem:a6d5639d1b3a0ddfb2d1bbe55e043f47e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#a6d5639d1b3a0ddfb2d1bbe55e043f47e">ADDRLEN</a>&#160;&#160;&#160;INET6_ADDRSTRLEN</td></tr>
<tr class="memitem:aad0a69646c2876fc69163b2fd45687bc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#aad0a69646c2876fc69163b2fd45687bc">SERVLEN</a>&#160;&#160;&#160;7   /* ndigits(65536) + 1          */</td></tr>
<tr class="memitem:adca79f28f3c02e346370ef2dfd14d7e9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#adca79f28f3c02e346370ef2dfd14d7e9">SOCKNAMELEN</a>&#160;&#160;&#160;(<a class="el" href="socket_8c.html#aaed8cc9d26720635595ffb924fd59ef0">HOSTLEN</a>+<a class="el" href="socket_8c.html#aad0a69646c2876fc69163b2fd45687bc">SERVLEN</a>+2)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a5a8d68fded380f8fd467b8de72e5f560"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structSocketInt.html">SocketInt</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#a5a8d68fded380f8fd467b8de72e5f560">SocketInt</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adac2005542e88cb32988ad200a07efbe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#adac2005542e88cb32988ad200a07efbe">socket_set_non_blocking_mode</a> (int flag)</td></tr>
<tr class="memitem:acdc0efd11459cc760edffeb252411a21"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#acdc0efd11459cc760edffeb252411a21">socket_get_non_blocking_mode</a> ()</td></tr>
<tr class="memitem:a0a63b81e5b680584ef77cfa64fea81fa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#a0a63b81e5b680584ef77cfa64fea81fa">socket_is_disconnected</a> (<a class="el" href="structSocket.html">Socket</a> *socket)</td></tr>
<tr class="memitem:ae17265b77d018590bf28698de8e479d1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#ae17265b77d018590bf28698de8e479d1">socket_is_listening</a> (<a class="el" href="structSocket.html">Socket</a> *socket)</td></tr>
<tr class="memitem:a1c0850933bb110c33fbdb774c0221904"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#a1c0850933bb110c33fbdb774c0221904">socket_free</a> (<a class="el" href="structSocket.html">Socket</a> *socket)</td></tr>
<tr class="memitem:aab9acfcfa5ad878f80b6f8e99cb5c8d2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structSocket.html">Socket</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#aab9acfcfa5ad878f80b6f8e99cb5c8d2">socket_new</a> (const char *<a class="el" href="check__text__protocol_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, int is_tcp)</td></tr>
<tr class="memitem:a5bef9ed18759eac55bcf4c4d766b689d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structSocket.html">Socket</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#a5bef9ed18759eac55bcf4c4d766b689d">socket_in_new</a> (const char *<a class="el" href="check__text__protocol_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, const char *node, const char *service, int is_tcp)</td></tr>
<tr class="memitem:af08f11ed507617aeb812ba35787b4184"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structSocket.html">Socket</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#af08f11ed507617aeb812ba35787b4184">socket_tcp_out_new</a> (const char *<a class="el" href="check__text__protocol_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, const char *dest, const char *service)</td></tr>
<tr class="memitem:a147759fb9e8c7fb90e7a793f9a03a625"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structSocket.html">Socket</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#a147759fb9e8c7fb90e7a793f9a03a625">socket_server_new</a> (const char *<a class="el" href="check__text__protocol_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, const char *node, const char *service, <a class="el" href="o__socket_8h.html#a411a99545d5d8d999bfea361d1fbabfd">o_so_connect_callback</a> callback, void *handle)</td></tr>
<tr class="memitem:a7dc3da0e474bbae9d8617d5fa06e81fb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#a7dc3da0e474bbae9d8617d5fa06e81fb">socket_shutdown</a> (<a class="el" href="structSocket.html">Socket</a> *socket)</td></tr>
<tr class="memitem:ab8e18bfbef40930e4e38a2e5b69801a2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#ab8e18bfbef40930e4e38a2e5b69801a2">socket_close</a> (<a class="el" href="structSocket.html">Socket</a> *socket)</td></tr>
<tr class="memitem:aac5112b86b80ead64713acbfcf628953"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#aac5112b86b80ead64713acbfcf628953">socket_sendto</a> (<a class="el" href="structSocket.html">Socket</a> *socket, char *buf, int buf_size)</td></tr>
<tr class="memitem:aa54d12c240e4f3990717cc3bfbd2d6fa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#aa54d12c240e4f3990717cc3bfbd2d6fa">socket_get_sockfd</a> (<a class="el" href="structSocket.html">Socket</a> *socket)</td></tr>
<tr class="memitem:aebc527809e7416fce7308e29074a3459"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#aebc527809e7416fce7308e29074a3459">socket_get_port</a> (<a class="el" href="structSocket.html">Socket</a> *s)</td></tr>
<tr class="memitem:a3d50bed513b50ad9c71190a9756c8e2b"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#a3d50bed513b50ad9c71190a9756c8e2b">socket_get_addr_sz</a> (<a class="el" href="structSocket.html">Socket</a> *s)</td></tr>
<tr class="memitem:a46c67aefa915928d4c5631c1abbe1958"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#a46c67aefa915928d4c5631c1abbe1958">socket_get_peer_addr</a> (<a class="el" href="structSocket.html">Socket</a> *s, char *addr, size_t addr_sz)</td></tr>
<tr class="memitem:a35686271081d7d60e07823ffee5a5e5f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#a35686271081d7d60e07823ffee5a5e5f">socket_get_name</a> (<a class="el" href="structSocket.html">Socket</a> *s, char *<a class="el" href="check__text__protocol_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, size_t <a class="el" href="headers_8c.html#aff1f5a73cc518a5f952f008b620af7f8">namelen</a>, int remote)</td></tr>
<tr class="memitem:a8025c352b2bddda3266e33c022cef8e9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="socket_8c.html#a8025c352b2bddda3266e33c022cef8e9">sockaddr_get_name</a> (const <a class="el" href="unionsockaddr__t.html">sockaddr_t</a> *sa, socklen_t sa_len, char *<a class="el" href="check__text__protocol_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, size_t <a class="el" href="headers_8c.html#aff1f5a73cc518a5f952f008b620af7f8">namelen</a>)</td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>OComm <a class="el" href="structSocket.html">Socket</a> (OSocket) are a thin abstraction layer that manages sockets and provides some additional state management functions. </p>
<p>Functions for managing a group of sockets as a unit. Internally maintains a linked list of sockets which can be modified at.</p>
<dl class="section author"><dt>Author</dt><dd>Max Ott (<a href="#" onclick="location.href='mai'+'lto:'+'max'+'@w'+'inl'+'ab'+'.ru'+'tg'+'ers'+'.e'+'du'; return false;">max@w<span style="display: none;">.nosp@m.</span>inla<span style="display: none;">.nosp@m.</span>b.rut<span style="display: none;">.nosp@m.</span>gers<span style="display: none;">.nosp@m.</span>.edu</a>), Olivier Mehani <a href="#" onclick="location.href='mai'+'lto:'+'oli'+'vi'+'er.'+'me'+'han'+'i@'+'nic'+'ta'+'.co'+'m.'+'au'; return false;">olivi<span style="display: none;">.nosp@m.</span>er.m<span style="display: none;">.nosp@m.</span>ehani<span style="display: none;">.nosp@m.</span>@nic<span style="display: none;">.nosp@m.</span>ta.co<span style="display: none;">.nosp@m.</span>m.au</a></dd></dl>

<p>Definition in file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>
</div><h2>Macro Definition Documentation</h2>
<a class="anchor" id="a6d5639d1b3a0ddfb2d1bbe55e043f47e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ADDRLEN&#160;&#160;&#160;INET6_ADDRSTRLEN</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="socket_8c_source.html#l00046">46</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>Referenced by <a class="el" href="socket_8c_source.html#l00707">sockaddr_get_name()</a>.</p>

</div>
</div>
<a class="anchor" id="aa93f0eb578d23995850d61f7d61c55c1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FALSE&#160;&#160;&#160;!<a class="el" href="socket_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="socket_8c_source.html#l00041">41</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

</div>
</div>
<a class="anchor" id="aaed8cc9d26720635595ffb924fd59ef0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HOSTLEN&#160;&#160;&#160;256 /* RFC 1035, section 2.3.4 + 1 */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="socket_8c_source.html#l00045">45</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5a4ce614ee179a0ebd2506ec4f3204db"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_SOCKET_INSTANCES&#160;&#160;&#160;100</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="socket_8c_source.html#l00044">44</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

</div>
</div>
<a class="anchor" id="aad0a69646c2876fc69163b2fd45687bc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SERVLEN&#160;&#160;&#160;7   /* ndigits(65536) + 1          */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="socket_8c_source.html#l00047">47</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>Referenced by <a class="el" href="socket_8c_source.html#l00707">sockaddr_get_name()</a>.</p>

</div>
</div>
<a class="anchor" id="adca79f28f3c02e346370ef2dfd14d7e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SOCKNAMELEN&#160;&#160;&#160;(<a class="el" href="socket_8c.html#aaed8cc9d26720635595ffb924fd59ef0">HOSTLEN</a>+<a class="el" href="socket_8c.html#aad0a69646c2876fc69163b2fd45687bc">SERVLEN</a>+2)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="socket_8c_source.html#l00048">48</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>Referenced by <a class="el" href="socket_8c_source.html#l00613">socket_get_addr_sz()</a>, and <a class="el" href="socket_8c_source.html#l00199">socket_in_new()</a>.</p>

</div>
</div>
<a class="anchor" id="aa8cecfc5c5c054d2875c03e77b7be15d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TRUE&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="socket_8c_source.html#l00038">38</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>Referenced by <a class="el" href="socket_8c_source.html#l00464">socket_server_new()</a>, and <a class="el" href="socket_8c_source.html#l00371">socket_tcp_out_new()</a>.</p>

</div>
</div>
<h2>Typedef Documentation</h2>
<a class="anchor" id="a5a8d68fded380f8fd467b8de72e5f560"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structSocketInt.html">SocketInt</a>  <a class="el" href="structSocketInt.html">SocketInt</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Implementation of the <a class="el" href="structSocket.html">Socket</a> interface store communication related parameters and information. </p>

</div>
</div>
<h2>Function Documentation</h2>
<a class="anchor" id="a8025c352b2bddda3266e33c022cef8e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sockaddr_get_name </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="unionsockaddr__t.html">sockaddr_t</a> *&#160;</td>
          <td class="paramname"><em>sa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">socklen_t&#160;</td>
          <td class="paramname"><em>sa_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>namelen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the name (address+service) of a socket.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sa</td><td><a class="el" href="unionsockaddr__t.html">sockaddr_t</a> containig the data </td></tr>
    <tr><td class="paramname">sa_len</td><td>length of sa </td></tr>
    <tr><td class="paramname">name</td><td>memory buffer to return the string in (nil-terminated) </td></tr>
    <tr><td class="paramname">namelen</td><td>length of nam, SOCKNAMELEN is a good idea</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="socket_8c.html#a35686271081d7d60e07823ffee5a5e5f">socket_get_name</a>, getnameinfo(3) </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00707">707</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="socket_8c_source.html#l00046">ADDRLEN</a>, <a class="el" href="log_8c_source.html#l00048">o_log</a>, <a class="el" href="o__log_8h_source.html#l00026">O_LOG_DEBUG</a>, <a class="el" href="o__socket_8h_source.html#l00054">sockaddr_t::sa</a>, and <a class="el" href="socket_8c_source.html#l00047">SERVLEN</a>.</p>

<p>Referenced by <a class="el" href="socket_8c_source.html#l00664">socket_get_name()</a>, and <a class="el" href="socket_8c_source.html#l00199">socket_in_new()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span> host[<a class="code" href="socket_8c.html#a6d5639d1b3a0ddfb2d1bbe55e043f47e">ADDRLEN</a>], serv[<a class="code" href="socket_8c.html#aad0a69646c2876fc69163b2fd45687bc">SERVLEN</a>];</div>
<div class="line">  <span class="keywordtype">int</span> ret;</div>
<div class="line"></div>
<div class="line">  assert(sa);</div>
<div class="line">  assert(<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line"></div>
<div class="line">  *host = 0;</div>
<div class="line">  *serv = 0;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (!(ret=getnameinfo(&amp;sa-&gt;<a class="code" href="unionsockaddr__t.html#ac78dc4ea8ef63f47c60ea02a39d34548">sa</a>, sa_len,</div>
<div class="line">        host, <a class="code" href="socket_8c.html#a6d5639d1b3a0ddfb2d1bbe55e043f47e">ADDRLEN</a>, serv, <a class="code" href="socket_8c.html#aad0a69646c2876fc69163b2fd45687bc">SERVLEN</a>,</div>
<div class="line">        NI_NUMERICHOST|NI_NUMERICSERV))) {</div>
<div class="line">    snprintf(<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="headers_8c.html#aff1f5a73cc518a5f952f008b620af7f8">namelen</a>, <span class="stringliteral">&quot;[%s]:%s&quot;</span>, host, serv);</div>
<div class="line"></div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a9b68704e34b864d25ec14e9525083de2">O_LOG_DEBUG</a>, <span class="stringliteral">&quot;Error converting sockaddr %p to name: %s\n&quot;</span>, sa, gai_strerror(ret));</div>
<div class="line">    snprintf(<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="headers_8c.html#aff1f5a73cc518a5f952f008b620af7f8">namelen</a>, <span class="stringliteral">&quot;AF%d&quot;</span>, sa-&gt;<a class="code" href="unionsockaddr__t.html#ac78dc4ea8ef63f47c60ea02a39d34548">sa</a>.sa_family);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab8e18bfbef40930e4e38a2e5b69801a2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int socket_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSocket.html">Socket</a> *&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Close the communication channel associated to an OSocket. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">socket</td><td><a class="el" href="structSocket.html">Socket</a> to close </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 otherwise </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00507">507</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>Referenced by <a class="el" href="oml2-proxy-server_8c_source.html#l00081">client_callback()</a>, <a class="el" href="socket_8c_source.html#l00157">socket_free()</a>, and <a class="el" href="oml2-proxy-server_8c_source.html#l00114">status_callback()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structSocketInt.html">SocketInt</a> *<span class="keyword">self</span> = (<a class="code" href="structSocketInt.html">SocketInt</a>*)socket;</div>
<div class="line">  <span class="keywordflow">if</span> (self-&gt;sockfd &gt;= 0) {</div>
<div class="line">    close(self-&gt;sockfd);</div>
<div class="line">    <span class="comment">// TODO: should check if close suceeds</span></div>
<div class="line">    <span class="keyword">self</span>-&gt;sockfd = -1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1c0850933bb110c33fbdb774c0221904"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void socket_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSocket.html">Socket</a> *&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Terminate the <a class="el" href="structSocket.html">Socket</a> and free its allocated memory.</p>
<p>If the socket is still open, it will be closed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">socket</td><td><a class="el" href="structSocket.html">Socket</a> to free </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="socket_8c.html#aab9acfcfa5ad878f80b6f8e99cb5c8d2">socket_new</a>, <a class="el" href="socket_8c.html#ab8e18bfbef40930e4e38a2e5b69801a2">socket_close</a> </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00157">157</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="mem_8c_source.html#l00240">oml_free()</a>, and <a class="el" href="socket_8c_source.html#l00507">socket_close()</a>.</p>

<p>Referenced by <a class="el" href="proxy__client_8c_source.html#l00074">client_free()</a>, <a class="el" href="client__handler_8c_source.html#l00227">client_handler_free()</a>, <a class="el" href="oml2-proxy-server_8c_source.html#l00307">main()</a>, and <a class="el" href="socket_8c_source.html#l00199">socket_in_new()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structSocketInt.html">SocketInt</a>* <span class="keyword">self</span> = (<a class="code" href="structSocketInt.html">SocketInt</a> *)socket;</div>
<div class="line">  <a class="code" href="o__socket_8h.html#ab8e18bfbef40930e4e38a2e5b69801a2">socket_close</a>(socket);</div>
<div class="line">  <span class="keywordflow">if</span> (self-&gt;name) { <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(self-&gt;name); }</div>
<div class="line">  <span class="keywordflow">if</span> (self-&gt;dest) { <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(self-&gt;dest); }</div>
<div class="line">  <span class="keywordflow">if</span> (self-&gt;service) { <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(self-&gt;service); }</div>
<div class="line">  <span class="keywordflow">if</span> (self-&gt;results) { freeaddrinfo(self-&gt;results); }</div>
<div class="line">  <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a> (<span class="keyword">self</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3d50bed513b50ad9c71190a9756c8e2b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t socket_get_addr_sz </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSocket.html">Socket</a> *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the size needed to store a string representation of an OSocket's address</p>
<p>This is just a dummy function exposing SOCKNAMELEN</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td><a class="el" href="structSocket.html">Socket</a> under consideration </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00613">613</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="socket_8c_source.html#l00048">SOCKNAMELEN</a>.</p>

<p>Referenced by <a class="el" href="socket_8c_source.html#l00628">socket_get_peer_addr()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  assert(s);</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="socket_8c.html#adca79f28f3c02e346370ef2dfd14d7e9">SOCKNAMELEN</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a35686271081d7d60e07823ffee5a5e5f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void socket_get_name </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSocket.html">Socket</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>namelen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>remote</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the name (address+service) of an OSocket.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>OSocket </td></tr>
    <tr><td class="paramname">name</td><td>memory buffer to return the string in (nil-terminated) </td></tr>
    <tr><td class="paramname">namelen</td><td>length of name, using <a class="el" href="o__socket_8h.html#a3d50bed513b50ad9c71190a9756c8e2b">socket_get_addr_sz()</a> is a good idea </td></tr>
    <tr><td class="paramname">remote</td><td>0 if the local name is needed, non-zero for the remote peer</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="socket_8c.html#a8025c352b2bddda3266e33c022cef8e9">sockaddr_get_name</a>, getsockname(3), <a class="el" href="socket_8c.html#a3d50bed513b50ad9c71190a9756c8e2b">socket_get_addr_sz</a> </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00664">664</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="log_8c_source.html#l00309">logwarn()</a>, <a class="el" href="o__socket_8h_source.html#l00045">Socket::name</a>, <a class="el" href="o__socket_8h_source.html#l00054">sockaddr_t::sa</a>, and <a class="el" href="socket_8c_source.html#l00707">sockaddr_get_name()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="unionsockaddr__t.html">sockaddr_t</a> sa;</div>
<div class="line">  socklen_t sa_len = <span class="keyword">sizeof</span>(sa);</div>
<div class="line">  <a class="code" href="structSocketInt.html">SocketInt</a> *<span class="keyword">self</span> = (<a class="code" href="structSocketInt.html">SocketInt</a>*) s;</div>
<div class="line"></div>
<div class="line">  assert(<span class="keyword">self</span>);</div>
<div class="line">  assert(<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line">  assert(self-&gt;sockfd);</div>
<div class="line"></div>
<div class="line">  memset(&amp;sa, 0, sa_len);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(remote) {</div>
<div class="line">    <span class="keywordflow">if</span>(!getpeername(self-&gt;sockfd, &amp;sa.<a class="code" href="unionsockaddr__t.html#ac78dc4ea8ef63f47c60ea02a39d34548">sa</a>, &amp;sa_len)) {</div>
<div class="line">      <a class="code" href="o__socket_8h.html#a8025c352b2bddda3266e33c022cef8e9">sockaddr_get_name</a>(&amp;sa, sa_len, <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="headers_8c.html#aff1f5a73cc518a5f952f008b620af7f8">namelen</a>);</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="log_8c.html#ac65b3f90d3228474368b2b48a488cd44">logwarn</a>(<span class="stringliteral">&quot;%s: Cannot get details of socket peer: %s&quot;</span>, s-&gt;<a class="code" href="structSocket.html#a0777b306460511cf44c7ff0935e14348">name</a>, strerror(errno));</div>
<div class="line">      *<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">if</span>(!getsockname(self-&gt;sockfd, &amp;sa.<a class="code" href="unionsockaddr__t.html#ac78dc4ea8ef63f47c60ea02a39d34548">sa</a>, &amp;sa_len)) {</div>
<div class="line">      <a class="code" href="o__socket_8h.html#a8025c352b2bddda3266e33c022cef8e9">sockaddr_get_name</a>(&amp;sa, sa_len, <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="headers_8c.html#aff1f5a73cc518a5f952f008b620af7f8">namelen</a>);</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="log_8c.html#ac65b3f90d3228474368b2b48a488cd44">logwarn</a>(<span class="stringliteral">&quot;%s: Cannot get details of socket: %s&quot;</span>, s-&gt;<a class="code" href="structSocket.html#a0777b306460511cf44c7ff0935e14348">name</a>, strerror(errno));</div>
<div class="line">      *<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = 0;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acdc0efd11459cc760edffeb252411a21"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int socket_get_non_blocking_mode </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If the return value is non-zero all newly created sockets will be put in non-blocking mode, otherwise the sockets remain in the system default mode. </p>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00100">100</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> nonblocking_mode;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a46c67aefa915928d4c5631c1abbe1958"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void socket_get_peer_addr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSocket.html">Socket</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>addr_sz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the peer address of an OSocket.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>OSocket </td></tr>
    <tr><td class="paramname">addr</td><td>memory buffer to return the string in (nil-terminated) </td></tr>
    <tr><td class="paramname">namelen</td><td>length of name, using <a class="el" href="o__socket_8h.html#a3d50bed513b50ad9c71190a9756c8e2b">socket_get_addr_sz()</a> is a good idea</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="socket_8c.html#a8025c352b2bddda3266e33c022cef8e9">sockaddr_get_name</a>, getsockname(3), <a class="el" href="socket_8c.html#a3d50bed513b50ad9c71190a9756c8e2b">socket_get_addr_sz</a> </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00628">628</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="log_8c_source.html#l00048">o_log</a>, <a class="el" href="o__log_8h_source.html#l00024">O_LOG_WARN</a>, <a class="el" href="o__socket_8h_source.html#l00054">sockaddr_t::sa</a>, and <a class="el" href="socket_8c_source.html#l00613">socket_get_addr_sz()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> ret;</div>
<div class="line">  <a class="code" href="unionsockaddr__t.html">sockaddr_t</a> sa;</div>
<div class="line">  socklen_t sa_len = <span class="keyword">sizeof</span>(sa);</div>
<div class="line">  <a class="code" href="structSocketInt.html">SocketInt</a> *<span class="keyword">self</span> = (<a class="code" href="structSocketInt.html">SocketInt</a>*)s;</div>
<div class="line"></div>
<div class="line">  assert(<span class="keyword">self</span>);</div>
<div class="line">  assert(self-&gt;sockfd&gt;=0);</div>
<div class="line">  assert(addr);</div>
<div class="line">  assert(<a class="code" href="o__socket_8h.html#a3d50bed513b50ad9c71190a9756c8e2b">socket_get_addr_sz</a>(s) &lt;= addr_sz);</div>
<div class="line"></div>
<div class="line">  memset(&amp;sa, 0, sa_len);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(getpeername(self-&gt;sockfd, &amp;sa.<a class="code" href="unionsockaddr__t.html#ac78dc4ea8ef63f47c60ea02a39d34548">sa</a>, &amp;sa_len)) {</div>
<div class="line">    <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a56a33f447cce1b983d6d689f46c8fc87">O_LOG_WARN</a>, <span class="stringliteral">&quot;%s: Error getting peer address: %s\n&quot;</span>,</div>
<div class="line">        self-&gt;name, strerror(errno));</div>
<div class="line">    snprintf(addr, addr_sz, <span class="stringliteral">&quot;Unknown peer&quot;</span>);</div>
<div class="line"></div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ret=getnameinfo(&amp;sa.<a class="code" href="unionsockaddr__t.html#ac78dc4ea8ef63f47c60ea02a39d34548">sa</a>, sa_len, addr, addr_sz, NULL, 0, NI_NUMERICHOST))) {</div>
<div class="line">    <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a56a33f447cce1b983d6d689f46c8fc87">O_LOG_WARN</a>, <span class="stringliteral">&quot;%s: Error converting peer address to name: %s\n&quot;</span>,</div>
<div class="line">        self-&gt;name, gai_strerror(ret));</div>
<div class="line">    snprintf(addr, addr_sz, <span class="stringliteral">&quot;Unknown address (AF%d)&quot;</span>, sa.<a class="code" href="unionsockaddr__t.html#ac78dc4ea8ef63f47c60ea02a39d34548">sa</a>.sa_family);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aebc527809e7416fce7308e29074a3459"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t socket_get_port </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSocket.html">Socket</a> *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the port of socket contained in an OComm <a class="el" href="structSocket.html">Socket</a> object</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">socket</td><td>OSocket </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the underlying socket descriptor </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00599">599</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  assert(s);</div>
<div class="line">  <a class="code" href="structSocketInt.html">SocketInt</a> *<span class="keyword">self</span> = (<a class="code" href="structSocketInt.html">SocketInt</a>*)s;</div>
<div class="line">  <span class="keywordflow">return</span> ntohs(self-&gt;servAddr.sa_in.sin_port);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa54d12c240e4f3990717cc3bfbd2d6fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int socket_get_sockfd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSocket.html">Socket</a> *&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the socket FD of an OComm <a class="el" href="structSocket.html">Socket</a> object</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">socket</td><td>OSocket </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the underlying socket descriptor </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00587">587</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structSocketInt.html">SocketInt</a> *<span class="keyword">self</span> = (<a class="code" href="structSocketInt.html">SocketInt</a>*)socket;</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;sockfd;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5bef9ed18759eac55bcf4c4d766b689d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structSocket.html">Socket</a>* socket_in_new </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>service</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>is_tcp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create OSocket objects bound to name and service.</p>
<p>This function binds the newly-created socket, but doesn't listen on it just yet. If name resolves to more than one AF, several sockets are created, linked through their `next' field.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>name of the object, used for debugging </td></tr>
    <tr><td class="paramname">node</td><td>address or name to listen on; defaults to all if NULL </td></tr>
    <tr><td class="paramname">service</td><td>symbolic name or port number of the service to bind to </td></tr>
    <tr><td class="paramname">is_tcp</td><td>true if TCP, false for UDP XXX: This should be more generic </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to a linked list of <a class="el" href="structSocketInt.html">SocketInt</a> objects, cast as <a class="el" href="structSocket.html">Socket</a></dd></dl>
<dl class="section see"><dt>See Also</dt><dd>getaddrinfo(3) </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00199">199</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="log_8c_source.html#l00048">o_log</a>, <a class="el" href="o__log_8h_source.html#l00026">O_LOG_DEBUG</a>, <a class="el" href="o__log_8h_source.html#l00023">O_LOG_ERROR</a>, <a class="el" href="o__log_8h_source.html#l00024">O_LOG_WARN</a>, <a class="el" href="mem_8c_source.html#l00240">oml_free()</a>, <a class="el" href="mem_8c_source.html#l00206">oml_realloc()</a>, <a class="el" href="socket_8c_source.html#l00707">sockaddr_get_name()</a>, <a class="el" href="socket_8c_source.html#l00157">socket_free()</a>, <a class="el" href="socket_8c_source.html#l00176">socket_new()</a>, and <a class="el" href="socket_8c_source.html#l00048">SOCKNAMELEN</a>.</p>

<p>Referenced by <a class="el" href="socket_8c_source.html#l00464">socket_server_new()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structSocketInt.html">SocketInt</a> *<span class="keyword">self</span> = NULL, *list = NULL;</div>
<div class="line">  <span class="keywordtype">char</span> nameserv[<a class="code" href="socket_8c.html#adca79f28f3c02e346370ef2dfd14d7e9">SOCKNAMELEN</a>], *namestr = NULL;</div>
<div class="line">  <span class="keywordtype">size_t</span> namestr_size;</div>
<div class="line">  <span class="keyword">struct </span>addrinfo hints, *results, *rp;</div>
<div class="line">  <span class="keywordtype">int</span> ret;</div>
<div class="line"></div>
<div class="line">  *nameserv = 0;</div>
<div class="line">  memset(&amp;hints, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> addrinfo));</div>
<div class="line"></div>
<div class="line">  hints.ai_socktype = SOCK_STREAM;</div>
<div class="line">  hints.ai_protocol = IPPROTO_TCP; <span class="comment">/* FIXME: We should check self-&gt;is_tcp */</span></div>
<div class="line">  hints.ai_flags= AI_PASSIVE;</div>
<div class="line">  <span class="keywordtype">int</span> val = 1;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>((ret=getaddrinfo(node, service, &amp;hints, &amp;results))) {</div>
<div class="line">      <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a5ea1f1d02dfda13b474ec771f7bd1a3a">O_LOG_ERROR</a>, <span class="stringliteral">&quot;socket(%s): Error resolving %s:%s: %s\n&quot;</span>,</div>
<div class="line">          <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, node, service, gai_strerror(ret));</div>
<div class="line">      <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span> (rp = results; rp != NULL; rp = rp-&gt;ai_next) {</div>
<div class="line">    <a class="code" href="o__socket_8h.html#a8025c352b2bddda3266e33c022cef8e9">sockaddr_get_name</a>((<a class="code" href="unionsockaddr__t.html">sockaddr_t</a>*)rp-&gt;ai_addr, rp-&gt;ai_addrlen, nameserv, <a class="code" href="socket_8c.html#adca79f28f3c02e346370ef2dfd14d7e9">SOCKNAMELEN</a>);</div>
<div class="line">    namestr_size = strlen(<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>) + strlen(nameserv + 2);</div>
<div class="line">    namestr = <a class="code" href="mem_8c.html#ae75af3096ebd921116baca5ed9208488">oml_realloc</a>(namestr, namestr_size);</div>
<div class="line">    snprintf(namestr, namestr_size, <span class="stringliteral">&quot;%s-%s&quot;</span>, <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, nameserv);</div>
<div class="line">    <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a9b68704e34b864d25ec14e9525083de2">O_LOG_DEBUG</a>, <span class="stringliteral">&quot;socket(%s): Binding to %s (AF %d, proto %d)\n&quot;</span>,</div>
<div class="line">        <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, nameserv, rp-&gt;ai_family, rp-&gt;ai_protocol);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (NULL == (<span class="keyword">self</span> = (<a class="code" href="structSocketInt.html">SocketInt</a>*)<a class="code" href="o__socket_8h.html#aab9acfcfa5ad878f80b6f8e99cb5c8d2">socket_new</a>(namestr, is_tcp))) {</div>
<div class="line">      <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a56a33f447cce1b983d6d689f46c8fc87">O_LOG_WARN</a>, <span class="stringliteral">&quot;socket(%s): Could allocate Socket to listen on %s: %s\n&quot;</span>,</div>
<div class="line">          self-&gt;name, nameserv, strerror(errno));</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(0 &gt; (self-&gt;sockfd =</div>
<div class="line">          socket(rp-&gt;ai_family, rp-&gt;ai_socktype, rp-&gt;ai_protocol))) {</div>
<div class="line">      <span class="comment">/* It&#39;s OK if some AFs fail, we check that in the end */</span></div>
<div class="line">      <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a9b68704e34b864d25ec14e9525083de2">O_LOG_DEBUG</a>, <span class="stringliteral">&quot;socket(%s): Could not create socket to listen on %s: %s\n&quot;</span>,</div>
<div class="line">          self-&gt;name, nameserv, strerror(errno));</div>
<div class="line">      <a class="code" href="o__socket_8h.html#a1c0850933bb110c33fbdb774c0221904">socket_free</a>((<a class="code" href="structSocket.html">Socket</a>*)<span class="keyword">self</span>);</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(0 != setsockopt(self-&gt;sockfd, SOL_SOCKET, SO_REUSEADDR, &amp;val, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>))){</div>
<div class="line">      <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a56a33f447cce1b983d6d689f46c8fc87">O_LOG_WARN</a>, <span class="stringliteral">&quot;socket(%s): Could not set option SO_REUSEADDR on socket to listen on %s: %s\n&quot;</span>,</div>
<div class="line">          self-&gt;name, nameserv, strerror(errno));</div>
<div class="line">      close(self-&gt;sockfd);</div>
<div class="line">      <span class="comment">/* XXX: Not optimal: we could reuse the Socket */</span></div>
<div class="line">      <a class="code" href="o__socket_8h.html#a1c0850933bb110c33fbdb774c0221904">socket_free</a>((<a class="code" href="structSocket.html">Socket</a>*)<span class="keyword">self</span>);</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 != bind(self-&gt;sockfd, rp-&gt;ai_addr, rp-&gt;ai_addrlen)) {</div>
<div class="line">      <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a56a33f447cce1b983d6d689f46c8fc87">O_LOG_WARN</a>, <span class="stringliteral">&quot;socket(%s): Error binding socket to listen on %s: %s\n&quot;</span>,</div>
<div class="line">          self-&gt;name, nameserv, strerror(errno));</div>
<div class="line">      close(self-&gt;sockfd);</div>
<div class="line">      <span class="comment">/* XXX: Not optimal: we could reuse the Socket */</span></div>
<div class="line">      <a class="code" href="o__socket_8h.html#a1c0850933bb110c33fbdb774c0221904">socket_free</a>((<a class="code" href="structSocket.html">Socket</a>*)<span class="keyword">self</span>);</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">/* The last connected AFs (hence less important according to GAI) are</span></div>
<div class="line"><span class="comment">       * now at the front, but it&#39;s not a big deal as we treat them all</span></div>
<div class="line"><span class="comment">       * equally (i.e, we&#39;re going to listen on them all */</span></div>
<div class="line">      <span class="keyword">self</span>-&gt;next = (<a class="code" href="structSocket.html">Socket</a>*)list;</div>
<div class="line">      list = <span class="keyword">self</span>;</div>
<div class="line">      <span class="keyword">self</span> = NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (namestr) { <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(namestr); }</div>
<div class="line">  freeaddrinfo(results);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (NULL == list) {</div>
<div class="line">    <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a5ea1f1d02dfda13b474ec771f7bd1a3a">O_LOG_ERROR</a>, <span class="stringliteral">&quot;socket(%s): Could not create any socket to listen on port %s\n&quot;</span>,</div>
<div class="line">        <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, service);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> (<a class="code" href="structSocket.html">Socket</a>*)list;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0a63b81e5b680584ef77cfa64fea81fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int socket_is_disconnected </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSocket.html">Socket</a> *&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get information about the connected state of a <a class="el" href="structSocket.html">Socket</a> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">socket</td><td><a class="el" href="structSocket.html">Socket</a> to examine </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the socket is connected, non-zero otherwise </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00110">110</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> ((<a class="code" href="structSocketInt.html">SocketInt</a>*)socket)-&gt;is_disconnected;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae17265b77d018590bf28698de8e479d1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int socket_is_listening </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSocket.html">Socket</a> *&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get information about the listening state of a <a class="el" href="structSocket.html">Socket</a> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">socket</td><td><a class="el" href="structSocket.html">Socket</a> to examine </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the socket is listening, non-zero otherwise </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00120">120</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> (NULL != ((<a class="code" href="structSocketInt.html">SocketInt</a>*)socket)-&gt;connect_callback);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aab9acfcfa5ad878f80b6f8e99cb5c8d2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structSocket.html">Socket</a>* socket_new </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>is_tcp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create an unbound <a class="el" href="structSocket.html">Socket</a> object.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>name of the object, used for debugging </td></tr>
    <tr><td class="paramname">is_tcp</td><td>true if TCP, false for UDP XXX: This should be more generic </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to the <a class="el" href="structSocketInt.html">SocketInt</a> object, cast as a <a class="el" href="structSocket.html">Socket</a>, with a newly opened system socket </dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="socket_8c.html#a1c0850933bb110c33fbdb774c0221904">socket_free</a>, <a class="el" href="socket_8c.html#ab8e18bfbef40930e4e38a2e5b69801a2">socket_close</a> </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00176">176</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>Referenced by <a class="el" href="socket_8c_source.html#l00199">socket_in_new()</a>, and <a class="el" href="socket_8c_source.html#l00371">socket_tcp_out_new()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structSocketInt.html">SocketInt</a>* <span class="keyword">self</span> = socket_initialize(<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line">  <span class="keyword">self</span>-&gt;is_tcp = is_tcp; <span class="comment">/* XXX: replace is_tcp with a more meaningful variable to contain that */</span></div>
<div class="line">  <span class="keyword">self</span>-&gt;is_disconnected = 1;</div>
<div class="line">  <span class="keywordflow">return</span> (<a class="code" href="structSocket.html">Socket</a>*)<span class="keyword">self</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aac5112b86b80ead64713acbfcf628953"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int socket_sendto </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSocket.html">Socket</a> *&#160;</td>
          <td class="paramname"><em>socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>buf_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Send a message through the socket</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">socket</td><td><a class="el" href="structSocket.html">Socket</a> to send message through </td></tr>
    <tr><td class="paramname">buf</td><td>data to send </td></tr>
    <tr><td class="paramname">buf_size</td><td>amount of data to read from buf </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the amount of data sent</dd></dl>
<dl class="section see"><dt>See Also</dt><dd>sendto(3) </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00528">528</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="log_8c_source.html#l00309">logwarn()</a>, <a class="el" href="log_8c_source.html#l00048">o_log</a>, <a class="el" href="o__log_8h_source.html#l00026">O_LOG_DEBUG</a>, <a class="el" href="o__log_8h_source.html#l00023">O_LOG_ERROR</a>, and <a class="el" href="o__log_8h_source.html#l00024">O_LOG_WARN</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structSocketInt.html">SocketInt</a> *<span class="keyword">self</span> = (<a class="code" href="structSocketInt.html">SocketInt</a>*)socket;</div>
<div class="line">  <span class="keywordtype">int</span> sent;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (self-&gt;is_disconnected) {</div>
<div class="line">    <span class="keywordflow">if</span>(!s_connect(<span class="keyword">self</span>)) {</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((sent = recv(self-&gt;sockfd, NULL, 0, MSG_DONTWAIT)) == 0) {</div>
<div class="line">    <span class="comment">/* Test that the server kept the other side of the connection alive */</span></div>
<div class="line">    <span class="keywordflow">if</span> (!(sent &lt; 0 &amp;&amp; EAGAIN == errno)) {</div>
<div class="line">      <span class="comment">/* EAGAIN is the expected case: connection alive but no data,</span></div>
<div class="line"><span class="comment">       * everything else is a problem */</span></div>
<div class="line">      <a class="code" href="log_8c.html#ac65b3f90d3228474368b2b48a488cd44">logwarn</a>(<span class="stringliteral">&quot;socket(%s): Server appears to have closed the connection\n&quot;</span>, self-&gt;name);</div>
<div class="line"></div>
<div class="line">      <span class="keyword">self</span>-&gt;is_disconnected = 1;</div>
<div class="line">      <span class="comment">/* We want higher levels to be aware of this disconnection */</span></div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> ((sent = sendto(self-&gt;sockfd, buf, buf_size, MSG_NOSIGNAL,</div>
<div class="line">                    &amp;(self-&gt;servAddr.sa),</div>
<div class="line">                    <span class="keyword">sizeof</span>(self-&gt;servAddr.sa_stor))) &lt; 0) {</div>
<div class="line">    <span class="keywordflow">if</span> (errno == EPIPE || errno == ECONNRESET) {</div>
<div class="line">      <span class="comment">// The other end closed the connection.</span></div>
<div class="line">      <span class="keyword">self</span>-&gt;is_disconnected = 1;</div>
<div class="line">      <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a5ea1f1d02dfda13b474ec771f7bd1a3a">O_LOG_ERROR</a>, <span class="stringliteral">&quot;socket(%s): The remote peer closed the connection: %s\n&quot;</span>,</div>
<div class="line">            self-&gt;name, strerror(errno));</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errno == ECONNREFUSED) {</div>
<div class="line">      <span class="keyword">self</span>-&gt;is_disconnected = 1;</div>
<div class="line">      <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a9b68704e34b864d25ec14e9525083de2">O_LOG_DEBUG</a>, <span class="stringliteral">&quot;socket(%s): Connection refused, trying next AI\n&quot;</span>,</div>
<div class="line">            self-&gt;name);</div>
<div class="line">      <span class="keyword">self</span>-&gt;rp = <span class="keyword">self</span>-&gt;rp-&gt;ai_next;</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errno == EINTR) {</div>
<div class="line">      <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a56a33f447cce1b983d6d689f46c8fc87">O_LOG_WARN</a>, <span class="stringliteral">&quot;socket(%s): Sending data interrupted: %s\n&quot;</span>,</div>
<div class="line">            self-&gt;name, strerror(errno));</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a5ea1f1d02dfda13b474ec771f7bd1a3a">O_LOG_ERROR</a>, <span class="stringliteral">&quot;socket(%s): Sending data failed: %s\n&quot;</span>,</div>
<div class="line">            self-&gt;name, strerror(errno));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> sent;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a147759fb9e8c7fb90e7a793f9a03a625"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structSocket.html">Socket</a>* socket_server_new </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>service</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="o__socket_8h.html#a411a99545d5d8d999bfea361d1fbabfd">o_so_connect_callback</a>&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>handle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create listening OSocket objects, and register them with the EventLoop.</p>
<p>If callback is non-NULL, it is registered to the OCOMM eventloop to handle monitor_in events.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>name of the object, used for debugging </td></tr>
    <tr><td class="paramname">node</td><td>address or name to listen on; defaults to all if NULL </td></tr>
    <tr><td class="paramname">service</td><td>symbolic name or port number of the service to bind to </td></tr>
    <tr><td class="paramname">callback</td><td>function to call when a client connects </td></tr>
    <tr><td class="paramname">handle</td><td>pointer to opaque data passed to callback function </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to a linked list of <a class="el" href="structSocket.html">Socket</a> objects</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="socket_8c.html#a5bef9ed18759eac55bcf4c4d766b689d">socket_in_new</a> </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00464">464</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="socket_8c_source.html#l00070">SocketInt::connect_callback</a>, <a class="el" href="socket_8c_source.html#l00072">SocketInt::connect_handle</a>, <a class="el" href="eventloop_8c_source.html#l00620">eventloop_on_monitor_in_channel()</a>, <a class="el" href="socket_8c_source.html#l00079">SocketInt::next</a>, <a class="el" href="socket_8c_source.html#l00199">socket_in_new()</a>, <a class="el" href="socket_8c_source.html#l00060">SocketInt::sockfd</a>, and <a class="el" href="socket_8c_source.html#l00038">TRUE</a>.</p>

<p>Referenced by <a class="el" href="oml2-proxy-server_8c_source.html#l00307">main()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structSocket.html">Socket</a> *socketlist;</div>
<div class="line">  <a class="code" href="structSocketInt.html">SocketInt</a> *it;</div>
<div class="line"></div>
<div class="line">  socketlist = <a class="code" href="o__socket_8h.html#a5bef9ed18759eac55bcf4c4d766b689d">socket_in_new</a>(<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, node, service, <a class="code" href="socket_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span> (it=(<a class="code" href="structSocketInt.html">SocketInt</a>*)socketlist; it; it=(<a class="code" href="structSocketInt.html">SocketInt</a>*)it-&gt;<a class="code" href="structSocketInt.html#a2c56425ca71fb508f31620f1008bbc88">next</a>) {</div>
<div class="line">    listen(it-&gt;<a class="code" href="structSocketInt.html#a26aed141948b3a5efd93f660f8fd6f1f">sockfd</a>, 5);</div>
<div class="line">    it-&gt;<a class="code" href="structSocketInt.html#af26163550c8652145b5ad7942cb63cfb">connect_callback</a> = callback;</div>
<div class="line">    it-&gt;<a class="code" href="structSocketInt.html#a0393eaabb494a939b205ddfdc1249ac3">connect_handle</a> = handle;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (callback) {</div>
<div class="line">      <span class="comment">// Wait for a client to connect. Handle that in callback</span></div>
<div class="line">      <a class="code" href="eventloop_8c.html#a157aac6cff6a7846642262957a7b7b92">eventloop_on_monitor_in_channel</a>((<a class="code" href="structSocket.html">Socket</a>*)it, on_client_connect, NULL, it);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> socketlist;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adac2005542e88cb32988ad200a07efbe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int socket_set_non_blocking_mode </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flag</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set a global flag which, when set true will cause all newly created sockets to be put in non-blocking mode, otherwise the sockets remain in the system default mode.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">flag</td><td>non-zero to enable nonblocking_mode </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>flag </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00092">92</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>Referenced by <a class="el" href="net__stream_8c_source.html#l00080">net_stream_new()</a>.</p>
<div class="fragment"><div class="line">                                       {</div>
<div class="line">  <span class="keywordflow">return</span> nonblocking_mode = flag;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7dc3da0e474bbae9d8617d5fa06e81fb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int socket_shutdown </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSocket.html">Socket</a> *&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Prevent the remote sender from trasmitting more data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">socket</td><td><a class="el" href="structSocket.html">Socket</a> object for which to shut communication down</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd>shutdown(3) </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00491">491</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="o__socket_8h_source.html#l00045">Socket::name</a>, <a class="el" href="log_8c_source.html#l00048">o_log</a>, <a class="el" href="o__log_8h_source.html#l00026">O_LOG_DEBUG</a>, and <a class="el" href="o__log_8h_source.html#l00024">O_LOG_WARN</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> ret = -1;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a9b68704e34b864d25ec14e9525083de2">O_LOG_DEBUG</a>, <span class="stringliteral">&quot;socket(%s): Shutting down for R/W\n&quot;</span>, socket-&gt;<a class="code" href="structSocket.html#a0777b306460511cf44c7ff0935e14348">name</a>);</div>
<div class="line">  ret = shutdown(((<a class="code" href="structSocketInt.html">SocketInt</a> *)socket)-&gt;sockfd, SHUT_RDWR);</div>
<div class="line">  <span class="keywordflow">if</span>(ret) <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a56a33f447cce1b983d6d689f46c8fc87">O_LOG_WARN</a>, <span class="stringliteral">&quot;socket(%s): Failed to shut down: %s\n&quot;</span>, socket-&gt;<a class="code" href="structSocket.html#a0777b306460511cf44c7ff0935e14348">name</a>, strerror(errno));</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af08f11ed507617aeb812ba35787b4184"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structSocket.html">Socket</a>* socket_tcp_out_new </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>service</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a new outgoing TCP <a class="el" href="structSocket.html">Socket</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>name of this <a class="el" href="structSocket.html">Socket</a>, for debugging purposes </td></tr>
    <tr><td class="paramname">dest</td><td>DNS name or address of the destination </td></tr>
    <tr><td class="paramname">service</td><td>symbolic name or port number of the service to connect to </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a newly-allocated <a class="el" href="structSocket.html">Socket</a>, or NULL on error </dd></dl>

<p>Definition at line <a class="el" href="socket_8c_source.html#l00371">371</a> of file <a class="el" href="socket_8c_source.html">socket.c</a>.</p>

<p>References <a class="el" href="log_8c_source.html#l00048">o_log</a>, <a class="el" href="o__log_8h_source.html#l00023">O_LOG_ERROR</a>, <a class="el" href="mem_8c_source.html#l00288">oml_strndup()</a>, <a class="el" href="socket_8c_source.html#l00176">socket_new()</a>, and <a class="el" href="socket_8c_source.html#l00038">TRUE</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structSocketInt.html">SocketInt</a>* <span class="keyword">self</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (dest == NULL) {</div>
<div class="line">    <a class="code" href="log_8c.html#a1af7af0e3803ef8461551c7a41e35e7d">o_log</a>(<a class="code" href="o__log_8h.html#a5ea1f1d02dfda13b474ec771f7bd1a3a">O_LOG_ERROR</a>, <span class="stringliteral">&quot;socket(%s): Missing destination\n&quot;</span>, <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> ((<span class="keyword">self</span> = (<a class="code" href="structSocketInt.html">SocketInt</a>*)<a class="code" href="o__socket_8h.html#aab9acfcfa5ad878f80b6f8e99cb5c8d2">socket_new</a>(<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="socket_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)) == NULL) {</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keyword">self</span>-&gt;dest = <a class="code" href="mem_8c.html#adca1f9f48333b1fa9af21312a3f4534c">oml_strndup</a>(dest, strlen(dest));</div>
<div class="line">  <span class="keyword">self</span>-&gt;service = <a class="code" href="mem_8c.html#adca1f9f48333b1fa9af21312a3f4534c">oml_strndup</a>(service, strlen(service));</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//  eventloop_on_out_channel((Socket*)self, on_self_connected, NULL);</span></div>
<div class="line">  <span class="keywordflow">return</span> (<a class="code" href="structSocket.html">Socket</a>*)<span class="keyword">self</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_080c3098bae5c5c65083e8b807d57c04.html">ocomm</a></li><li class="navelem"><a class="el" href="socket_8c.html">socket.c</a></li>
    <li class="footer">Generated on Thu Jun 25 2015 15:31:56 for oml2 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
