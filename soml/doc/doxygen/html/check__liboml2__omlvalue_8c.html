<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>oml2: check_liboml2_omlvalue.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="oml_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">oml2
   &#160;<span id="projectnumber">2.12.0pre.79-58cf-dirty</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('check__liboml2__omlvalue_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">check_liboml2_omlvalue.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Test <a class="el" href="structOmlValue.html">OmlValue</a>[UT] low-level manipulation functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;stdint.h&gt;</code><br/>
<code>#include &lt;inttypes.h&gt;</code><br/>
<code>#include &lt;check.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="omlc_8h_source.html">oml2/omlc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="mem_8h_source.html">mem.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="oml__util_8h_source.html">oml_util.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="oml__value_8h_source.html">oml_value.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for check_liboml2_omlvalue.c:</div>
<div class="dyncontent">
<div class="center"><img src="check__liboml2__omlvalue_8c__incl.png" border="0" usemap="#check__liboml2__omlvalue_8c" alt=""/></div>
<map name="check__liboml2__omlvalue_8c" id="check__liboml2__omlvalue_8c">
<area shape="rect" id="node11" href="omlc_8h.html" title="Public API of the OML client library." alt="" coords="547,160,640,189"/><area shape="rect" id="node28" href="mem_8h.html" title="mem.h" alt="" coords="316,160,377,189"/><area shape="rect" id="node33" href="oml__util_8h.html" title="oml_util.h" alt="" coords="499,83,576,112"/><area shape="rect" id="node35" href="oml__value_8h.html" title="oml_value.h" alt="" coords="384,83,475,112"/><area shape="rect" id="node24" href="o__log_8h.html" title="ocomm/o_log.h" alt="" coords="403,237,512,267"/></map>
</div>
</div>
<p><a href="check__liboml2__omlvalue_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a369266c24eacffb87046522897a570d5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__liboml2__omlvalue_8c.html#a369266c24eacffb87046522897a570d5">_GNU_SOURCE</a>&#160;&#160;&#160;/* For NAN */</td></tr>
<tr class="memitem:ad0e13d94164219be2d5bbd4d65e71d1e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__liboml2__omlvalue_8c.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(a)&#160;&#160;&#160;((sizeof (a)) / (sizeof ((a)[0])))</td></tr>
<tr class="memitem:af42b59aa48ef39695135a2bb2b9a6ffa"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__liboml2__omlvalue_8c.html#af42b59aa48ef39695135a2bb2b9a6ffa">test_i</a>(<a class="el" href="check__libshared__headers_8c.html#a23506fc4821ab6d9671f3e6222591a96">type</a>, var, format)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a55d15e86b108bdeeb724dd39f4c6eb3e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__liboml2__omlvalue_8c.html#a55d15e86b108bdeeb724dd39f4c6eb3e">START_TEST</a> (test_stringU)</td></tr>
<tr class="memitem:aa5f7b3b8d0a8ca705f33c7f7b2b3aed2"><td class="memItemLeft" align="right" valign="top">END_TEST&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__liboml2__omlvalue_8c.html#aa5f7b3b8d0a8ca705f33c7f7b2b3aed2">START_TEST</a> (test_blobU)</td></tr>
<tr class="memitem:a153b0fa0e939662dfc9400de0d866164"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__liboml2__omlvalue_8c.html#a153b0fa0e939662dfc9400de0d866164">START_TEST</a> (test_intrinsic)</td></tr>
<tr class="memitem:a5a214de0401858745568f777ce712c43"><td class="memItemLeft" align="right" valign="top">END_TEST&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__liboml2__omlvalue_8c.html#a5a214de0401858745568f777ce712c43">START_TEST</a> (test_string)</td></tr>
<tr class="memitem:a90e5907592e0551f03c1c0cbd484e4d7"><td class="memItemLeft" align="right" valign="top">END_TEST&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__liboml2__omlvalue_8c.html#a90e5907592e0551f03c1c0cbd484e4d7">START_TEST</a> (test_blob)</td></tr>
<tr class="memitem:a4a01e6877c75c574b138bc06549a4129"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__liboml2__omlvalue_8c.html#a4a01e6877c75c574b138bc06549a4129">START_TEST</a> (test_bool_loop)</td></tr>
<tr class="memitem:ab2bd625b353e76fdd5eb1f0a692e7e53"><td class="memItemLeft" align="right" valign="top">END_TEST Suite *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__liboml2__omlvalue_8c.html#ab2bd625b353e76fdd5eb1f0a692e7e53">omlvalue_suite</a> (void)</td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Test <a class="el" href="structOmlValue.html">OmlValue</a>[UT] low-level manipulation functions. </p>

<p>Definition in file <a class="el" href="check__liboml2__omlvalue_8c_source.html">check_liboml2_omlvalue.c</a>.</p>
</div><h2>Macro Definition Documentation</h2>
<a class="anchor" id="a369266c24eacffb87046522897a570d5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _GNU_SOURCE&#160;&#160;&#160;/* For NAN */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00014">14</a> of file <a class="el" href="check__liboml2__omlvalue_8c_source.html">check_liboml2_omlvalue.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad0e13d94164219be2d5bbd4d65e71d1e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LENGTH</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">a</td><td>)</td>
          <td>&#160;&#160;&#160;((sizeof (a)) / (sizeof ((a)[0])))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00025">25</a> of file <a class="el" href="check__liboml2__omlvalue_8c_source.html">check_liboml2_omlvalue.c</a>.</p>

<p>Referenced by <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00428">omlvalue_suite()</a>.</p>

</div>
</div>
<a class="anchor" id="af42b59aa48ef39695135a2bb2b9a6ffa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define test_i</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="check__libshared__headers_8c.html#a23506fc4821ab6d9671f3e6222591a96">type</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">var, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">format&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> {                                                                    \</div>
<div class="line">    omlc_set_ ## <a class="code" href="oml__value_8c.html#ae1087eeb503fb7b11a810d93605c97df">type</a>(to, var);                                           \</div>
<div class="line">    fail_unless(omlc_get_ ## <a class="code" href="oml__value_8c.html#ae1087eeb503fb7b11a810d93605c97df">type</a>(to) == var,                             \</div>
<div class="line">        <span class="stringliteral">&quot;Error setting &quot;</span> #<a class="code" href="oml__value_8c.html#ae1087eeb503fb7b11a810d93605c97df">type</a> <span class="stringliteral">&quot;, expected %&quot;</span> format <span class="stringliteral">&quot;, got %&quot;</span> format,    \</div>
<div class="line">        var, omlc_get_ ## <a class="code" href="oml__value_8c.html#ae1087eeb503fb7b11a810d93605c97df">type</a>(to));                                      \</div>
<div class="line">    from = to;                                                            \</div>
<div class="line">    fail_unless(omlc_get_ ## <a class="code" href="oml__value_8c.html#ae1087eeb503fb7b11a810d93605c97df">type</a>(from) == var,                           \</div>
<div class="line">        <span class="stringliteral">&quot;Error copying&quot;</span> #<a class="code" href="oml__value_8c.html#ae1087eeb503fb7b11a810d93605c97df">type</a> <span class="stringliteral">&quot;, expected %&quot;</span> format <span class="stringliteral">&quot;, got %&quot;</span> format,     \</div>
<div class="line">        var, omlc_get_ ## <a class="code" href="oml__value_8c.html#ae1087eeb503fb7b11a810d93605c97df">type</a>(to));                                      \</div>
<div class="line">  } <span class="keywordflow">while</span>(0)</div>
</div><!-- fragment -->
<p>Definition at line <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00250">250</a> of file <a class="el" href="check__liboml2__omlvalue_8c_source.html">check_liboml2_omlvalue.c</a>.</p>

<p>Referenced by <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00263">START_TEST()</a>.</p>

</div>
</div>
<h2>Function Documentation</h2>
<a class="anchor" id="ab2bd625b353e76fdd5eb1f0a692e7e53"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">END_TEST Suite* omlvalue_suite </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00428">428</a> of file <a class="el" href="check__liboml2__omlvalue_8c_source.html">check_liboml2_omlvalue.c</a>.</p>

<p>References <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00025">LENGTH</a>.</p>

<p>Referenced by <a class="el" href="check__liboml2_8c_source.html#l00017">main()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  Suite* s = suite_create (<span class="stringliteral">&quot;OmlValue&quot;</span>);</div>
<div class="line"></div>
<div class="line">  TCase* tc_omlvalue = tcase_create (<span class="stringliteral">&quot;OmlValue&quot;</span>);</div>
<div class="line">  tcase_add_test (tc_omlvalue, test_stringU);</div>
<div class="line">  tcase_add_test (tc_omlvalue, test_blobU);</div>
<div class="line">  tcase_add_test (tc_omlvalue, test_intrinsic);</div>
<div class="line">  tcase_add_test (tc_omlvalue, test_string);</div>
<div class="line">  tcase_add_test (tc_omlvalue, test_blob);</div>
<div class="line">  tcase_add_loop_test (tc_omlvalue, test_bool_loop, 0, <a class="code" href="check__liboml2__omlvalue_8c.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(booltest));</div>
<div class="line"></div>
<div class="line">  suite_add_tcase (s, tc_omlvalue);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> s;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a55d15e86b108bdeeb724dd39f4c6eb3e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">START_TEST </td>
          <td>(</td>
          <td class="paramtype">test_stringU&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00027">27</a> of file <a class="el" href="check__liboml2__omlvalue_8c_source.html">check_liboml2_omlvalue.c</a>.</p>

<p>References <a class="el" href="mem_8c_source.html#l00228">oml_malloc_usable_size()</a>, <a class="el" href="omlc_8h_source.html#l00494">omlc_copy_string</a>, <a class="el" href="omlc_8h_source.html#l00350">omlc_get_string_is_const</a>, <a class="el" href="omlc_8h_source.html#l00344">omlc_get_string_length</a>, <a class="el" href="omlc_8h_source.html#l00340">omlc_get_string_ptr</a>, <a class="el" href="omlc_8h_source.html#l00347">omlc_get_string_size</a>, <a class="el" href="omlc_8h_source.html#l00457">omlc_reset_string</a>, <a class="el" href="omlc_8h_source.html#l00523">omlc_set_const_string</a>, <a class="el" href="omlc_8h_source.html#l00505">omlc_set_string</a>, <a class="el" href="omlc_8h_source.html#l00476">omlc_set_string_copy</a>, <a class="el" href="omlc_8h_source.html#l00209">omlc_zero</a>, and <a class="el" href="mem_8c_source.html#l00071">xmembytes()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="unionOmlValueU.html">OmlValueU</a> v, v2;</div>
<div class="line">  <span class="keywordtype">char</span> *test = <span class="stringliteral">&quot;test&quot;</span>;</div>
<div class="line">  <span class="keywordtype">char</span> *const_test = <span class="stringliteral">&quot;const test&quot;</span>;</div>
<div class="line">  <span class="keywordtype">size_t</span> size, alloc_diff, bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line"></div>
<div class="line">  <a class="code" href="omlc_8h.html#a5cd79ce130e86f27ce8bae31400beffe">omlc_zero</a>(v);</div>
<div class="line">  <a class="code" href="omlc_8h.html#a5cd79ce130e86f27ce8bae31400beffe">omlc_zero</a>(v2);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Set pointer */</span></div>
<div class="line">  <a class="code" href="omlc_8h.html#a13be9537ef85ccdc463a6172d4716d3a">omlc_set_string</a>(v, test);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v) == test,</div>
<div class="line">      <span class="stringliteral">&quot;Test string pointer not copied properly&quot;</span>);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(v) == strlen(test),</div>
<div class="line">      <span class="stringliteral">&quot;Test string length not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(v), strlen(test));</div>
<div class="line">  fail_unless(<a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() == bcount,</div>
<div class="line">      <span class="stringliteral">&quot;Test string shouldn&#39;t have allocated memory, but the allocation increased&quot;</span>);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Test string allocated size not set properly (%d instead of 0)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v));</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#af92eb9184595d55f73920ed167f8b333">omlc_get_string_is_const</a>(v) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Test string should not be constant&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Set const pointer */</span></div>
<div class="line">  <a class="code" href="omlc_8h.html#a6d211b7fc65c6ac5085dc43e8822f3d9">omlc_set_const_string</a>(v, const_test);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v) == const_test,</div>
<div class="line">      <span class="stringliteral">&quot;Const test string pointer not copied properly&quot;</span>);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(v) == strlen(const_test),</div>
<div class="line">      <span class="stringliteral">&quot;Const test string length not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(v), strlen(const_test));</div>
<div class="line">  fail_unless(<a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() == bcount,</div>
<div class="line">      <span class="stringliteral">&quot;Const test string shouldn&#39;t have allocated memory, but the allocation increased&quot;</span>);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Const test string allocated size not set properly (%d instead of 0)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v));</div>
<div class="line">  fail_if(<a class="code" href="omlc_8h.html#af92eb9184595d55f73920ed167f8b333">omlc_get_string_is_const</a>(v) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Const test string should be constant&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Duplicate pointer */</span></div>
<div class="line">  <a class="code" href="omlc_8h.html#a4eed1605fcf935e2bb7f9944066dd62c">omlc_set_string_copy</a>(v, test, strlen(test));</div>
<div class="line">  fail_if(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v) == test,</div>
<div class="line">      <span class="stringliteral">&quot;Copied test string pointer not allocated properly&quot;</span>);</div>
<div class="line">  fail_if(strcmp(test, <a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v)),</div>
<div class="line">      <span class="stringliteral">&quot;Copied test string mismatch (&#39;%s&#39; instead of &#39;%s&#39;)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v), test);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(v) == strlen(test),</div>
<div class="line">      <span class="stringliteral">&quot;Copied test string length not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(v), strlen(test));</div>
<div class="line">  alloc_diff = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() - bcount - <span class="keyword">sizeof</span>(size_t);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line">  fail_if(alloc_diff &lt; strlen(test) + 1,</div>
<div class="line">      <span class="stringliteral">&quot;Copied test string allocated memory not big enough (%d instead of at least %d)&quot;</span>,</div>
<div class="line">      alloc_diff, strlen(test) + 1);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v) == <a class="code" href="omlc_8h.html#a88226d4fc4230d78776f5e80e58e0265">oml_malloc_usable_size</a>(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v)),</div>
<div class="line">      <span class="stringliteral">&quot;Copied test string allocated size not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v), <a class="code" href="omlc_8h.html#a88226d4fc4230d78776f5e80e58e0265">oml_malloc_usable_size</a>(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v)));</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#af92eb9184595d55f73920ed167f8b333">omlc_get_string_is_const</a>(v) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Copied test string should not be constant&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Copy allocated pointer */</span></div>
<div class="line">  <a class="code" href="omlc_8h.html#acc937f4c5d6c581360ddb3862e83590d">omlc_copy_string</a>(v2, v);</div>
<div class="line">  fail_if(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v2) == <a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v),</div>
<div class="line">      <span class="stringliteral">&quot;Copied allocated string pointer not allocated properly&quot;</span>);</div>
<div class="line">  fail_if(strcmp(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v2), <a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v)),</div>
<div class="line">      <span class="stringliteral">&quot;Copied allocated string mismatch (&#39;%s&#39; instead of &#39;%s&#39;)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v2), <a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v));</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(v2) == strlen(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v2)),</div>
<div class="line">      <span class="stringliteral">&quot;Copied allocated string length not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(v2), strlen(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v2)) + 1);</div>
<div class="line">  alloc_diff = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() - bcount - <span class="keyword">sizeof</span>(size_t); <span class="comment">/* oml_malloc() always allocates at least sizeof(size_t) more for bookkeeping */</span></div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line">  fail_if(alloc_diff &lt; strlen(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v)) + 1,</div>
<div class="line">      <span class="stringliteral">&quot;Copied allocated string allocated memory not big enough (%d instead of at least %d)&quot;</span>,</div>
<div class="line">      alloc_diff, strlen(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v)) + 1);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v) == <a class="code" href="omlc_8h.html#a88226d4fc4230d78776f5e80e58e0265">oml_malloc_usable_size</a>(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v2)),</div>
<div class="line">      <span class="stringliteral">&quot;Copied allocated string allocated size not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v2), <a class="code" href="omlc_8h.html#a88226d4fc4230d78776f5e80e58e0265">oml_malloc_usable_size</a>(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v2)));</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#af92eb9184595d55f73920ed167f8b333">omlc_get_string_is_const</a>(v2) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Copied allocated string should not be constant&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Set pointer on allocated pointer */</span></div>
<div class="line">  size = <a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v);</div>
<div class="line">  <a class="code" href="omlc_8h.html#a13be9537ef85ccdc463a6172d4716d3a">omlc_set_string</a>(v, test);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v) == test,</div>
<div class="line">      <span class="stringliteral">&quot;Override test string pointer not copied properly&quot;</span>);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(v) == strlen(test),</div>
<div class="line">      <span class="stringliteral">&quot;Override test string length not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(v), strlen(test));</div>
<div class="line">  alloc_diff = bcount - <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() + <span class="keyword">sizeof</span>(size_t);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line">  fail_if(alloc_diff &lt;= size,</div>
<div class="line">      <span class="stringliteral">&quot;Override test string over allocated memory test didn&#39;t free the memory as expected (%d freed instead at least %d)&quot;</span>,</div>
<div class="line">      alloc_diff, size);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Override test string allocated size not set properly (%d instead of 0)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v));</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#af92eb9184595d55f73920ed167f8b333">omlc_get_string_is_const</a>(v) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Override test string should not be constant&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Reset string and clear allocated pointer */</span></div>
<div class="line">  size = <a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v2);</div>
<div class="line">  <a class="code" href="omlc_8h.html#a1434bd8b5a841357336609930bdb05c3">omlc_reset_string</a>(v2);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v2) == NULL,</div>
<div class="line">      <span class="stringliteral">&quot;Reset allocated string pointer not cleared properly&quot;</span>);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(v2) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Reset allocated string length not cleared properly&quot;</span>);</div>
<div class="line">  alloc_diff = bcount - <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() + <span class="keyword">sizeof</span>(size_t);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line">  fail_if(alloc_diff &lt;= size,</div>
<div class="line">      <span class="stringliteral">&quot;Reset allocated string didn&#39;t free the memory as expected (%d freed instead at least %d)&quot;</span>,</div>
<div class="line">      alloc_diff, size);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v2) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Reset allocated string allocated size not cleared properly&quot;</span>);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#af92eb9184595d55f73920ed167f8b333">omlc_get_string_is_const</a>(v2) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Reset allocated string should not be constant&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Copy const pointer */</span></div>
<div class="line">  <a class="code" href="omlc_8h.html#a6d211b7fc65c6ac5085dc43e8822f3d9">omlc_set_const_string</a>(v2, const_test);</div>
<div class="line">  <a class="code" href="omlc_8h.html#acc937f4c5d6c581360ddb3862e83590d">omlc_copy_string</a>(v, v2);</div>
<div class="line">  fail_if(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v2) == <a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v),</div>
<div class="line">      <span class="stringliteral">&quot;Const copy string pointer not allocated properly&quot;</span>);</div>
<div class="line">  fail_if(strcmp(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v2), <a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v)),</div>
<div class="line">      <span class="stringliteral">&quot;Const copy string mismatch (&#39;%s&#39; instead of &#39;%s&#39;)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v2), <a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v));</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(v) == strlen(const_test),</div>
<div class="line">      <span class="stringliteral">&quot;Const copy string length not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(v), strlen(const_test));</div>
<div class="line">  alloc_diff = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() - bcount - <span class="keyword">sizeof</span>(size_t);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line">  fail_if(alloc_diff &lt; strlen(const_test) + 1,</div>
<div class="line">      <span class="stringliteral">&quot;Const copy string allocated memory not big enough (%d instead of at least %d)&quot;</span>,</div>
<div class="line">      alloc_diff, strlen(const_test) + 1);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v) == <a class="code" href="omlc_8h.html#a88226d4fc4230d78776f5e80e58e0265">oml_malloc_usable_size</a>(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v)),</div>
<div class="line">      <span class="stringliteral">&quot;Const copy string allocated size not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(v), <a class="code" href="omlc_8h.html#a88226d4fc4230d78776f5e80e58e0265">oml_malloc_usable_size</a>(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v)));</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#af92eb9184595d55f73920ed167f8b333">omlc_get_string_is_const</a>(v) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Const copy string should not be constant&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="omlc_8h.html#a1434bd8b5a841357336609930bdb05c3">omlc_reset_string</a>(v);</div>
<div class="line">  <a class="code" href="omlc_8h.html#a1434bd8b5a841357336609930bdb05c3">omlc_reset_string</a>(v2);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa5f7b3b8d0a8ca705f33c7f7b2b3aed2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">END_TEST START_TEST </td>
          <td>(</td>
          <td class="paramtype">test_blobU&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00173">173</a> of file <a class="el" href="check__liboml2__omlvalue_8c_source.html">check_liboml2_omlvalue.c</a>.</p>

<p>References <a class="el" href="mem_8c_source.html#l00228">oml_malloc_usable_size()</a>, <a class="el" href="omlc_8h_source.html#l00552">omlc_copy_blob</a>, <a class="el" href="omlc_8h_source.html#l00371">omlc_get_blob_length</a>, <a class="el" href="omlc_8h_source.html#l00368">omlc_get_blob_ptr</a>, <a class="el" href="omlc_8h_source.html#l00374">omlc_get_blob_size</a>, <a class="el" href="omlc_8h_source.html#l00340">omlc_get_string_ptr</a>, <a class="el" href="omlc_8h_source.html#l00535">omlc_reset_blob</a>, <a class="el" href="omlc_8h_source.html#l00538">omlc_set_blob</a>, <a class="el" href="omlc_8h_source.html#l00209">omlc_zero</a>, <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00406">str</a>, and <a class="el" href="mem_8c_source.html#l00071">xmembytes()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="unionOmlValueU.html">OmlValueU</a> v, v2;</div>
<div class="line">  <span class="keywordtype">char</span> *<a class="code" href="check__liboml2__omlvalue_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> = <span class="stringliteral">&quot;this is a string subtly disguised as a blob&quot;</span>;</div>
<div class="line">  <span class="keywordtype">char</span> *str2 = <span class="stringliteral">&quot;this is another string in blob&#39;s clothing, except longer&quot;</span>;</div>
<div class="line">  <span class="keywordtype">void</span> *test = (<span class="keywordtype">void</span>*) str;</div>
<div class="line">  <span class="keywordtype">void</span> *test2 = (<span class="keywordtype">void</span>*) str2;</div>
<div class="line">  <span class="keywordtype">size_t</span> len = strlen(str);</div>
<div class="line">  <span class="keywordtype">size_t</span> len2 = strlen(str2);</div>
<div class="line">  <span class="keywordtype">size_t</span> bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>(), alloc_diff, size;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="omlc_8h.html#a5cd79ce130e86f27ce8bae31400beffe">omlc_zero</a>(v);</div>
<div class="line">  <a class="code" href="omlc_8h.html#a5cd79ce130e86f27ce8bae31400beffe">omlc_zero</a>(v2);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Set blob (copy) */</span></div>
<div class="line">  <a class="code" href="omlc_8h.html#af59728cba3c4fd80c107c58fa9a1179c">omlc_set_blob</a>(v, test, len);</div>
<div class="line">  fail_if(<a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(v) == test,</div>
<div class="line">      <span class="stringliteral">&quot;Test blob pointer not allocated properly&quot;</span>);</div>
<div class="line">  fail_if(strncmp(test, <a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(v), len),</div>
<div class="line">      <span class="stringliteral">&quot;Test blob mismatch&quot;</span>);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a8889e12c16c598b5d1f633ab07680010">omlc_get_blob_length</a>(v) == len,</div>
<div class="line">      <span class="stringliteral">&quot;Test blob length not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#a8889e12c16c598b5d1f633ab07680010">omlc_get_blob_length</a>(v), len);</div>
<div class="line">  alloc_diff = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() - bcount - <span class="keyword">sizeof</span>(size_t);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line">  fail_if(alloc_diff &lt; len,</div>
<div class="line">      <span class="stringliteral">&quot;Test blob allocated memory not big enough (%d instead of at least %d)&quot;</span>,</div>
<div class="line">      alloc_diff, len);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a2ef476c30a6092cca9200a4e0342cc51">omlc_get_blob_size</a>(v) == <a class="code" href="omlc_8h.html#a88226d4fc4230d78776f5e80e58e0265">oml_malloc_usable_size</a>(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v)),</div>
<div class="line">      <span class="stringliteral">&quot;Test blob allocated size not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#a2ef476c30a6092cca9200a4e0342cc51">omlc_get_blob_size</a>(v), <a class="code" href="omlc_8h.html#a88226d4fc4230d78776f5e80e58e0265">oml_malloc_usable_size</a>(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(v)));</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Duplicate blob*/</span></div>
<div class="line">  <a class="code" href="omlc_8h.html#a6c4151e64ab407dac759eab6de0d50ae">omlc_copy_blob</a>(v2, v);</div>
<div class="line">  fail_if(<a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(v2) == <a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(v),</div>
<div class="line">      <span class="stringliteral">&quot;Copied blob not allocated properly&quot;</span>);</div>
<div class="line">  fail_if(strncmp(<a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(v2), <a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(v), len),</div>
<div class="line">      <span class="stringliteral">&quot;Copied allocated blob mismatch&quot;</span>);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a8889e12c16c598b5d1f633ab07680010">omlc_get_blob_length</a>(v2) == <a class="code" href="omlc_8h.html#a8889e12c16c598b5d1f633ab07680010">omlc_get_blob_length</a>(v),</div>
<div class="line">      <span class="stringliteral">&quot;Copied allocated blob length not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#a8889e12c16c598b5d1f633ab07680010">omlc_get_blob_length</a>(v2), <a class="code" href="omlc_8h.html#a8889e12c16c598b5d1f633ab07680010">omlc_get_blob_length</a>(v));</div>
<div class="line">  alloc_diff = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() - bcount - <span class="keyword">sizeof</span>(size_t);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line">  fail_if(alloc_diff &lt; len,</div>
<div class="line">      <span class="stringliteral">&quot;Copied allocated blob allocated memory not big enough (%d instead of at least %d)&quot;</span>,</div>
<div class="line">      alloc_diff, len);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a2ef476c30a6092cca9200a4e0342cc51">omlc_get_blob_size</a>(v) == <a class="code" href="omlc_8h.html#a88226d4fc4230d78776f5e80e58e0265">oml_malloc_usable_size</a>(<a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(v2)),</div>
<div class="line">      <span class="stringliteral">&quot;Copied allocated blob allocated size not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#a2ef476c30a6092cca9200a4e0342cc51">omlc_get_blob_size</a>(v2), <a class="code" href="omlc_8h.html#a88226d4fc4230d78776f5e80e58e0265">oml_malloc_usable_size</a>(<a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(v2)));</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Overwrite blob */</span></div>
<div class="line">  <a class="code" href="omlc_8h.html#af59728cba3c4fd80c107c58fa9a1179c">omlc_set_blob</a>(v, test2, len2);</div>
<div class="line">  <span class="comment">/* We know omlc_set_blob() already sets properly, we just want to check it does cleanup previously allocated memory */</span></div>
<div class="line">  fail_if(<a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() &gt; bcount + <a class="code" href="omlc_8h.html#a2ef476c30a6092cca9200a4e0342cc51">omlc_get_blob_size</a>(v),</div>
<div class="line">      <span class="stringliteral">&quot;Overwritten blob did not deallocate memory properly (%d used but expected %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>(), bcount + <a class="code" href="omlc_8h.html#a2ef476c30a6092cca9200a4e0342cc51">omlc_get_blob_size</a>(v));</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Reset blob and clear allocated pointer */</span></div>
<div class="line">  <a class="code" href="omlc_8h.html#afd4a7d8b9b3f9c09228329b443e07afd">omlc_reset_blob</a>(v);</div>
<div class="line">  size = <a class="code" href="omlc_8h.html#a2ef476c30a6092cca9200a4e0342cc51">omlc_get_blob_size</a>(v);</div>
<div class="line">  <a class="code" href="omlc_8h.html#afd4a7d8b9b3f9c09228329b443e07afd">omlc_reset_blob</a>(v);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(v) == NULL,</div>
<div class="line">      <span class="stringliteral">&quot;Reset allocated blob pointer not cleared properly&quot;</span>);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a8889e12c16c598b5d1f633ab07680010">omlc_get_blob_length</a>(v) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Reset allocated blob length not cleared properly&quot;</span>);</div>
<div class="line">  alloc_diff = bcount - <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() + <span class="keyword">sizeof</span>(size_t);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line">  fail_if(alloc_diff &lt;= size,</div>
<div class="line">      <span class="stringliteral">&quot;Reset allocated blob didn&#39;t free the memory as expected (%d freed instead at least %d)&quot;</span>,</div>
<div class="line">      alloc_diff, size);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a2ef476c30a6092cca9200a4e0342cc51">omlc_get_blob_size</a>(v) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Reset allocated blob allocated size not cleared properly&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="omlc_8h.html#afd4a7d8b9b3f9c09228329b443e07afd">omlc_reset_blob</a>(v2);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a153b0fa0e939662dfc9400de0d866164"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">START_TEST </td>
          <td>(</td>
          <td class="paramtype">test_intrinsic&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00263">263</a> of file <a class="el" href="check__liboml2__omlvalue_8c_source.html">check_liboml2_omlvalue.c</a>.</p>

<p>References <a class="el" href="omlc_8h_source.html#l00209">omlc_zero</a>, and <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00250">test_i</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="unionOmlValueU.html">OmlValueU</a> to, from;</div>
<div class="line">  int32_t i32 = -123234;</div>
<div class="line">  uint32_t u32 = 128937;</div>
<div class="line">  int64_t i64 = -123234892374;</div>
<div class="line">  uint64_t u64 = 128939087987;</div>
<div class="line">  <span class="keywordtype">double</span> d = M_PI;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="omlc_8h.html#a5cd79ce130e86f27ce8bae31400beffe">omlc_zero</a>(to);</div>
<div class="line">  <a class="code" href="omlc_8h.html#a5cd79ce130e86f27ce8bae31400beffe">omlc_zero</a>(from);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="check__liboml2__omlvalue_8c.html#af42b59aa48ef39695135a2bb2b9a6ffa">test_i</a>(int32, i32, <span class="stringliteral">&quot;i&quot;</span>);</div>
<div class="line">  <a class="code" href="check__liboml2__omlvalue_8c.html#af42b59aa48ef39695135a2bb2b9a6ffa">test_i</a>(uint32, u32, <span class="stringliteral">&quot;u&quot;</span>);</div>
<div class="line">  <a class="code" href="check__liboml2__omlvalue_8c.html#af42b59aa48ef39695135a2bb2b9a6ffa">test_i</a>(int64, i64, PRId64);</div>
<div class="line">  <a class="code" href="check__liboml2__omlvalue_8c.html#af42b59aa48ef39695135a2bb2b9a6ffa">test_i</a>(uint64, u64, PRIu64);</div>
<div class="line">  <a class="code" href="check__liboml2__omlvalue_8c.html#af42b59aa48ef39695135a2bb2b9a6ffa">test_i</a>(<span class="keywordtype">double</span>, d, <span class="stringliteral">&quot;f&quot;</span>);</div>
<div class="line">  <a class="code" href="check__liboml2__omlvalue_8c.html#af42b59aa48ef39695135a2bb2b9a6ffa">test_i</a>(<span class="keywordtype">bool</span>, 0, <span class="stringliteral">&quot;d&quot;</span>);</div>
<div class="line">  <a class="code" href="check__liboml2__omlvalue_8c.html#af42b59aa48ef39695135a2bb2b9a6ffa">test_i</a>(<span class="keywordtype">bool</span>, 1, <span class="stringliteral">&quot;d&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5a214de0401858745568f777ce712c43"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">END_TEST START_TEST </td>
          <td>(</td>
          <td class="paramtype">test_string&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00285">285</a> of file <a class="el" href="check__liboml2__omlvalue_8c_source.html">check_liboml2_omlvalue.c</a>.</p>

<p>References <a class="el" href="mem_8c_source.html#l00228">oml_malloc_usable_size()</a>, <a class="el" href="omlc_8h_source.html#l00039">OML_STRING_VALUE</a>, <a class="el" href="omlc_8h_source.html#l00043">OML_UINT64_VALUE</a>, <a class="el" href="oml__value_8c_source.html#l00283">oml_value_duplicate()</a>, <a class="el" href="oml__value_8h_source.html#l00051">oml_value_get_value</a>, <a class="el" href="oml__value_8c_source.html#l00081">oml_value_init()</a>, <a class="el" href="oml__value_8c_source.html#l00217">oml_value_reset()</a>, <a class="el" href="oml__value_8c_source.html#l00146">oml_value_set()</a>, <a class="el" href="oml__value_8c_source.html#l00109">oml_value_set_type()</a>, <a class="el" href="omlc_8h_source.html#l00350">omlc_get_string_is_const</a>, <a class="el" href="omlc_8h_source.html#l00344">omlc_get_string_length</a>, <a class="el" href="omlc_8h_source.html#l00340">omlc_get_string_ptr</a>, <a class="el" href="omlc_8h_source.html#l00347">omlc_get_string_size</a>, <a class="el" href="omlc_8h_source.html#l00457">omlc_reset_string</a>, <a class="el" href="omlc_8h_source.html#l00523">omlc_set_const_string</a>, <a class="el" href="omlc_8h_source.html#l00209">omlc_zero</a>, and <a class="el" href="mem_8c_source.html#l00071">xmembytes()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span> *test = <span class="stringliteral">&quot;test&quot;</span>;</div>
<div class="line">  <a class="code" href="structOmlValue.html">OmlValue</a> v, v2;</div>
<div class="line">  <a class="code" href="unionOmlValueU.html">OmlValueU</a> vu;</div>
<div class="line">  <span class="keywordtype">size_t</span> bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line">  <span class="keywordtype">size_t</span> alloc_diff;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="oml__value_8c.html#aecf953b9ce05c582c030eec0e962c69c">oml_value_init</a>(&amp;v);</div>
<div class="line">  <a class="code" href="oml__value_8c.html#aecf953b9ce05c582c030eec0e962c69c">oml_value_init</a>(&amp;v2);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="omlc_8h.html#a5cd79ce130e86f27ce8bae31400beffe">omlc_zero</a>(vu);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Prepare the OmlValueU to be duplicated in the OmlValue */</span></div>
<div class="line">  <a class="code" href="omlc_8h.html#a6d211b7fc65c6ac5085dc43e8822f3d9">omlc_set_const_string</a>(vu, test);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="oml__value_8c.html#abce36c5bb2beea2a56812e84b9f1a7fa">oml_value_set</a>(&amp;v, &amp;vu, <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012a42b33eb7c21f79727a894a530a05b559">OML_STRING_VALUE</a>);</div>
<div class="line">  alloc_diff = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() - bcount - <span class="keyword">sizeof</span>(size_t);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line">  fail_if(alloc_diff &lt; strlen(test) + 1,</div>
<div class="line">      <span class="stringliteral">&quot;OmlValue string allocated memory not big enough (%d instead of at least %d)&quot;</span>,</div>
<div class="line">      alloc_diff, strlen(test) + 1);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="oml__value_8c.html#a5488479a807e78eeea40322a4ca851e3">oml_value_duplicate</a>(&amp;v2, &amp;v);</div>
<div class="line">  fail_if(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)) == <a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v)),</div>
<div class="line">      <span class="stringliteral">&quot;Copied OmlValue string pointer not allocated properly&quot;</span>);</div>
<div class="line">  fail_if(strcmp(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)), <a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v))),</div>
<div class="line">      <span class="stringliteral">&quot;Copied OmlValue string mismatch (&#39;%s&#39; instead of &#39;%s&#39;)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)), <a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v)));</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)) == strlen(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2))),</div>
<div class="line">      <span class="stringliteral">&quot;Copied OmlValue string length not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#ac67055f6576df153bd9915dd7ccb2f6d">omlc_get_string_length</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)), strlen(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2))) + 1);</div>
<div class="line">  alloc_diff = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() - bcount - <span class="keyword">sizeof</span>(size_t); <span class="comment">/* oml_malloc() always allocates at least sizeof(size_t) more for bookkeeping */</span></div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line">  fail_if(alloc_diff &lt; strlen(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v))) + 1,</div>
<div class="line">      <span class="stringliteral">&quot;Copied OmlValue string allocated memory not big enough (%d instead of at least %d)&quot;</span>,</div>
<div class="line">      alloc_diff, strlen(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v))) + 1);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)) == <a class="code" href="omlc_8h.html#a88226d4fc4230d78776f5e80e58e0265">oml_malloc_usable_size</a>(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2))),</div>
<div class="line">      <span class="stringliteral">&quot;Copied OmlValue string allocated size not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#a4508f73b57c047bda51c92e4a006894c">omlc_get_string_size</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)), <a class="code" href="omlc_8h.html#a88226d4fc4230d78776f5e80e58e0265">oml_malloc_usable_size</a>(<a class="code" href="omlc_8h.html#ae5077b9404ef5c4c2f66a1a654430512">omlc_get_string_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2))));</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#af92eb9184595d55f73920ed167f8b333">omlc_get_string_is_const</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)) == 0,</div>
<div class="line">      <span class="stringliteral">&quot;Copied OmlValue string should not be constant&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="oml__value_8c.html#a7213e167ca9eb81228f8b7952e99f8c9">oml_value_set_type</a>(&amp;v, <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012aa0ecc1e475955c44a641c75e841ca2fc">OML_UINT64_VALUE</a>);</div>
<div class="line">  fail_unless(<a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() &lt; bcount,</div>
<div class="line">      <span class="stringliteral">&quot;OmlValue string  was not freed after oml_value_set_type() (%d allocated, which is not less than %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>(), bcount);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line"></div>
<div class="line">  <a class="code" href="oml__value_8c.html#ad73bf2617858cdc9c70722e1ca91eea3">oml_value_reset</a>(&amp;v2);</div>
<div class="line">  fail_unless(<a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() &lt; bcount,</div>
<div class="line">      <span class="stringliteral">&quot;OmlValue string  was not freed after oml_value_reset() (%d allocated, which is not less than %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>(), bcount);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line"></div>
<div class="line">  <a class="code" href="oml__value_8c.html#ad73bf2617858cdc9c70722e1ca91eea3">oml_value_reset</a>(&amp;v);</div>
<div class="line">  <a class="code" href="omlc_8h.html#a1434bd8b5a841357336609930bdb05c3">omlc_reset_string</a>(vu);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a90e5907592e0551f03c1c0cbd484e4d7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">END_TEST START_TEST </td>
          <td>(</td>
          <td class="paramtype">test_blob&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00345">345</a> of file <a class="el" href="check__liboml2__omlvalue_8c_source.html">check_liboml2_omlvalue.c</a>.</p>

<p>References <a class="el" href="omlc_8h_source.html#l00044">OML_BLOB_VALUE</a>, <a class="el" href="mem_8c_source.html#l00228">oml_malloc_usable_size()</a>, <a class="el" href="omlc_8h_source.html#l00043">OML_UINT64_VALUE</a>, <a class="el" href="oml__value_8c_source.html#l00283">oml_value_duplicate()</a>, <a class="el" href="oml__value_8h_source.html#l00051">oml_value_get_value</a>, <a class="el" href="oml__value_8c_source.html#l00081">oml_value_init()</a>, <a class="el" href="oml__value_8c_source.html#l00217">oml_value_reset()</a>, <a class="el" href="oml__value_8c_source.html#l00146">oml_value_set()</a>, <a class="el" href="oml__value_8c_source.html#l00109">oml_value_set_type()</a>, <a class="el" href="omlc_8h_source.html#l00371">omlc_get_blob_length</a>, <a class="el" href="omlc_8h_source.html#l00368">omlc_get_blob_ptr</a>, <a class="el" href="omlc_8h_source.html#l00374">omlc_get_blob_size</a>, <a class="el" href="omlc_8h_source.html#l00535">omlc_reset_blob</a>, <a class="el" href="omlc_8h_source.html#l00538">omlc_set_blob</a>, <a class="el" href="omlc_8h_source.html#l00209">omlc_zero</a>, <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00406">str</a>, and <a class="el" href="mem_8c_source.html#l00071">xmembytes()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span> *<a class="code" href="check__liboml2__omlvalue_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> = <span class="stringliteral">&quot;this is a string subtly disguised as a blob&quot;</span>;</div>
<div class="line">  <a class="code" href="structOmlValue.html">OmlValue</a> v, v2;</div>
<div class="line">  <a class="code" href="unionOmlValueU.html">OmlValueU</a> vu;</div>
<div class="line">  <span class="keywordtype">size_t</span> len = strlen(str);</div>
<div class="line">  <span class="keywordtype">void</span> *test = (<span class="keywordtype">void</span>*)str;</div>
<div class="line">  <span class="keywordtype">size_t</span> bcount;</div>
<div class="line">  <span class="keywordtype">size_t</span> alloc_diff;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="oml__value_8c.html#aecf953b9ce05c582c030eec0e962c69c">oml_value_init</a>(&amp;v);</div>
<div class="line">  <a class="code" href="oml__value_8c.html#aecf953b9ce05c582c030eec0e962c69c">oml_value_init</a>(&amp;v2);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="omlc_8h.html#a5cd79ce130e86f27ce8bae31400beffe">omlc_zero</a>(vu);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Prepare the OmlValueU to be duplicated in the OmlValue */</span></div>
<div class="line">  <a class="code" href="omlc_8h.html#af59728cba3c4fd80c107c58fa9a1179c">omlc_set_blob</a>(vu, test, len);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line"></div>
<div class="line">  <a class="code" href="oml__value_8c.html#abce36c5bb2beea2a56812e84b9f1a7fa">oml_value_set</a>(&amp;v, &amp;vu, <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012aea7273ecb417f61976d2089a31e75037">OML_BLOB_VALUE</a>);</div>
<div class="line">  alloc_diff = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() - bcount - <span class="keyword">sizeof</span>(size_t);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line">  fail_if(alloc_diff &lt; len,</div>
<div class="line">      <span class="stringliteral">&quot;OmlValue blob allocated memory not big enough (%d instead of at least %d)&quot;</span>,</div>
<div class="line">      alloc_diff, len);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="oml__value_8c.html#a5488479a807e78eeea40322a4ca851e3">oml_value_duplicate</a>(&amp;v2, &amp;v);</div>
<div class="line">  fail_if(<a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)) == <a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v)),</div>
<div class="line">      <span class="stringliteral">&quot;Copied OmlValue blob pointer not allocated properly&quot;</span>);</div>
<div class="line">  fail_if(strncmp(<a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)), <a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v)), len),</div>
<div class="line">      <span class="stringliteral">&quot;Copied OmlValue blob mismatch&quot;</span>);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a8889e12c16c598b5d1f633ab07680010">omlc_get_blob_length</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)) == <a class="code" href="omlc_8h.html#a8889e12c16c598b5d1f633ab07680010">omlc_get_blob_length</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v)),</div>
<div class="line">      <span class="stringliteral">&quot;Copied OmlValue blob length not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#a8889e12c16c598b5d1f633ab07680010">omlc_get_blob_length</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)), <a class="code" href="omlc_8h.html#a8889e12c16c598b5d1f633ab07680010">omlc_get_blob_length</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)));</div>
<div class="line">  alloc_diff = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() - bcount - <span class="keyword">sizeof</span>(size_t); <span class="comment">/* oml_malloc() always allocates at least sizeof(size_t) more for bookkeeping */</span></div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line">  fail_if(alloc_diff &lt; len,</div>
<div class="line">      <span class="stringliteral">&quot;Copied OmlValue blob allocated memory not big enough (%d instead of at least %d)&quot;</span>,</div>
<div class="line">      alloc_diff, len);</div>
<div class="line">  fail_unless(<a class="code" href="omlc_8h.html#a2ef476c30a6092cca9200a4e0342cc51">omlc_get_blob_size</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)) == <a class="code" href="omlc_8h.html#a88226d4fc4230d78776f5e80e58e0265">oml_malloc_usable_size</a>(<a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2))),</div>
<div class="line">      <span class="stringliteral">&quot;Copied OmlValue blob allocated size not set properly (%d instead of %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="omlc_8h.html#a2ef476c30a6092cca9200a4e0342cc51">omlc_get_blob_size</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2)), <a class="code" href="omlc_8h.html#a88226d4fc4230d78776f5e80e58e0265">oml_malloc_usable_size</a>(<a class="code" href="omlc_8h.html#ab27d41701e48bc5ebd9e41e21e771cf6">omlc_get_blob_ptr</a>(*<a class="code" href="oml__value_8h.html#a4f590bee663b713f2afeee50ca06260b">oml_value_get_value</a>(&amp;v2))));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="oml__value_8c.html#a7213e167ca9eb81228f8b7952e99f8c9">oml_value_set_type</a>(&amp;v, <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012aa0ecc1e475955c44a641c75e841ca2fc">OML_UINT64_VALUE</a>);</div>
<div class="line">  fail_unless(<a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() &lt; bcount,</div>
<div class="line">      <span class="stringliteral">&quot;OmlValue blob  was not freed after oml_value_set_type() (%d allocated, which is not less than %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>(), bcount);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line"></div>
<div class="line">  <a class="code" href="oml__value_8c.html#ad73bf2617858cdc9c70722e1ca91eea3">oml_value_reset</a>(&amp;v2);</div>
<div class="line">  fail_unless(<a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>() &lt; bcount,</div>
<div class="line">      <span class="stringliteral">&quot;OmlValue blob  was not freed after oml_value_reset() (%d allocated, which is not less than %d)&quot;</span>,</div>
<div class="line">      <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>(), bcount);</div>
<div class="line">  bcount = <a class="code" href="mem_8c.html#ad97124824e8df0d9d39bfbbde478f1b2">xmembytes</a>();</div>
<div class="line"></div>
<div class="line">  <a class="code" href="oml__value_8c.html#ad73bf2617858cdc9c70722e1ca91eea3">oml_value_reset</a>(&amp;v);</div>
<div class="line">  <a class="code" href="omlc_8h.html#afd4a7d8b9b3f9c09228329b443e07afd">omlc_reset_blob</a>(vu);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4a01e6877c75c574b138bc06549a4129"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">START_TEST </td>
          <td>(</td>
          <td class="paramtype">test_bool_loop&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00420">420</a> of file <a class="el" href="check__liboml2__omlvalue_8c_source.html">check_liboml2_omlvalue.c</a>.</p>

<p>References <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00407">b</a>, <a class="el" href="oml__value_8c_source.html#l00850">oml_value_string_to_bool()</a>, and <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00406">str</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  fail_unless(<a class="code" href="oml__value_8c.html#ac52077e026472e534df0e0ae38c8ba4e">oml_value_string_to_bool</a>(booltest[_i].<a class="code" href="check__liboml2__omlvalue_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>) == booltest[_i].<a class="code" href="check__liboml2__omlvalue_8c.html#a4313c9563516f94387762ab05763456b">b</a>,</div>
<div class="line">      <span class="stringliteral">&quot;&#39;%s&#39; was not resolved as bool %d&quot;</span>, booltest[_i].str?booltest[_i].str:<span class="stringliteral">&quot;(nil)&quot;</span>, booltest[_i].b);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<h2>Variable Documentation</h2>
<a class="anchor" id="a4313c9563516f94387762ab05763456b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t b</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00407">407</a> of file <a class="el" href="check__liboml2__omlvalue_8c_source.html">check_liboml2_omlvalue.c</a>.</p>

<p>Referenced by <a class="el" href="check__libshared__marshal_8c_source.html#l00324">relative_error()</a>, and <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00420">START_TEST()</a>.</p>

</div>
</div>
<a class="anchor" id="af25d6dc49269fa2003ac7c7fa6f13915"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* str</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00406">406</a> of file <a class="el" href="check__liboml2__omlvalue_8c_source.html">check_liboml2_omlvalue.c</a>.</p>

<p>Referenced by <a class="el" href="stddev_8py_source.html#l00034">stddev::cvec_string()</a>, <a class="el" href="oml__util_8c_source.html#l00089">find_charn()</a>, <a class="el" href="headers_8c_source.html#l00286">header_from_string()</a>, <a class="el" href="marshal_8c_source.html#l00577">marshal_value()</a>, <a class="el" href="psql__adapter_8c_source.html#l00127">psql_backend_setup()</a>, <a class="el" href="psql__adapter_8c_source.html#l00242">psql_create_database()</a>, <a class="el" href="schema_8c_source.html#l00306">schema_to_meta()</a>, <a class="el" href="self-inst_8py_source.html#l00040">self-inst::selftest()</a>, <a class="el" href="testclient_8c_source.html#l00161">set_value()</a>, <a class="el" href="check__liboml2__omlvalue_8c_source.html#l00173">START_TEST()</a>, <a class="el" href="headers_8c_source.html#l00209">tag_from_string()</a>, <a class="el" href="check__util_8c_source.html#l00163">vector_values_stringify()</a>, and <a class="el" href="check__util_8c_source.html#l00180">vector_values_ut_stringify()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_13e138d54eb8818da29c3992edef070a.html">test</a></li><li class="navelem"><a class="el" href="dir_cb6d4dd8a38058a0954022986ea6be37.html">lib</a></li><li class="navelem"><a class="el" href="check__liboml2__omlvalue_8c.html">check_liboml2_omlvalue.c</a></li>
    <li class="footer">Generated on Thu Jun 25 2015 15:31:54 for oml2 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
