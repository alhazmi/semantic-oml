<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>oml2: init.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="oml_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">oml2
   &#160;<span id="projectnumber">2.12.0pre.79-58cf-dirty</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('init_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">init.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implement the user-visible initialisation routines of the user-visible OML API.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;ctype.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &lt;sys/time.h&gt;</code><br/>
<code>#include &lt;time.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="omlc_8h_source.html">oml2/omlc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="oml__filter_8h_source.html">oml2/oml_filter.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="oml__writer_8h_source.html">oml2/oml_writer.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="o__log_8h_source.html">ocomm/o_log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="mem_8h_source.html">mem.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="mstring_8h_source.html">mstring.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="oml__value_8h_source.html">oml_value.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="validate_8h_source.html">validate.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="factory_8h_source.html">filter/factory.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="oml__util_8h_source.html">oml_util.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="client_8h_source.html">client.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for init.c:</div>
<div class="dyncontent">
<div class="center"><img src="init_8c__incl.png" border="0" usemap="#init_8c" alt=""/></div>
<map name="init_8c" id="init_8c">
<area shape="rect" id="node17" href="omlc_8h.html" title="Public API of the OML client library." alt="" coords="439,315,532,344"/><area shape="rect" id="node28" href="o__log_8h.html" title="ocomm/o_log.h" alt="" coords="772,392,882,421"/><area shape="rect" id="node32" href="oml__filter_8h.html" title="Abstract interface for filters." alt="" coords="391,160,508,189"/><area shape="rect" id="node35" href="oml__writer_8h.html" title="Abstract interface for writers." alt="" coords="382,237,507,267"/><area shape="rect" id="node40" href="mem_8h.html" title="mem.h" alt="" coords="928,315,990,344"/><area shape="rect" id="node45" href="mstring_8h.html" title="mstring.h" alt="" coords="990,160,1064,189"/><area shape="rect" id="node48" href="oml__value_8h.html" title="oml_value.h" alt="" coords="763,237,854,267"/><area shape="rect" id="node55" href="validate_8h.html" title="validate.h" alt="" coords="975,83,1052,112"/><area shape="rect" id="node57" href="factory_8h.html" title="filter/factory.h" alt="" coords="532,83,634,112"/><area shape="rect" id="node60" href="oml__util_8h.html" title="oml_util.h" alt="" coords="1127,83,1204,112"/><area shape="rect" id="node62" href="client_8h.html" title="Defines various structures and functions used by various parts." alt="" coords="708,83,772,112"/><area shape="rect" id="node70" href="oml__out__stream_8h.html" title="Abstract interface for output streams." alt="" coords="582,237,739,267"/></map>
</div>
</div>
<p><a href="init_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ab32f71cc3deb43c84b63074fb3fe99cb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#ab32f71cc3deb43c84b63074fb3fe99cb">OMLC_COPYRIGHT</a>&#160;&#160;&#160;&quot;Copyright 2007-2014, NICTA&quot;</td></tr>
<tr class="memitem:a9afa58be18a5e6c1299ff83e87850267"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a9afa58be18a5e6c1299ff83e87850267">DEF_LOG_LEVEL</a>&#160;&#160;&#160;= <a class="el" href="o__log_8h.html#aa867321b24d858837927a020a40e30af">O_LOG_INFO</a>;</td></tr>
<tr class="memitem:a303bda1a775ca4c9e897be2a1cb7f971"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a303bda1a775ca4c9e897be2a1cb7f971">DEFAULT_SCHEMA_LENGTH</a>&#160;&#160;&#160;2048</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a79d9c664197941182edb1fde2b7b0a9f"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a79d9c664197941182edb1fde2b7b0a9f">sighandler</a> )(int)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a364a05acae7db3091162b661cf0ed245"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a364a05acae7db3091162b661cf0ed245">parse_config</a> (char *config_file)</td></tr>
<tr class="memitem:a7d59c725c0197f45301bf777dec8a49d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a7d59c725c0197f45301bf777dec8a49d">omlc_init</a> (const char *application, int *pargc, const char **argv, <a class="el" href="o__log_8h.html#a69596e3d9e045591318cfc6d660c8f64">o_log_fn</a> custom_oml_log)</td></tr>
<tr class="memitem:a50aae756ce043a9b74775a48c13aba0c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOMLSemDef.html">OMLSemDef</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a50aae756ce043a9b74775a48c13aba0c">destroy_sem_concepts</a> (<a class="el" href="structOMLSemDef.html">OMLSemDef</a> *sd)</td></tr>
<tr class="memitem:a13e1026b136bfacfbb3764d454241db0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOmlMP.html">OmlMP</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a13e1026b136bfacfbb3764d454241db0">omlc_add_mp</a> (const char *mp_name, <a class="el" href="structOmlMPDef.html">OmlMPDef</a> *<a class="el" href="check__liboml2__config_8c.html#a390ebaee0bf455c72a8df44f5dd345e7">mp_def</a>)</td></tr>
<tr class="memitem:a5c58a22585f34e6edca9eb67b897cc4e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOMLSemDef.html">OMLSemDef</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a5c58a22585f34e6edca9eb67b897cc4e">oml_sem_register_concepts</a> (char ***concepts, int n)</td></tr>
<tr class="memitem:ac821f21a0da9c8aae8be1cac73331166"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOmlMP.html">OmlMP</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#ac821f21a0da9c8aae8be1cac73331166">destroy_mp</a> (<a class="el" href="structOmlMP.html">OmlMP</a> *<a class="el" href="structmp.html">mp</a>)</td></tr>
<tr class="memitem:a2e2497cb5b09c1c6d9b634d2d60db587"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a2e2497cb5b09c1c6d9b634d2d60db587">omlc_start</a> ()</td></tr>
<tr class="memitem:a5870e99b923df20b3d7c16397bb88d87"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a5870e99b923df20b3d7c16397bb88d87">omlc_close</a> (void)</td></tr>
<tr class="memitem:a38839581577d7fc5c4529eba39289987"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOmlWriter.html">OmlWriter</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a38839581577d7fc5c4529eba39289987">create_writer</a> (const char *uri, enum <a class="el" href="oml__writer_8h.html#a959172e0c35e858e1ade72178cf27173">StreamEncoding</a> encoding)</td></tr>
<tr class="memitem:a2b7b282aa3dee35bbc5656e9ce5204c9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOmlMP.html">OmlMP</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a2b7b282aa3dee35bbc5656e9ce5204c9">find_mp</a> (const char *<a class="el" href="check__text__protocol_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)</td></tr>
<tr class="memitem:adb0da318e59f1e48cbef3255e272ebdf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#adb0da318e59f1e48cbef3255e272ebdf">find_mp_field</a> (const char *<a class="el" href="check__text__protocol_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="el" href="structOmlMP.html">OmlMP</a> *<a class="el" href="structmp.html">mp</a>)</td></tr>
<tr class="memitem:a9702786aa9c44bc70b9525025de8740a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structMString.html">MString</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a9702786aa9c44bc70b9525025de8740a">mp_fields_summary</a> (<a class="el" href="structOmlMP.html">OmlMP</a> *<a class="el" href="structmp.html">mp</a>)</td></tr>
<tr class="memitem:aceaf7c6f990869cc30bb729f2addf5e7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOmlMStream.html">OmlMStream</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#aceaf7c6f990869cc30bb729f2addf5e7">find_mstream_in_mp</a> (const char *<a class="el" href="check__text__protocol_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="el" href="structOmlMP.html">OmlMP</a> *<a class="el" href="structmp.html">mp</a>)</td></tr>
<tr class="memitem:a17d38a142ff7946ea46d63b5e761ae63"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOmlMStream.html">OmlMStream</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a17d38a142ff7946ea46d63b5e761ae63">find_mstream</a> (const char *<a class="el" href="check__text__protocol_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)</td></tr>
<tr class="memitem:aae69d5e89a47ef7b1324df2155bcfa8b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOmlMStream.html">OmlMStream</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#aae69d5e89a47ef7b1324df2155bcfa8b">create_mstream</a> (const char *<a class="el" href="check__text__protocol_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="el" href="structOmlMP.html">OmlMP</a> *<a class="el" href="structmp.html">mp</a>, <a class="el" href="structOmlWriter.html">OmlWriter</a> *writer, double sample_interval, int sample_thres)</td></tr>
<tr class="memitem:a94accc8192536cbda920a4f3adf26c34"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a94accc8192536cbda920a4f3adf26c34">oml_ms_add_writer</a> (<a class="el" href="structOmlMStream.html">OmlMStream</a> *ms, <a class="el" href="structOmlWriter.html">OmlWriter</a> *w)</td></tr>
<tr class="memitem:a96b21fffa7aa1578b2a2a163422cfffe"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOmlMStream.html">OmlMStream</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a96b21fffa7aa1578b2a2a163422cfffe">destroy_ms</a> (<a class="el" href="structOmlMStream.html">OmlMStream</a> *ms)</td></tr>
<tr class="memitem:a5c8c53afa6d604173e0abd9b2a824089"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOmlMStream.html">OmlMStream</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a5c8c53afa6d604173e0abd9b2a824089">oml_mp_get_default_ms</a> (<a class="el" href="structOmlMP.html">OmlMP</a> *<a class="el" href="structmp.html">mp</a>)</td></tr>
<tr class="memitem:accd762f6cd773e4bfb598096410b0bf5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#accd762f6cd773e4bfb598096410b0bf5">create_default_filters</a> (<a class="el" href="structOmlMP.html">OmlMP</a> *<a class="el" href="structmp.html">mp</a>, <a class="el" href="structOmlMStream.html">OmlMStream</a> *ms)</td></tr>
<tr class="memitem:ab4756e8f48a7af991ab99e4e5894af52"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOmlFilter.html">OmlFilter</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#ab4756e8f48a7af991ab99e4e5894af52">create_default_filter</a> (<a class="el" href="structOmlMPDef.html">OmlMPDef</a> *def, <a class="el" href="structOmlMStream.html">OmlMStream</a> *ms, int index)</td></tr>
<tr class="memitem:a4412addfb041b81d8b5dd6ce44153952"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a4412addfb041b81d8b5dd6ce44153952">validate_app_name</a> (const char *<a class="el" href="check__text__protocol_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ae265e6c78eb3c0a1f4fdb40fe894394e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOmlClient.html">OmlClient</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a> = NULL</td></tr>
<tr class="memitem:ab37d06b7aa57f34099a4dbcff29635b7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structOmlMP.html">OmlMP</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#ab37d06b7aa57f34099a4dbcff29635b7">schema0</a></td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Implement the user-visible initialisation routines of the user-visible OML API. </p>

<p>Definition in file <a class="el" href="init_8c_source.html">init.c</a>.</p>
</div><h2>Macro Definition Documentation</h2>
<a class="anchor" id="a9afa58be18a5e6c1299ff83e87850267"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEF_LOG_LEVEL&#160;&#160;&#160;= <a class="el" href="o__log_8h.html#aa867321b24d858837927a020a40e30af">O_LOG_INFO</a>;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="init_8c_source.html#l00042">42</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

</div>
</div>
<a class="anchor" id="a303bda1a775ca4c9e897be2a1cb7f971"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_SCHEMA_LENGTH&#160;&#160;&#160;2048</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write the different schemas of the application</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ms</td><td>the stream definition </td></tr>
    <tr><td class="paramname">index</td><td>the index in the measurement points, used to initialias <a class="el" href="structOmlMStream.html#a3634b519ff9e471bac5741b5d8f3c2b0">OmlMStream::index</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if successful </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l01365">1365</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab32f71cc3deb43c84b63074fb3fe99cb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OMLC_COPYRIGHT&#160;&#160;&#160;&quot;Copyright 2007-2014, NICTA&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="init_8c_source.html#l00038">38</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00096">omlc_init()</a>.</p>

</div>
</div>
<h2>Typedef Documentation</h2>
<a class="anchor" id="a79d9c664197941182edb1fde2b7b0a9f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* sighandler)(int)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A function pointer suitable for sigaction(3) </p>

<p>Definition at line <a class="el" href="init_8c_source.html#l00063">63</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

</div>
</div>
<h2>Function Documentation</h2>
<a class="anchor" id="ab4756e8f48a7af991ab99e4e5894af52"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOmlFilter.html">OmlFilter</a>* create_default_filter </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOmlMPDef.html">OmlMPDef</a> *&#160;</td>
          <td class="paramname"><em>def</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structOmlMStream.html">OmlMStream</a> *&#160;</td>
          <td class="paramname"><em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a new filter for the measurement associated with the stream </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">def</td><td><a class="el" href="structOmlMPDef.html">OmlMPDef</a> of the MP for which to create a filter </td></tr>
    <tr><td class="paramname">ms</td><td><a class="el" href="structOmlMStream.html">OmlMStream</a> in which the filter outputs its samples </td></tr>
    <tr><td class="paramname">index</td><td>index of the field to filter within this MP </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a new filter </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l01224">1224</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="factory_8c_source.html#l00091">create_filter()</a>, <a class="el" href="omlc_8h_source.html#l00668">OmlMPDef::name</a>, <a class="el" href="init_8c_source.html#l01493">name</a>, <a class="el" href="omlc_8h_source.html#l00069">omlc_is_numeric_type</a>, <a class="el" href="omlc_8h_source.html#l00671">OmlMPDef::param_types</a>, <a class="el" href="omlc_8h_source.html#l00674">OmlMPDef::relations</a>, <a class="el" href="omlc_8h_source.html#l00761">OmlMStream::sample_interval</a>, <a class="el" href="omlc_8h_source.html#l00758">OmlMStream::sample_thres</a>, and <a class="el" href="oml__value_8c_source.html#l00042">type</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l01187">create_default_filters()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = def-&gt;<a class="code" href="structOmlMPDef.html#a4d058714a8007ca1a7cccc6b35aebdd1">name</a>;</div>
<div class="line">  <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012">OmlValueT</a> <a class="code" href="oml__value_8c.html#ae1087eeb503fb7b11a810d93605c97df">type</a> = def-&gt;<a class="code" href="structOmlMPDef.html#ae973305703cc2bbc5d72f110db6eba38">param_types</a>;</div>
<div class="line">  <a class="code" href="structOMLSemDef.html">OMLSemDef</a> * concepts = def-&gt;<a class="code" href="structOmlMPDef.html#a16cc14202a8d12ac8929b7889ea34d1d">relations</a>;</div>
<div class="line">  <span class="keywordtype">int</span> multiple_samples = ms-&gt;<a class="code" href="structOmlMStream.html#a6dce39ba9a9266928eef2ce42849322e">sample_thres</a> &gt; 1 || ms-&gt;<a class="code" href="structOmlMStream.html#abb765cd3168964526028974b5395bf5e">sample_interval</a> &gt; 0;</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">char</span>* fname;</div>
<div class="line">  <span class="keywordflow">if</span> (multiple_samples &amp;&amp; <a class="code" href="omlc_8h.html#a86f8c871de57e71f81d9bc85469de71c">omlc_is_numeric_type</a> (type)) {</div>
<div class="line">    fname = <span class="stringliteral">&quot;avg&quot;</span>;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    fname = <span class="stringliteral">&quot;first&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="structOmlFilter.html">OmlFilter</a>* f = <a class="code" href="factory_8c.html#a157c9b15749028d109b7bb009ceb1bbd">create_filter</a>(fname, name, type, concepts, index);</div>
<div class="line">  <span class="keywordflow">return</span> f;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="accd762f6cd773e4bfb598096410b0bf5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void create_default_filters </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOmlMP.html">OmlMP</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structOmlMStream.html">OmlMStream</a> *&#160;</td>
          <td class="paramname"><em>ms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create the default filters </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mp</td><td><a class="el" href="structOmlMP.html">OmlMP</a> to add filters to </td></tr>
    <tr><td class="paramname">ns</td><td><a class="el" href="structOmlMStream.html">OmlMStream</a> associated to mp </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l01187">1187</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="init_8c_source.html#l01224">create_default_filter()</a>, <a class="el" href="log_8c_source.html#l00333">logdebug()</a>, <a class="el" href="log_8c_source.html#l00297">logerror()</a>, <a class="el" href="omlc_8h_source.html#l00691">OmlMP::name</a>, <a class="el" href="oml__filter_8h_source.html#l00143">OmlFilter::next</a>, <a class="el" href="omlc_8h_source.html#l00696">OmlMP::param_count</a>, <a class="el" href="omlc_8h_source.html#l00694">OmlMP::param_defs</a>, and <a class="el" href="omlc_8h_source.html#l00739">OmlMStream::table_name</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l01153">oml_mp_get_default_ms()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> j;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(!mp || !ms) {</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> param_count = mp-&gt;<a class="code" href="structOmlMP.html#a15a16f8336c4ddb062432f391f40a302">param_count</a>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="log_8c.html#a1db1902215b0897e1ec8c2a8766465b2">logdebug</a>(<span class="stringliteral">&quot;Creating default filters on MP &#39;%s&#39; to MS &#39;%s&#39;\n&quot;</span>,</div>
<div class="line">      mp-&gt;<a class="code" href="structOmlMP.html#a5f99c0c042cdd120e19271c716d3eaac">name</a>, ms-&gt;<a class="code" href="structOmlMStream.html#a0613b1a0952e979da8fc278dc9b3c280">table_name</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="structOmlFilter.html">OmlFilter</a>* prev = NULL;</div>
<div class="line">  <span class="keywordflow">for</span> (j = 0; j &lt; param_count; j++) {</div>
<div class="line">    <a class="code" href="structOmlMPDef.html">OmlMPDef</a> def = mp-&gt;<a class="code" href="structOmlMP.html#a8269442d91a3e59d2e26b254eb232d3e">param_defs</a>[j];</div>
<div class="line">    <a class="code" href="structOmlFilter.html">OmlFilter</a>* f = <a class="code" href="client_8h.html#ab4756e8f48a7af991ab99e4e5894af52">create_default_filter</a>(&amp;def, ms, j);</div>
<div class="line">    <span class="keywordflow">if</span> (f) {</div>
<div class="line">      <span class="keywordflow">if</span> (prev == NULL) {</div>
<div class="line">        ms-&gt;firstFilter = f;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        prev-&gt;<a class="code" href="structOmlFilter.html#a702d8421bfd416f22633b0cc470e1f3a">next</a> = f;</div>
<div class="line">      }</div>
<div class="line">      prev = f;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Unable to create default filter for MP %s.\n&quot;</span>, mp-&gt;<a class="code" href="structOmlMP.html#a5f99c0c042cdd120e19271c716d3eaac">name</a>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aae69d5e89a47ef7b1324df2155bcfa8b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOmlMStream.html">OmlMStream</a>* create_mstream </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structOmlMP.html">OmlMP</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structOmlWriter.html">OmlWriter</a> *&#160;</td>
          <td class="paramname"><em>writer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>sample_interval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sample_thres</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a new stream of measurement samples from the inputs to a given MP.</p>
<p>If a stream by that name already exists, it is used instead.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sample_interval</td><td>the sample interval for the filter </td></tr>
    <tr><td class="paramname">sample_thres</td><td>the threshold for the filter </td></tr>
    <tr><td class="paramname">mp</td><td>the measurement point </td></tr>
    <tr><td class="paramname">writer</td><td>the destination for the stream output samples </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the new measurement stream, or NULL if an error occurred. </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l00963">963</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="client_8h_source.html#l00036">OmlClient::app_name</a>, <a class="el" href="client_8h_source.html#l00080">OmlClient::client_instr</a>, <a class="el" href="init_8c_source.html#l00938">find_mstream()</a>, <a class="el" href="log_8c_source.html#l00333">logdebug()</a>, <a class="el" href="log_8c_source.html#l00297">logerror()</a>, <a class="el" href="log_8c_source.html#l00321">loginfo()</a>, <a class="el" href="check__liboml2__api_8c_source.html#l00141">mp</a>, <a class="el" href="omlc_8h_source.html#l00742">OmlMStream::mp</a>, <a class="el" href="mstring_8c_source.html#l00222">mstring_buf()</a>, <a class="el" href="mstring_8c_source.html#l00130">mstring_cat()</a>, <a class="el" href="mstring_8c_source.html#l00073">mstring_create()</a>, <a class="el" href="mstring_8c_source.html#l00237">mstring_delete()</a>, <a class="el" href="mstring_8c_source.html#l00100">mstring_set()</a>, <a class="el" href="omlc_8h_source.html#l00711">OmlMP::mutex</a>, <a class="el" href="omlc_8h_source.html#l00709">OmlMP::mutexP</a>, <a class="el" href="omlc_8h_source.html#l00691">OmlMP::name</a>, <a class="el" href="omlc_8h_source.html#l00776">OmlMStream::next</a>, <a class="el" href="mem_8c_source.html#l00240">oml_free()</a>, <a class="el" href="mem_8c_source.html#l00157">oml_malloc()</a>, <a class="el" href="init_8c_source.html#l01052">oml_ms_add_writer()</a>, <a class="el" href="omlc_8h_source.html#l00761">OmlMStream::sample_interval</a>, <a class="el" href="omlc_8h_source.html#l00758">OmlMStream::sample_thres</a>, <a class="el" href="omlc_8h_source.html#l00702">OmlMP::streams</a>, and <a class="el" href="omlc_8h_source.html#l00739">OmlMStream::table_name</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l01153">oml_mp_get_default_ms()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span> *stream_name = NULL;</div>
<div class="line">  <span class="keywordtype">int</span> <span class="keyword">new</span> = 1;</div>
<div class="line">  <a class="code" href="structMString.html">MString</a> *namestr;</div>
<div class="line">  <a class="code" href="structOmlMStream.html">OmlMStream</a> *ms;</div>
<div class="line">  <span class="keywordflow">if</span> (!mp) {</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  namestr = <a class="code" href="mstring_8c.html#a49f0faf4fe4e38a6d7b4f0ef09d5fd24">mstring_create</a>();</div>
<div class="line">  <span class="comment">/* If name is not specified, create one by concatenating the application and</span></div>
<div class="line"><span class="comment">   * MP names.</span></div>
<div class="line"><span class="comment">   *</span></div>
<div class="line"><span class="comment">   * XXX: We probably should not do it for any MP, as an MP should be</span></div>
<div class="line"><span class="comment">   * application-agnostic. This is not the case at the moment, and we don&#39;t</span></div>
<div class="line"><span class="comment">   * want to confuse legacy post-processing scripts. See #1055.</span></div>
<div class="line"><span class="comment">   *</span></div>
<div class="line"><span class="comment">   * However, schema 0 is new, so let&#39;s do the right thing here.</span></div>
<div class="line"><span class="comment">   *</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  namestr = <a class="code" href="mstring_8c.html#a49f0faf4fe4e38a6d7b4f0ef09d5fd24">mstring_create</a>();</div>
<div class="line">  <span class="keywordflow">if</span> ((mp != <a class="code" href="api_8c.html#ab37d06b7aa57f34099a4dbcff29635b7">schema0</a>) &amp;&amp; (mp != <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a301a86e1b0438b15f455f15e56111677">client_instr</a>)) {</div>
<div class="line">    <a class="code" href="mstring_8c.html#a08be5969ab75ab7f40d4a767c8024df0">mstring_set</a> (namestr, <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a892c8aaacb821f1c3e90285ab97dce1b">app_name</a>);</div>
<div class="line">    <a class="code" href="mstring_8c.html#a7cd8889255be28437ebc23d31188ba69">mstring_cat</a> (namestr, <span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>) {</div>
<div class="line">    <a class="code" href="mstring_8c.html#a7cd8889255be28437ebc23d31188ba69">mstring_cat</a> (namestr, <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="mstring_8c.html#a7cd8889255be28437ebc23d31188ba69">mstring_cat</a> (namestr, mp-&gt;<a class="code" href="structOmlMP.html#a5f99c0c042cdd120e19271c716d3eaac">name</a>);</div>
<div class="line">  }</div>
<div class="line">  stream_name = <a class="code" href="mstring_8c.html#ab18dbe1f8aa51964e0a15813991daf73">mstring_buf</a> (namestr);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> ((ms=<a class="code" href="client_8h.html#a17d38a142ff7946ea46d63b5e761ae63">find_mstream</a> (stream_name))) {</div>
<div class="line">    <a class="code" href="log_8c.html#aea4dca1a8e24794377ba1bf45fbbfce8">loginfo</a>(<span class="stringliteral">&quot;MS &#39;%s&#39; already exists, assuming identical parameters for a new destination; use the &#39;name&#39; attribute of the &lt;stream /&gt; element to change\n&quot;</span>, stream_name);</div>
<div class="line">    <span class="keyword">new</span> = 0;</div>
<div class="line"></div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="log_8c.html#a1db1902215b0897e1ec8c2a8766465b2">logdebug</a>(<span class="stringliteral">&quot;MS &#39;%s&#39; does not exist, creating...\n&quot;</span>, stream_name);</div>
<div class="line">    ms = (<a class="code" href="structOmlMStream.html">OmlMStream</a>*)<a class="code" href="omlc_8h.html#a8616cb714d6589098267bba8fc7b48c2">oml_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structOmlMStream.html">OmlMStream</a>));</div>
<div class="line">    <span class="keywordflow">if</span>(!ms) {</div>
<div class="line">      <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Cannot allocate memory for MS %s\n&quot;</span>, <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line">      <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line">    memset(ms, 0, <span class="keyword">sizeof</span>(<a class="code" href="structOmlMStream.html">OmlMStream</a>));</div>
<div class="line"></div>
<div class="line">    ;</div>
<div class="line">    strncpy (ms-&gt;<a class="code" href="structOmlMStream.html#a0613b1a0952e979da8fc278dc9b3c280">table_name</a>, stream_name, <span class="keyword">sizeof</span>(ms-&gt;<a class="code" href="structOmlMStream.html#a0613b1a0952e979da8fc278dc9b3c280">table_name</a>));</div>
<div class="line">    ms-&gt;<a class="code" href="structOmlMStream.html#a0613b1a0952e979da8fc278dc9b3c280">table_name</a>[<span class="keyword">sizeof</span>(ms-&gt;<a class="code" href="structOmlMStream.html#a0613b1a0952e979da8fc278dc9b3c280">table_name</a>)-1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"></div>
<div class="line">    ms-&gt;<a class="code" href="structOmlMStream.html#abb765cd3168964526028974b5395bf5e">sample_interval</a> = sample_interval;</div>
<div class="line">    ms-&gt;<a class="code" href="structOmlMStream.html#a6dce39ba9a9266928eef2ce42849322e">sample_thres</a> = sample_thres;</div>
<div class="line">    ms-&gt;<a class="code" href="structOmlMStream.html#a3cc7303c0c6785623406ef871d16907d">mp</a> = <a class="code" href="check__liboml2__api_8c.html#a8f5ec90394e42efb227d03ce038b0377">mp</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (ms-&gt;<a class="code" href="structOmlMStream.html#abb765cd3168964526028974b5395bf5e">sample_interval</a> &gt; 0) {</div>
<div class="line">      <span class="keywordflow">if</span> (mp-&gt;<a class="code" href="structOmlMP.html#afc9867471701f954bc28caf255c3816b">mutexP</a> == NULL) {</div>
<div class="line">        mp-&gt;<a class="code" href="structOmlMP.html#afc9867471701f954bc28caf255c3816b">mutexP</a> = &amp;mp-&gt;<a class="code" href="structOmlMP.html#a220c5987f0145cd88c07866fb0ab950d">mutex</a>;</div>
<div class="line">        pthread_mutex_init(mp-&gt;<a class="code" href="structOmlMP.html#afc9867471701f954bc28caf255c3816b">mutexP</a>, NULL);</div>
<div class="line">      }</div>
<div class="line">      ms-&gt;<a class="code" href="structOmlMStream.html#a6dce39ba9a9266928eef2ce42849322e">sample_thres</a> = 0;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="mstring_8c.html#a22eb366ee3317407b4233d6216b690a3">mstring_delete</a> (namestr);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(!writer) {</div>
<div class="line">    <a class="code" href="log_8c.html#a1db1902215b0897e1ec8c2a8766465b2">logdebug</a>(<span class="stringliteral">&quot;NULL writer for MS %s; it might get added later (using a configuration file?)\n&quot;</span>, <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>?<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>:mp-&gt;<a class="code" href="structOmlMP.html#a5f99c0c042cdd120e19271c716d3eaac">name</a>);</div>
<div class="line"></div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="client_8h.html#a94accc8192536cbda920a4f3adf26c34">oml_ms_add_writer</a>(ms, writer))  {</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Cannot add %s&#39;s writer\n&quot;</span>, <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line">    <span class="keywordflow">if</span>(<span class="keyword">new</span>) {</div>
<div class="line">      <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(ms);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<span class="keyword">new</span>) {</div>
<div class="line">    ms-&gt;<a class="code" href="structOmlMStream.html#a3dcd5e7eeb74525f3a003b08eed87e12">next</a> = mp-&gt;<a class="code" href="structOmlMP.html#a0053c119979daf6d558c414b685e17f5">streams</a>;</div>
<div class="line">    mp-&gt;<a class="code" href="structOmlMP.html#a0053c119979daf6d558c414b685e17f5">streams</a> = ms;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> ms;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a38839581577d7fc5c4529eba39289987"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOmlWriter.html">OmlWriter</a>* create_writer </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>uri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="oml__writer_8h.html#a959172e0c35e858e1ade72178cf27173">StreamEncoding</a>&#160;</td>
          <td class="paramname"><em>encoding</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create either a file writer or a network writer </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">uri</td><td>collection URI </td></tr>
    <tr><td class="paramname">encoding</td><td>StreamEncoding to use for the output, either SE_Text or SE_Binary</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to the new <a class="el" href="structOmlWriter.html">OmlWriter</a>, or NULL on error </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l00741">741</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="bin__writer_8c_source.html#l00091">bin_writer_new()</a>, <a class="el" href="client_8h_source.html#l00031">DEF_PORT_STRING</a>, <a class="el" href="client_8h_source.html#l00038">OmlClient::domain</a>, <a class="el" href="file__stream_8c_source.html#l00059">file_stream_new()</a>, <a class="el" href="file__stream_8c_source.html#l00168">file_stream_set_buffered()</a>, <a class="el" href="client_8h_source.html#l00051">OmlClient::first_writer</a>, <a class="el" href="log_8c_source.html#l00297">logerror()</a>, <a class="el" href="net__stream_8c_source.html#l00080">net_stream_new()</a>, <a class="el" href="oml__writer_8h_source.html#l00117">OmlWriter::next</a>, <a class="el" href="client_8h_source.html#l00040">OmlClient::node_name</a>, <a class="el" href="mem_8c_source.html#l00240">oml_free()</a>, <a class="el" href="mem_8c_source.html#l00288">oml_strndup()</a>, <a class="el" href="oml__util_8h_source.html#l00042">OML_URI_FILE_FLUSH</a>, <a class="el" href="oml__util_8h_source.html#l00048">oml_uri_is_file</a>, <a class="el" href="oml__util_8c_source.html#l00202">oml_uri_type()</a>, <a class="el" href="oml__util_8c_source.html#l00231">parse_uri()</a>, <a class="el" href="oml__writer_8h_source.html#l00128">SE_Binary</a>, <a class="el" href="oml__writer_8h_source.html#l00126">SE_None</a>, <a class="el" href="oml__writer_8h_source.html#l00127">SE_Text</a>, and <a class="el" href="text__writer_8c_source.html#l00083">text_writer_new()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="oml__util_8h.html#a457629626f00794579ce6e607b0827d7">OmlURIType</a> uri_type = <a class="code" href="oml__util_8c.html#a301fddeafe0b5443ef133e7fc16af68f">oml_uri_type</a>(uri);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a> == NULL){</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;No omlc_instance:  OML client was not initialized properly.\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (uri == NULL || strlen(uri) &lt; 1) {</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a> (<span class="stringliteral">&quot;Missing or invalid collection URI definition (e.g., --oml-collect)\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a4190f5fc636fde56eae321f0f39c07ba">node_name</a> == NULL) {</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a> (<span class="stringliteral">&quot;Missing &#39;--oml-id&#39; flag \n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#adc89fb9df041d3e5c14ebf4df6f856c4">domain</a> == NULL) {</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a> (<span class="stringliteral">&quot;Missing &#39;--oml-domain&#39; flag \n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *transport = NULL;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *path = NULL;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *port = NULL;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="oml__util_8c.html#ab026ccb8032d813d97fe53004d39e12d">parse_uri</a> (uri, &amp;transport, &amp;path, &amp;port) == -1) {</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a> (<span class="stringliteral">&quot;Error parsing server destination URI &#39;%s&#39;; failed to create stream for this destination\n&quot;</span>,</div>
<div class="line">              uri);</div>
<div class="line">    <span class="keywordflow">if</span> (transport) <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a> ((<span class="keywordtype">void</span>*)transport);</div>
<div class="line">    <span class="keywordflow">if</span> (path) <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a> ((<span class="keywordtype">void</span>*)path);</div>
<div class="line">    <span class="keywordflow">if</span> (port) <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a> ((<span class="keywordtype">void</span>*)port);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *filepath = NULL;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *hostname = NULL;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="oml__util_8h.html#a1fd898bbff0329c28ba4c6825610e6a1">oml_uri_is_file</a>(uri_type)) {</div>
<div class="line">    <span class="comment">/* &#39;file://path/to/file&#39; is equivalent to unix path &#39;/path/to/file&#39; */</span></div>
<div class="line">    <span class="keywordflow">if</span> (strncmp (path, <span class="stringliteral">&quot;//&quot;</span>, 2) == 0)</div>
<div class="line">      filepath = &amp;path[1];</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      filepath = path;</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (transport) {</div>
<div class="line">    <span class="keywordflow">if</span> (strncmp (path, <span class="stringliteral">&quot;//&quot;</span>, 2) == 0)</div>
<div class="line">      hostname = &amp;path[2];</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      hostname = path;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    hostname = path; <span class="comment">/* If no transport specified, it must be tcp */</span></div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Default transport is tcp if not specified */</span></div>
<div class="line">  <span class="keywordflow">if</span> (!transport) {</div>
<div class="line">    transport = <a class="code" href="mem_8c.html#adca1f9f48333b1fa9af21312a3f4534c">oml_strndup</a> (<span class="stringliteral">&quot;tcp&quot;</span>, strlen (<span class="stringliteral">&quot;tcp&quot;</span>));</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* If not file transport, use the OML default port if unspecified */</span></div>
<div class="line">  <span class="keywordflow">if</span> (!port &amp;&amp; !<a class="code" href="oml__util_8h.html#a1fd898bbff0329c28ba4c6825610e6a1">oml_uri_is_file</a>(uri_type)) {</div>
<div class="line">    port = <a class="code" href="mem_8c.html#adca1f9f48333b1fa9af21312a3f4534c">oml_strndup</a> (<a class="code" href="client_8h.html#a4add3cf418c470c13d6aeb69187a1740">DEF_PORT_STRING</a>, strlen (<a class="code" href="client_8h.html#a4add3cf418c470c13d6aeb69187a1740">DEF_PORT_STRING</a>));</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="structOmlOutStream.html">OmlOutStream</a>* out_stream;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="oml__util_8h.html#a1fd898bbff0329c28ba4c6825610e6a1">oml_uri_is_file</a>(uri_type)) {</div>
<div class="line">    out_stream = <a class="code" href="client_8h.html#ac7dd4a100ddaba640ad0f3f19af7ae06">file_stream_new</a>(filepath);</div>
<div class="line">    <span class="keywordflow">if</span> (encoding == <a class="code" href="oml__writer_8h.html#a959172e0c35e858e1ade72178cf27173aedbfd5c057213d683dab8b73f2c0d8a1">SE_None</a>) encoding = <a class="code" href="oml__writer_8h.html#a959172e0c35e858e1ade72178cf27173a69ceab39b4642dd473e40f96f3abcddc">SE_Text</a>; <span class="comment">/* default encoding */</span></div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="oml__util_8h.html#a457629626f00794579ce6e607b0827d7acc2544b5a845cf76b4cebd89282dbd76">OML_URI_FILE_FLUSH</a> == uri_type) {</div>
<div class="line">      <a class="code" href="client_8h.html#a7e29655c822b05e3ebe7daf7308024e9">file_stream_set_buffered</a>(out_stream, 0);</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    out_stream = <a class="code" href="client_8h.html#af08fdd1497353e7fe6820aa5e1f765e9">net_stream_new</a>(transport, hostname, port);</div>
<div class="line">    <span class="keywordflow">if</span> (encoding == <a class="code" href="oml__writer_8h.html#a959172e0c35e858e1ade72178cf27173aedbfd5c057213d683dab8b73f2c0d8a1">SE_None</a>) encoding = <a class="code" href="oml__writer_8h.html#a959172e0c35e858e1ade72178cf27173a4fe1ba3f0e240b2e7ea8e0513e5c0212">SE_Binary</a>; <span class="comment">/* default encoding */</span></div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (out_stream == NULL) {</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a> (<span class="stringliteral">&quot;Failed to create stream for URI %s\n&quot;</span>, uri);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a> ((<span class="keywordtype">void</span>*)transport);</div>
<div class="line">  <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a> ((<span class="keywordtype">void</span>*)path);</div>
<div class="line">  <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a> ((<span class="keywordtype">void</span>*)port);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Now create a write on top of the stream</span></div>
<div class="line">  <a class="code" href="structOmlWriter.html">OmlWriter</a>* writer = NULL;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">switch</span> (encoding) {</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="oml__writer_8h.html#a959172e0c35e858e1ade72178cf27173a69ceab39b4642dd473e40f96f3abcddc">SE_Text</a>:   writer = <a class="code" href="client_8h.html#a1654081a08d8239be5a9bcff2f2cc69d">text_writer_new</a> (out_stream); <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="oml__writer_8h.html#a959172e0c35e858e1ade72178cf27173a4fe1ba3f0e240b2e7ea8e0513e5c0212">SE_Binary</a>: writer = <a class="code" href="bin__writer_8c.html#a5b581177f0c4b16e69c2ce68f60d7cff">bin_writer_new</a> (out_stream); <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="oml__writer_8h.html#a959172e0c35e858e1ade72178cf27173aedbfd5c057213d683dab8b73f2c0d8a1">SE_None</a>:</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a> (<span class="stringliteral">&quot;No encoding specified (this should never happen -- please report this as an OML bug)\n&quot;</span>);</div>
<div class="line">    <span class="comment">// should cleanup streams</span></div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (writer == NULL) {</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a> (<span class="stringliteral">&quot;Failed to create writer for encoding &#39;%s&#39;.\n&quot;</span>, encoding == <a class="code" href="oml__writer_8h.html#a959172e0c35e858e1ade72178cf27173a4fe1ba3f0e240b2e7ea8e0513e5c0212">SE_Binary</a> ? <span class="stringliteral">&quot;binary&quot;</span> : <span class="stringliteral">&quot;text&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line">  writer-&gt;<a class="code" href="structOmlWriter.html#a301b6f73c465f0c0cd22d7a2ad7052f5">next</a> = <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#acc59517d7d5b3a215937bdcc4e361424">first_writer</a>;</div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#acc59517d7d5b3a215937bdcc4e361424">first_writer</a> = writer;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> writer;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac821f21a0da9c8aae8be1cac73331166"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOmlMP.html">OmlMP</a>* destroy_mp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOmlMP.html">OmlMP</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Destroy MP</p>
<p>This function is designed so it can be used in a while loop to clean up the entire linked list:</p>
<p>while( (mp=destroy_mp(mp)) );</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mp</td><td>pointer to the <a class="el" href="structOmlMP.html">OmlMP</a> to free </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>mp-&gt;next (can be NULL) </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l00493">493</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="omlc_8h_source.html#l00706">OmlMP::active</a>, <a class="el" href="init_8c_source.html#l01088">destroy_ms()</a>, <a class="el" href="init_8c_source.html#l00321">destroy_sem_concepts()</a>, <a class="el" href="log_8c_source.html#l00333">logdebug()</a>, <a class="el" href="misc_8c_source.html#l00030">mp_lock()</a>, <a class="el" href="misc_8c_source.html#l00040">mp_unlock()</a>, <a class="el" href="omlc_8h_source.html#l00691">OmlMP::name</a>, <a class="el" href="omlc_8h_source.html#l00714">OmlMP::next</a>, <a class="el" href="omlc_8h_source.html#l00694">OmlMP::param_defs</a>, <a class="el" href="omlc_8h_source.html#l00674">OmlMPDef::relations</a>, and <a class="el" href="omlc_8h_source.html#l00702">OmlMP::streams</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00637">omlc_close()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structOmlMP.html">OmlMP</a> *next;</div>
<div class="line">  <a class="code" href="structOmlMStream.html">OmlMStream</a> *ms;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(!mp) {</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="log_8c.html#a1db1902215b0897e1ec8c2a8766465b2">logdebug</a>(<span class="stringliteral">&quot;Destroying MP %s at %p\n&quot;</span>, mp-&gt;<a class="code" href="structOmlMP.html#a5f99c0c042cdd120e19271c716d3eaac">name</a>, mp);</div>
<div class="line"></div>
<div class="line">  next = mp-&gt;<a class="code" href="structOmlMP.html#afc2a31e64cd23aeb0878b87acb8ef577">next</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (!<a class="code" href="client_8h.html#aa1f46a06d6e6693cba8548a3cc4048e8">mp_lock</a>(mp)) {</div>
<div class="line">    mp-&gt;<a class="code" href="structOmlMP.html#a953097bd43715d18d3cc10b47d14d03c">active</a> = 0;</div>
<div class="line">    ms = mp-&gt;<a class="code" href="structOmlMP.html#a0053c119979daf6d558c414b685e17f5">streams</a>;</div>
<div class="line">    <span class="keywordflow">while</span> (<a class="code" href="init_8c.html#a50aae756ce043a9b74775a48c13aba0c">destroy_sem_concepts</a>(mp-&gt;<a class="code" href="structOmlMP.html#a8269442d91a3e59d2e26b254eb232d3e">param_defs</a>-&gt;<a class="code" href="structOmlMPDef.html#a16cc14202a8d12ac8929b7889ea34d1d">relations</a>));</div>
<div class="line">    <span class="keywordflow">while</span>( (ms=<a class="code" href="client_8h.html#a96b21fffa7aa1578b2a2a163422cfffe">destroy_ms</a>(ms)) );</div>
<div class="line">    <a class="code" href="client_8h.html#ae9551b52d060a0d9cf2aa2c01f5f5d12">mp_unlock</a>(mp);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> next;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a96b21fffa7aa1578b2a2a163422cfffe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOmlMStream.html">OmlMStream</a>* destroy_ms </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOmlMStream.html">OmlMStream</a> *&#160;</td>
          <td class="paramname"><em>ms</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Destroy a Measurement Stream, and deep free allocated memory (filters.</p>
<p>This function is designed so it can be used in a while loop to clean up the entire linked list:</p>
<p>while( (ms=destroy_ms(ms)) );</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ms</td><td>pointer to the <a class="el" href="structOmlMStream.html">OmlMStream</a> to free </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ms-&gt;next (can be NULL) </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l01088">1088</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="factory_8c_source.html#l00139">destroy_filter()</a>, <a class="el" href="filter_8c_source.html#l00103">filter_process()</a>, <a class="el" href="omlc_8h_source.html#l00749">OmlMStream::filters</a>, <a class="el" href="log_8c_source.html#l00333">logdebug()</a>, <a class="el" href="log_8c_source.html#l00321">loginfo()</a>, <a class="el" href="omlc_8h_source.html#l00776">OmlMStream::next</a>, <a class="el" href="mem_8c_source.html#l00240">oml_free()</a>, <a class="el" href="omlc_8h_source.html#l00756">OmlMStream::sample_size</a>, <a class="el" href="omlc_8h_source.html#l00739">OmlMStream::table_name</a>, and <a class="el" href="omlc_8h_source.html#l00782">OmlMStream::writers</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00493">destroy_mp()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structOmlMStream.html">OmlMStream</a> *next;</div>
<div class="line">  <a class="code" href="structOmlFilter.html">OmlFilter</a> *ft;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(!ms) {</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="log_8c.html#a1db1902215b0897e1ec8c2a8766465b2">logdebug</a>(<span class="stringliteral">&quot;Destroying MS %s at %p\n&quot;</span>, ms-&gt;<a class="code" href="structOmlMStream.html#a0613b1a0952e979da8fc278dc9b3c280">table_name</a>, ms);</div>
<div class="line"></div>
<div class="line">  next = ms-&gt;<a class="code" href="structOmlMStream.html#a3dcd5e7eeb74525f3a003b08eed87e12">next</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (ms-&gt;<a class="code" href="structOmlMStream.html#ada9e11ba6d89e2cca0787a65fb2b2c9d">sample_size</a> &gt; 0) {</div>
<div class="line">    <a class="code" href="log_8c.html#aea4dca1a8e24794377ba1bf45fbbfce8">loginfo</a>(<span class="stringliteral">&quot;Reporting last (partial) sample for MS %s\n&quot;</span>, ms-&gt;<a class="code" href="structOmlMStream.html#a0613b1a0952e979da8fc278dc9b3c280">table_name</a>);</div>
<div class="line">    <a class="code" href="client_8h.html#a2bb910d0f3c68f70719113b1920e6931">filter_process</a>(ms);</div>
<div class="line">  }</div>
<div class="line">  ft = ms-&gt;<a class="code" href="structOmlMStream.html#a5b929155b553fd221a655734c82d10ac">filters</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( (ft = <a class="code" href="factory_8c.html#a303f4a129a49ffbb81955717333f7d20">destroy_filter</a>(ft)) );</div>
<div class="line"></div>
<div class="line">  <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(ms-&gt;<a class="code" href="structOmlMStream.html#ad436c40e7e14ae11cde0361871a7eabd">writers</a>);</div>
<div class="line">  <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(ms);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> next;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a50aae756ce043a9b74775a48c13aba0c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOMLSemDef.html">OMLSemDef</a>* destroy_sem_concepts </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOMLSemDef.html">OMLSemDef</a> *&#160;</td>
          <td class="paramname"><em>sd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="init_8c_source.html#l00321">321</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="omlc_8h_source.html#l00658">OMLSemDef::next</a>, <a class="el" href="omlc_8h_source.html#l00657">OMLSemDef::object</a>, <a class="el" href="mem_8c_source.html#l00240">oml_free()</a>, <a class="el" href="omlc_8h_source.html#l00656">OMLSemDef::predicate</a>, and <a class="el" href="omlc_8h_source.html#l00655">OMLSemDef::subject</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00493">destroy_mp()</a>, and <a class="el" href="init_8c_source.html#l00365">omlc_add_mp()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="structOMLSemDef.html">OMLSemDef</a> *sd_aux = NULL;</div>
<div class="line">    <span class="keywordflow">if</span> (sd)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (sd-&gt;<a class="code" href="structOMLSemDef.html#a5b4b9c65a6c9ae4f9facbc832aa53a10">subject</a>) <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(sd-&gt;<a class="code" href="structOMLSemDef.html#a5b4b9c65a6c9ae4f9facbc832aa53a10">subject</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (sd-&gt;<a class="code" href="structOMLSemDef.html#a0e5ca9671fb68675077844165aa7c0ae">predicate</a>) <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(sd-&gt;<a class="code" href="structOMLSemDef.html#a0e5ca9671fb68675077844165aa7c0ae">predicate</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (sd-&gt;<a class="code" href="structOMLSemDef.html#a0f76c5edb5426c4c0ef00bd69119c8e9">object</a>) <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(sd-&gt;<a class="code" href="structOMLSemDef.html#a0f76c5edb5426c4c0ef00bd69119c8e9">object</a>);</div>
<div class="line">        sd_aux = sd-&gt;<a class="code" href="structOMLSemDef.html#a65d62c3cf5934ef72b41e760e42155de">next</a>;</div>
<div class="line">        <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(sd);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> sd_aux;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2b7b282aa3dee35bbc5656e9ce5204c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOmlMP.html">OmlMP</a>* find_mp </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find a named measurement point.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>The name of the measurement point to search for. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the measurement point, or NULL if not found. </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l00850">850</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="check__liboml2__api_8c_source.html#l00141">mp</a>, <a class="el" href="client_8h_source.html#l00043">OmlClient::mpoints</a>, <a class="el" href="omlc_8h_source.html#l00691">OmlMP::name</a>, and <a class="el" href="omlc_8h_source.html#l00714">OmlMP::next</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structOmlMP.html">OmlMP</a> *<a class="code" href="structmp.html">mp</a> = <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a4050599cbe022fe59c5308d7bc8b33fb">mpoints</a>;</div>
<div class="line">  <span class="keywordflow">while</span> (mp &amp;&amp; strcmp (<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, mp-&gt;<a class="code" href="structOmlMP.html#a5f99c0c042cdd120e19271c716d3eaac">name</a>))</div>
<div class="line">    mp = mp-&gt;<a class="code" href="structOmlMP.html#afc2a31e64cd23aeb0878b87acb8ef577">next</a>;</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="check__liboml2__api_8c.html#a8f5ec90394e42efb227d03ce038b0377">mp</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adb0da318e59f1e48cbef3255e272ebdf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int find_mp_field </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structOmlMP.html">OmlMP</a> *&#160;</td>
          <td class="paramname"><em>mp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>a named field of an MP. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>name of the field to look up </td></tr>
    <tr><td class="paramname">mp</td><td><a class="el" href="structOmlMP.html">OmlMP</a> to look for the field</td></tr>
  </table>
  </dd>
</dl>
<p>If either parameter is NULL, act as if the field wasn't found.</p>
<dl class="section return"><dt>Returns</dt><dd>a valid index into the <a class="el" href="structOmlMP.html">OmlMP</a>'s param_defs array, or -1 if not found </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l00867">867</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="log_8c_source.html#l00333">logdebug()</a>, <a class="el" href="omlc_8h_source.html#l00668">OmlMPDef::name</a>, <a class="el" href="omlc_8h_source.html#l00691">OmlMP::name</a>, <a class="el" href="omlc_8h_source.html#l00696">OmlMP::param_count</a>, and <a class="el" href="omlc_8h_source.html#l00694">OmlMP::param_defs</a>.</p>

<p>Referenced by <a class="el" href="api_8c_source.html#l00218">omlc_inject_metadata()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> i;</div>
<div class="line">  <span class="keywordflow">if</span> (NULL == <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> || NULL == mp) { <span class="keywordflow">return</span> -1; }</div>
<div class="line">  <span class="keywordtype">size_t</span> len = mp-&gt;<a class="code" href="structOmlMP.html#a15a16f8336c4ddb062432f391f40a302">param_count</a>;</div>
<div class="line">  <a class="code" href="structOmlMPDef.html">OmlMPDef</a> *fields = mp-&gt;<a class="code" href="structOmlMP.html#a8269442d91a3e59d2e26b254eb232d3e">param_defs</a>;</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; len; i++) {</div>
<div class="line">    <a class="code" href="log_8c.html#a1db1902215b0897e1ec8c2a8766465b2">logdebug</a>(<span class="stringliteral">&quot;Searching MP %s for field &#39;%s&#39;, found &#39;%s&#39;\n&quot;</span>,</div>
<div class="line">        mp-&gt;<a class="code" href="structOmlMP.html#a5f99c0c042cdd120e19271c716d3eaac">name</a>, <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, fields[i].<a class="code" href="structOmlMPDef.html#a4d058714a8007ca1a7cccc6b35aebdd1">name</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp (<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, fields[i].<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>) == 0) {</div>
<div class="line">      <span class="keywordflow">return</span> i;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a17d38a142ff7946ea46d63b5e761ae63"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOmlMStream.html">OmlMStream</a>* find_mstream </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find a measurement stream by name. All measurement streams must be named uniquely.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>the name of the measurement stream to search for. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to the measurement stream or NULL if not found. </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l00938">938</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="init_8c_source.html#l00915">find_mstream_in_mp()</a>, <a class="el" href="client_8h_source.html#l00043">OmlClient::mpoints</a>, and <a class="el" href="omlc_8h_source.html#l00714">OmlMP::next</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00963">create_mstream()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structOmlMP.html">OmlMP</a> *<a class="code" href="structmp.html">mp</a> = <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a4050599cbe022fe59c5308d7bc8b33fb">mpoints</a>;</div>
<div class="line">  <a class="code" href="structOmlMStream.html">OmlMStream</a> *ms = NULL;</div>
<div class="line">  <span class="keywordflow">while</span> (mp) {</div>
<div class="line">    ms = <a class="code" href="client_8h.html#aceaf7c6f990869cc30bb729f2addf5e7">find_mstream_in_mp</a> (<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, mp);</div>
<div class="line">    <span class="keywordflow">if</span> (ms)</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    mp = mp-&gt;<a class="code" href="structOmlMP.html#afc2a31e64cd23aeb0878b87acb8ef577">next</a>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> ms;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aceaf7c6f990869cc30bb729f2addf5e7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOmlMStream.html">OmlMStream</a>* find_mstream_in_mp </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structOmlMP.html">OmlMP</a> *&#160;</td>
          <td class="paramname"><em>mp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find a named MStream among the streams attached to an MP.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>name of the stream to search for </td></tr>
    <tr><td class="paramname">mp</td><td>MP in which to search for the stream </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to the <a class="el" href="structOmlMStream.html">OmlMStream</a> if found, or NULL if not (or name is NULL) </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l00915">915</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="omlc_8h_source.html#l00776">OmlMStream::next</a>, <a class="el" href="omlc_8h_source.html#l00702">OmlMP::streams</a>, and <a class="el" href="omlc_8h_source.html#l00739">OmlMStream::table_name</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00938">find_mstream()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="structOmlMStream.html">OmlMStream</a> *ms = mp-&gt;<a class="code" href="structOmlMP.html#a0053c119979daf6d558c414b685e17f5">streams</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (!<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span> (ms) {</div>
<div class="line">    <span class="keywordflow">if</span> (ms &amp;&amp; ms-&gt;<a class="code" href="structOmlMStream.html#a0613b1a0952e979da8fc278dc9b3c280">table_name</a> &amp;&amp; strcmp (<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, ms-&gt;<a class="code" href="structOmlMStream.html#a0613b1a0952e979da8fc278dc9b3c280">table_name</a>) == 0)</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    ms = ms-&gt;<a class="code" href="structOmlMStream.html#a3dcd5e7eeb74525f3a003b08eed87e12">next</a>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> ms;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9702786aa9c44bc70b9525025de8740a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structMString.html">MString</a>* mp_fields_summary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOmlMP.html">OmlMP</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create an <a class="el" href="structMString.html">MString</a> containing a comma-separated list of the fields of the MP.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mp</td><td><a class="el" href="structOmlMP.html">OmlMP</a> to summarize </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the fields summary for mp. The caller is repsonsible for calling <a class="el" href="mstring_8c.html#a22eb366ee3317407b4233d6216b690a3">mstring_delete()</a> to deallocate the returned <a class="el" href="structMString.html">MString</a>. </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l00889">889</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="mstring_8c_source.html#l00130">mstring_cat()</a>, <a class="el" href="mstring_8c_source.html#l00073">mstring_create()</a>, <a class="el" href="mstring_8c_source.html#l00100">mstring_set()</a>, <a class="el" href="init_8c_source.html#l01493">name</a>, <a class="el" href="omlc_8h_source.html#l00696">OmlMP::param_count</a>, and <a class="el" href="omlc_8h_source.html#l00694">OmlMP::param_defs</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> i;</div>
<div class="line">  <a class="code" href="structOmlMPDef.html">OmlMPDef</a> *fields = mp-&gt;<a class="code" href="structOmlMP.html#a8269442d91a3e59d2e26b254eb232d3e">param_defs</a>;</div>
<div class="line">  <a class="code" href="structMString.html">MString</a> *s = <a class="code" href="mstring_8c.html#a49f0faf4fe4e38a6d7b4f0ef09d5fd24">mstring_create</a>();</div>
<div class="line">  <a class="code" href="mstring_8c.html#a08be5969ab75ab7f40d4a767c8024df0">mstring_set</a> (s, <span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (!s) <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; mp-&gt;<a class="code" href="structOmlMP.html#a15a16f8336c4ddb062432f391f40a302">param_count</a>; i++) {</div>
<div class="line">    <a class="code" href="mstring_8c.html#a7cd8889255be28437ebc23d31188ba69">mstring_cat</a> (s, fields[i].<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (i &lt; mp-&gt;param_count - 1)</div>
<div class="line">      <a class="code" href="mstring_8c.html#a7cd8889255be28437ebc23d31188ba69">mstring_cat</a> (s, <span class="stringliteral">&quot;&#39;, &#39;&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="mstring_8c.html#a7cd8889255be28437ebc23d31188ba69">mstring_cat</a> (s, <span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> s;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5c8c53afa6d604173e0abd9b2a824089"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOmlMStream.html">OmlMStream</a>* oml_mp_get_default_ms </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOmlMP.html">OmlMP</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get or create a default MS for the given MP, reporting all fields, using the OML instance's default samples and intervals and writing to its default writer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mp</td><td><a class="el" href="structOmlMP.html">OmlMP</a> for which to set the filter configuration </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the OmlMstream if successful, NULL otherwise </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l01153">1153</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="init_8c_source.html#l01187">create_default_filters()</a>, <a class="el" href="init_8c_source.html#l00963">create_mstream()</a>, <a class="el" href="omlc_8h_source.html#l00718">OmlMP::default_ms</a>, <a class="el" href="client_8h_source.html#l00077">OmlClient::default_writer</a>, <a class="el" href="filter_8c_source.html#l00050">filter_engine_start()</a>, <a class="el" href="log_8c_source.html#l00333">logdebug()</a>, <a class="el" href="log_8c_source.html#l00297">logerror()</a>, <a class="el" href="omlc_8h_source.html#l00691">OmlMP::name</a>, <a class="el" href="client_8h_source.html#l00063">OmlClient::sample_count</a>, <a class="el" href="client_8h_source.html#l00065">OmlClient::sample_interval</a>, and <a class="el" href="omlc_8h_source.html#l00702">OmlMP::streams</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00365">omlc_add_mp()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(NULL == <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a> || NULL == mp) {</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="log_8c.html#a1db1902215b0897e1ec8c2a8766465b2">logdebug</a>(<span class="stringliteral">&quot;Getting default MS for MP %s\n&quot;</span>, mp-&gt;<a class="code" href="structOmlMP.html#a5f99c0c042cdd120e19271c716d3eaac">name</a>);</div>
<div class="line">  <span class="keywordflow">if</span> (!mp-&gt;<a class="code" href="structOmlMP.html#a79c085c2ffa4931e2c09d7a9e8ada705">default_ms</a>) {</div>
<div class="line">    <span class="keywordflow">if</span>(!mp-&gt;<a class="code" href="structOmlMP.html#a0053c119979daf6d558c414b685e17f5">streams</a>) {</div>
<div class="line">      <a class="code" href="client_8h.html#aae69d5e89a47ef7b1324df2155bcfa8b">create_mstream</a> (NULL, mp,</div>
<div class="line">          <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a4abe3253caeb7b241410b8e25844b58a">default_writer</a>,</div>
<div class="line">          <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a653012b8d0c03c8fbdc72f61a6cfe25b">sample_interval</a>,</div>
<div class="line">          <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a6a1e7783b73a5c3c927faac1952b9df0">sample_count</a> );</div>
<div class="line">      <span class="keywordflow">if</span> (NULL == mp-&gt;<a class="code" href="structOmlMP.html#a0053c119979daf6d558c414b685e17f5">streams</a>) {</div>
<div class="line">        <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Error creating MS %s\n&quot;</span>, mp-&gt;<a class="code" href="structOmlMP.html#a5f99c0c042cdd120e19271c716d3eaac">name</a>);</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      <a class="code" href="client_8h.html#accd762f6cd773e4bfb598096410b0bf5">create_default_filters</a>(mp, mp-&gt;<a class="code" href="structOmlMP.html#a0053c119979daf6d558c414b685e17f5">streams</a>);</div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a653012b8d0c03c8fbdc72f61a6cfe25b">sample_interval</a> &gt; 0) {</div>
<div class="line">        <a class="code" href="client_8h.html#a1740a7e71f0ae4e436464805e071c37e">filter_engine_start</a>(mp-&gt;<a class="code" href="structOmlMP.html#a0053c119979daf6d558c414b685e17f5">streams</a>);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    mp-&gt;<a class="code" href="structOmlMP.html#a79c085c2ffa4931e2c09d7a9e8ada705">default_ms</a> = mp-&gt;<a class="code" href="structOmlMP.html#a0053c119979daf6d558c414b685e17f5">streams</a>;</div>
<div class="line"></div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> mp-&gt;<a class="code" href="structOmlMP.html#a79c085c2ffa4931e2c09d7a9e8ada705">default_ms</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a94accc8192536cbda920a4f3adf26c34"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int oml_ms_add_writer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOmlMStream.html">OmlMStream</a> *&#160;</td>
          <td class="paramname"><em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structOmlWriter.html">OmlWriter</a> *&#160;</td>
          <td class="paramname"><em>w</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add a new writer to an existing MS </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ms</td><td>MStream to add w to </td></tr>
    <tr><td class="paramname">w</td><td>writer to add to MS</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on error (previous writers are preserved) </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l01052">1052</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="log_8c_source.html#l00297">logerror()</a>, <a class="el" href="omlc_8h_source.html#l00784">OmlMStream::nwriters</a>, <a class="el" href="mem_8c_source.html#l00206">oml_realloc()</a>, <a class="el" href="omlc_8h_source.html#l00739">OmlMStream::table_name</a>, and <a class="el" href="omlc_8h_source.html#l00782">OmlMStream::writers</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00963">create_mstream()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> n;</div>
<div class="line">  <a class="code" href="structOmlWriter.html">OmlWriter</a> **writers;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(!ms || !w) {</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;%s: ms (%p) or w (%p) are invalid&quot;</span>, __FUNCTION__, ms, w);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  n = ms-&gt;<a class="code" href="structOmlMStream.html#a98172393f791aba57e2431a97f332ba2">nwriters</a> + 1;</div>
<div class="line"></div>
<div class="line">  writers = (<a class="code" href="structOmlWriter.html">OmlWriter</a> **)<a class="code" href="mem_8c.html#ae75af3096ebd921116baca5ed9208488">oml_realloc</a>(ms-&gt;<a class="code" href="structOmlMStream.html#ad436c40e7e14ae11cde0361871a7eabd">writers</a>, n*<span class="keyword">sizeof</span>(<a class="code" href="structOmlWriter.html">OmlWriter</a>*));</div>
<div class="line">  <span class="keywordflow">if</span> (!writers) {</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Cannot (re)allocate memory for %s&#39;s writers array\n&quot;</span>, ms-&gt;<a class="code" href="structOmlMStream.html#a0613b1a0952e979da8fc278dc9b3c280">table_name</a>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  writers[n-1] = w;</div>
<div class="line">  ms-&gt;<a class="code" href="structOmlMStream.html#ad436c40e7e14ae11cde0361871a7eabd">writers</a> = writers;</div>
<div class="line">  ms-&gt;<a class="code" href="structOmlMStream.html#a98172393f791aba57e2431a97f332ba2">nwriters</a> = n;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5c58a22585f34e6edca9eb67b897cc4e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOMLSemDef.html">OMLSemDef</a>* oml_sem_register_concepts </td>
          <td>(</td>
          <td class="paramtype">char ***&#160;</td>
          <td class="paramname"><em>concepts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Asign all concepts to the measurement Point</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">concepts</td><td>matrix of concepts </td></tr>
    <tr><td class="paramname">n</td><td>number of triples </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OMLSemDef* (can be NULL) </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Mario Poyato Pino <a href="#" onclick="location.href='mai'+'lto:'+'mar'+'io'+'.po'+'ya'+'to@'+'ua'+'m.e'+'s'; return false;">mario<span style="display: none;">.nosp@m.</span>.poy<span style="display: none;">.nosp@m.</span>ato@u<span style="display: none;">.nosp@m.</span>am.e<span style="display: none;">.nosp@m.</span>s</a> </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l00461">461</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="mem_8c_source.html#l00157">oml_malloc()</a>, and <a class="el" href="mem_8h_source.html#l00033">xstrdup</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> i=0;</div>
<div class="line">  <a class="code" href="structOMLSemDef.html">OMLSemDef</a> *sd=NULL,*sd_last,*sd_aux;</div>
<div class="line">  <span class="keywordflow">if</span> (n&gt;0) {</div>
<div class="line">    sd = sd_last = sd_aux = (<a class="code" href="structOMLSemDef.html">OMLSemDef</a>*)<a class="code" href="omlc_8h.html#a8616cb714d6589098267bba8fc7b48c2">oml_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structOMLSemDef.html">OMLSemDef</a>));</div>
<div class="line">    <span class="keywordflow">while</span> (i&lt;n) {</div>
<div class="line">      sd_aux-&gt;subject   = <a class="code" href="mem_8h.html#a44764fb9ba91e62b8ba5b3f4016bcb28">xstrdup</a>(concepts[i][0]);</div>
<div class="line">      sd_aux-&gt;predicate      = <a class="code" href="mem_8h.html#a44764fb9ba91e62b8ba5b3f4016bcb28">xstrdup</a>(concepts[i][1]);</div>
<div class="line">      sd_aux-&gt;object = <a class="code" href="mem_8h.html#a44764fb9ba91e62b8ba5b3f4016bcb28">xstrdup</a>(concepts[i][2]);</div>
<div class="line">      sd_aux-&gt;next      = NULL;</div>
<div class="line">      <span class="keywordflow">if</span> (++i&lt;n) {</div>
<div class="line">        sd_aux = (<a class="code" href="structOMLSemDef.html">OMLSemDef</a>*)<a class="code" href="omlc_8h.html#a8616cb714d6589098267bba8fc7b48c2">oml_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structOMLSemDef.html">OMLSemDef</a>));</div>
<div class="line">        sd_last-&gt;next = sd_aux;</div>
<div class="line">        sd_last=sd_aux;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> sd;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a13e1026b136bfacfbb3764d454241db0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOmlMP.html">OmlMP</a>* omlc_add_mp </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>mp_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structOmlMPDef.html">OmlMPDef</a> *&#160;</td>
          <td class="paramname"><em>mp_def</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register a measurement point.</p>
<p>This function should be called after <a class="el" href="init_8c.html#a7d59c725c0197f45301bf777dec8a49d">omlc_init()</a> and before <a class="el" href="init_8c.html#a2e2497cb5b09c1c6d9b634d2d60db587">omlc_start()</a>. It can be called multiple times, once for each measurement point that the application needs to define.</p>
<p>The returned <a class="el" href="structOmlMP.html">OmlMP</a> must be the first argument in every <a class="el" href="api_8c.html#ac714a82b22dfcc34a6b6130e047f2ab7">omlc_inject()</a> call for this specific measurement point.</p>
<p>XXX: The supplied name is not checked for existence.</p>
<p>The MP's input structure is defined by the mp_def parameter, it should be initialised as this example shows. </p>
<div class="fragment"><div class="line"><a class="code" href="structOmlMPDef.html">OmlMPDef</a> <a class="code" href="check__liboml2__config_8c.html#a390ebaee0bf455c72a8df44f5dd345e7">mp_def</a>[] =</div>
<div class="line">{</div>
<div class="line">  { <span class="stringliteral">&quot;source&quot;</span>, <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012aad8721fa7d76e62c5885222061fa7827">OML_UINT32_VALUE</a>, NULL},</div>
<div class="line">  { <span class="stringliteral">&quot;destination&quot;</span>, <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012aad8721fa7d76e62c5885222061fa7827">OML_UINT32_VALUE</a>, NULL},</div>
<div class="line">  { <span class="stringliteral">&quot;length&quot;</span>, <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012aad8721fa7d76e62c5885222061fa7827">OML_UINT32_VALUE</a>, NULL},</div>
<div class="line">  { <span class="stringliteral">&quot;weight&quot;</span>, <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012adf6df4b257026d03f661cfb85dc7d1c3">OML_DOUBLE_VALUE</a>, NULL},</div>
<div class="line">  { <span class="stringliteral">&quot;protocol&quot;</span>, <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012a42b33eb7c21f79727a894a530a05b559">OML_STRING_VALUE</a>, NULL},</div>
<div class="line">  { NULL, (<a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012">OmlValueT</a>)0, NULL }</div>
<div class="line">};</div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mp_name</td><td>The name of this MP. The name must not contain whitespace </td></tr>
    <tr><td class="paramname">mp_def</td><td>Definition of this MP's input tuple, as an array of <a class="el" href="structOmlMPDef.html">OmlMPDef</a> objects </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a new measurement point </dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="omlc_8h.html#aa686fff2f026c0aab59c9e62e2a3e892">omlc_init</a>, <a class="el" href="omlc_8h.html#a954c3f97690fa905e2559845248278ab">omlc_start</a> </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l00365">365</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="omlc_8h_source.html#l00706">OmlMP::active</a>, <a class="el" href="client_8h_source.html#l00036">OmlClient::app_name</a>, <a class="el" href="init_8c_source.html#l00321">destroy_sem_concepts()</a>, <a class="el" href="omlc_8h_source.html#l00753">OmlMStream::index</a>, <a class="el" href="client_8h_source.html#l00045">OmlClient::last_mpoint</a>, <a class="el" href="log_8c_source.html#l00333">logdebug()</a>, <a class="el" href="log_8c_source.html#l00297">logerror()</a>, <a class="el" href="log_8c_source.html#l00309">logwarn()</a>, <a class="el" href="check__liboml2__api_8c_source.html#l00141">mp</a>, <a class="el" href="check__liboml2__config_8c_source.html#l00025">mp_def</a>, <a class="el" href="client_8h_source.html#l00043">OmlClient::mpoints</a>, <a class="el" href="mstring_8c_source.html#l00222">mstring_buf()</a>, <a class="el" href="mstring_8c_source.html#l00073">mstring_create()</a>, <a class="el" href="mstring_8c_source.html#l00237">mstring_delete()</a>, <a class="el" href="mstring_8c_source.html#l00160">mstring_sprintf()</a>, <a class="el" href="omlc_8h_source.html#l00668">OmlMPDef::name</a>, <a class="el" href="omlc_8h_source.html#l00691">OmlMP::name</a>, <a class="el" href="omlc_8h_source.html#l00714">OmlMP::next</a>, <a class="el" href="client_8h_source.html#l00074">OmlClient::next_ms_idx</a>, <a class="el" href="mem_8c_source.html#l00240">oml_free()</a>, <a class="el" href="omlc_8h_source.html#l00037">OML_LONG_VALUE</a>, <a class="el" href="mem_8c_source.html#l00157">oml_malloc()</a>, <a class="el" href="init_8c_source.html#l01153">oml_mp_get_default_ms()</a>, <a class="el" href="omlc_8h_source.html#l00039">OML_STRING_VALUE</a>, <a class="el" href="api_8c_source.html#l00218">omlc_inject_metadata()</a>, <a class="el" href="omlc_8h_source.html#l00457">omlc_reset_string</a>, <a class="el" href="omlc_8h_source.html#l00505">omlc_set_string</a>, <a class="el" href="omlc_8h_source.html#l00209">omlc_zero</a>, <a class="el" href="omlc_8h_source.html#l00696">OmlMP::param_count</a>, <a class="el" href="omlc_8h_source.html#l00694">OmlMP::param_defs</a>, <a class="el" href="omlc_8h_source.html#l00671">OmlMPDef::param_types</a>, <a class="el" href="omlc_8h_source.html#l00674">OmlMPDef::relations</a>, <a class="el" href="client_8h_source.html#l00057">OmlClient::start_time</a>, <a class="el" href="omlc_8h_source.html#l00702">OmlMP::streams</a>, and <a class="el" href="validate_8c_source.html#l00036">validate_name()</a>.</p>

<p>Referenced by <a class="el" href="blobgen_8c_source.html#l00216">main()</a>, <a class="el" href="init_8c_source.html#l00096">omlc_init()</a>, and <a class="el" href="check__liboml2__api_8c_source.html#l00113">START_TEST()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> pc = 0;</div>
<div class="line">  <span class="keywordtype">char</span> *schemastr;</div>
<div class="line">  <a class="code" href="structMString.html">MString</a> *meta;</div>
<div class="line">  <a class="code" href="unionOmlValueU.html">OmlValueU</a> v;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="omlc_8h.html#a5cd79ce130e86f27ce8bae31400beffe">omlc_zero</a>(v);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a> == NULL) { <span class="keywordflow">return</span> NULL; }</div>
<div class="line">  <span class="keywordflow">if</span> (!<a class="code" href="validate_8c.html#a85934d9b2c3cfbeb3f718b179a2fb596">validate_name</a> (mp_name)) {</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Illegal MP name &#39;%s&#39;: missing or containing whitespaces or dashes; MP will not be created\n&quot;</span>, mp_name);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="log_8c.html#a1db1902215b0897e1ec8c2a8766465b2">logdebug</a>(<span class="stringliteral">&quot;Adding MP %s\n&quot;</span>, mp_name);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="structOmlMP.html">OmlMP</a>* <a class="code" href="structmp.html">mp</a> = (<a class="code" href="structOmlMP.html">OmlMP</a>*)<a class="code" href="omlc_8h.html#a8616cb714d6589098267bba8fc7b48c2">oml_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structOmlMP.html">OmlMP</a>));</div>
<div class="line">  memset(mp, 0, <span class="keyword">sizeof</span>(<a class="code" href="structOmlMP.html">OmlMP</a>));</div>
<div class="line"></div>
<div class="line">  mp-&gt;<a class="code" href="structOmlMP.html#a5f99c0c042cdd120e19271c716d3eaac">name</a> = mp_name;</div>
<div class="line">  mp-&gt;<a class="code" href="structOmlMP.html#a8269442d91a3e59d2e26b254eb232d3e">param_defs</a> = <a class="code" href="check__liboml2__config_8c.html#a390ebaee0bf455c72a8df44f5dd345e7">mp_def</a>;</div>
<div class="line">  <a class="code" href="structOmlMPDef.html">OmlMPDef</a>* dp = <a class="code" href="check__liboml2__config_8c.html#a390ebaee0bf455c72a8df44f5dd345e7">mp_def</a>;</div>
<div class="line">  <span class="keywordflow">while</span> (dp != NULL &amp;&amp; dp-&gt;<a class="code" href="structOmlMPDef.html#a4d058714a8007ca1a7cccc6b35aebdd1">name</a> != NULL) {</div>
<div class="line">    <span class="keywordflow">if</span> (dp-&gt;<a class="code" href="structOmlMPDef.html#ae973305703cc2bbc5d72f110db6eba38">param_types</a> == <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012a22fda4d714f29db7df49a3574986e67c">OML_LONG_VALUE</a>) {</div>
<div class="line">      <a class="code" href="log_8c.html#ac65b3f90d3228474368b2b48a488cd44">logwarn</a>(<span class="stringliteral">&quot;MP &#39;%s&#39;, field &#39;%s&#39;: OML_LONG_VALUE is deprecated, please use OML_INT32_VALUE instead; &quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;values outside of [INT_MIN, INT_MAX] will be clamped\n&quot;</span>,</div>
<div class="line">          mp-&gt;<a class="code" href="structOmlMP.html#a5f99c0c042cdd120e19271c716d3eaac">name</a>, dp-&gt;<a class="code" href="structOmlMPDef.html#a4d058714a8007ca1a7cccc6b35aebdd1">name</a>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="validate_8c.html#a85934d9b2c3cfbeb3f718b179a2fb596">validate_name</a> (dp-&gt;<a class="code" href="structOmlMPDef.html#a4d058714a8007ca1a7cccc6b35aebdd1">name</a>)) {</div>
<div class="line">      <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Illegal field name &#39;%s&#39; in MP %s: missing or containing whitespaces or dashes; MP will not be created\n&quot;</span>,</div>
<div class="line">          dp-&gt;<a class="code" href="structOmlMPDef.html#a4d058714a8007ca1a7cccc6b35aebdd1">name</a>, mp_name);</div>
<div class="line">      <span class="keywordflow">while</span> (<a class="code" href="init_8c.html#a50aae756ce043a9b74775a48c13aba0c">destroy_sem_concepts</a>(mp-&gt;<a class="code" href="structOmlMP.html#a8269442d91a3e59d2e26b254eb232d3e">param_defs</a>-&gt;<a class="code" href="structOmlMPDef.html#a16cc14202a8d12ac8929b7889ea34d1d">relations</a>));</div>
<div class="line">      <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a> (mp);</div>
<div class="line">      <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    pc++;</div>
<div class="line">    dp++;</div>
<div class="line">  }</div>
<div class="line">  mp-&gt;<a class="code" href="structOmlMP.html#a15a16f8336c4ddb062432f391f40a302">param_count</a> = pc;</div>
<div class="line">  mp-&gt;<a class="code" href="structOmlMP.html#a953097bd43715d18d3cc10b47d14d03c">active</a> = 1;  <span class="comment">// True if there is an attached MS.</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(<a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a89d86ad01212dc1bcde47399d890fa2e">start_time</a> &gt; 0) {</div>
<div class="line">    <span class="comment">/* omlc_start has already been called, declare MP through schema0 */</span></div>
<div class="line">    meta = <a class="code" href="mstring_8c.html#a49f0faf4fe4e38a6d7b4f0ef09d5fd24">mstring_create</a>();</div>
<div class="line">    schemastr = schemastr_from_mpdef(mp_def);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Unlike how we manage schema0, we do prepend the application name to the</span></div>
<div class="line"><span class="comment">     * MP name, even when declared after the start. This is mostly because that</span></div>
<div class="line"><span class="comment">     * concatenation happens anyway on the client side, when creating the</span></div>
<div class="line"><span class="comment">     * default filter configuration, and we don&#39;t want too many discrepancies</span></div>
<div class="line"><span class="comment">     * between the client and servers views at this stage. See #1055. */</span></div>
<div class="line">    <a class="code" href="mstring_8c.html#ad28234c6cddf0af9ad2c538885e70ebf">mstring_sprintf</a>(meta, <span class="stringliteral">&quot;%d %s_%s%s&quot;</span>,</div>
<div class="line">        <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a6fbd78b95d92749e741fdaebfb4d3119">next_ms_idx</a>, <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a892c8aaacb821f1c3e90285ab97dce1b">app_name</a>, mp_name, schemastr);</div>
<div class="line">    <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(schemastr);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="log_8c.html#a1db1902215b0897e1ec8c2a8766465b2">logdebug</a>(<span class="stringliteral">&quot;omlc_start already called, adding MP through schema 0: %s\n&quot;</span>,</div>
<div class="line">        <a class="code" href="mstring_8c.html#ab18dbe1f8aa51964e0a15813991daf73">mstring_buf</a>(meta));</div>
<div class="line"></div>
<div class="line">    <a class="code" href="omlc_8h.html#a13be9537ef85ccdc463a6172d4716d3a">omlc_set_string</a>(v, <a class="code" href="mstring_8c.html#ab18dbe1f8aa51964e0a15813991daf73">mstring_buf</a>(meta));</div>
<div class="line">    <a class="code" href="api_8c.html#a8c8205b04c4b8d19a38404ee5d4b3229">omlc_inject_metadata</a>(NULL, <span class="stringliteral">&quot;schema&quot;</span>, &amp;v, <a class="code" href="omlc_8h.html#ab15565231ebb9d8d8550c14e0aaa3012a42b33eb7c21f79727a894a530a05b559">OML_STRING_VALUE</a>, NULL);</div>
<div class="line">    <a class="code" href="omlc_8h.html#a1434bd8b5a841357336609930bdb05c3">omlc_reset_string</a>(v);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="mstring_8c.html#a22eb366ee3317407b4233d6216b690a3">mstring_delete</a>(meta);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="client_8h.html#a5c8c53afa6d604173e0abd9b2a824089">oml_mp_get_default_ms</a>(mp)) {</div>
<div class="line">      <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Failed to create default MS for MP %s\n&quot;</span>, mp_name);</div>
<div class="line">      <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(mp);</div>
<div class="line">      <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* At this stage, we only have one stream set up, and we now its index */</span></div>
<div class="line">    mp-&gt;<a class="code" href="structOmlMP.html#a0053c119979daf6d558c414b685e17f5">streams</a>-&gt;<a class="code" href="structOmlMStream.html#a3634b519ff9e471bac5741b5d8f3c2b0">index</a> = <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a6fbd78b95d92749e741fdaebfb4d3119">next_ms_idx</a>++;</div>
<div class="line"></div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (NULL == <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a4050599cbe022fe59c5308d7bc8b33fb">mpoints</a>) {</div>
<div class="line">    <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a4050599cbe022fe59c5308d7bc8b33fb">mpoints</a> = <a class="code" href="check__liboml2__api_8c.html#a8f5ec90394e42efb227d03ce038b0377">mp</a>;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a31cc1a98dc35eb112a7617ee2611d206">last_mpoint</a>-&gt;<a class="code" href="structOmlMP.html#afc2a31e64cd23aeb0878b87acb8ef577">next</a> = <a class="code" href="check__liboml2__api_8c.html#a8f5ec90394e42efb227d03ce038b0377">mp</a>;</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a31cc1a98dc35eb112a7617ee2611d206">last_mpoint</a> = <a class="code" href="check__liboml2__api_8c.html#a8f5ec90394e42efb227d03ce038b0377">mp</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="check__liboml2__api_8c.html#a8f5ec90394e42efb227d03ce038b0377">mp</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5870e99b923df20b3d7c16397bb88d87"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int omlc_close </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Terminate all open connections.</p>
<p>Once this function has been called, any futher calls to <a class="el" href="api_8c.html#ac714a82b22dfcc34a6b6130e047f2ab7">omlc_inject()</a> will be ignored.</p>
<p>This call doesn't free all memory used by OML immediately. There may be a few threads which will take some time to finish while the remaining buffered data is sent.</p>
<dl class="section return"><dt>Returns</dt><dd>0 on sucess, -1 otherwise </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l00637">637</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="oml__writer_8h_source.html#l00114">OmlWriter::close</a>, <a class="el" href="init_8c_source.html#l00493">destroy_mp()</a>, <a class="el" href="client_8h_source.html#l00051">OmlClient::first_writer</a>, <a class="el" href="client_8h_source.html#l00043">OmlClient::mpoints</a>, <a class="el" href="o__log_8h_source.html#l00026">O_LOG_DEBUG</a>, <a class="el" href="mem_8c_source.html#l00240">oml_free()</a>, <a class="el" href="mem_8c_source.html#l00133">oml_memreport()</a>, and <a class="el" href="factory_8c_source.html#l00283">unregister_filters()</a>.</p>

<p>Referenced by <a class="el" href="blobgen_8c_source.html#l00216">main()</a>, <a class="el" href="monitoring__server_8c_source.html#l00059">oml_cleanup()</a>, <a class="el" href="init_8c_source.html#l00096">omlc_init()</a>, <a class="el" href="init_8c_source.html#l00539">omlc_start()</a>, and <a class="el" href="check__liboml2__api_8c_source.html#l00084">START_TEST()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (NULL == <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>) {</div>
<div class="line">    <span class="keywordflow">return</span> 0; <span class="comment">/* Already clear */</span></div>
<div class="line"></div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="structOmlWriter.html">OmlWriter</a>* w = <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#acc59517d7d5b3a215937bdcc4e361424">first_writer</a>;</div>
<div class="line">    <a class="code" href="structOmlMP.html">OmlMP</a>* <a class="code" href="structmp.html">mp</a> = <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a4050599cbe022fe59c5308d7bc8b33fb">mpoints</a>;</div>
<div class="line"></div>
<div class="line">    install_close_handler(SIG_DFL);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span>( (mp = <a class="code" href="client_8h.html#ac821f21a0da9c8aae8be1cac73331166">destroy_mp</a>(mp)) );</div>
<div class="line">    <span class="keywordflow">if</span> (w) {</div>
<div class="line">      <span class="keywordflow">while</span>( (w =  w-&gt;<a class="code" href="structOmlWriter.html#a7a1f7687a82a0c5e0ec6260fe813cd2d">close</a>(w)) );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="factory_8c.html#a3b2560ca7534148c833ae560eded9188">unregister_filters</a> ();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="omlc_8h.html#aa191af748bdc144fc077967bdacaaf70">oml_free</a>(<a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a> = NULL;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="mem_8c.html#aa0934ec8e4933ff414fd8844bc9befe7">oml_memreport</a>(<a class="code" href="o__log_8h.html#a9b68704e34b864d25ec14e9525083de2">O_LOG_DEBUG</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7d59c725c0197f45301bf777dec8a49d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int omlc_init </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>application</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>pargc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>argv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="o__log_8h.html#a69596e3d9e045591318cfc6d660c8f64">o_log_fn</a>&#160;</td>
          <td class="paramname"><em>custom_oml_log</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialise the measurement library.</p>
<p>This functions parses the command line for &ndash;oml-* options and acts accordingly when they are found. A side effect of this function is that these options and their arguments are removed from argv, so the instrumented application doesn't see spurious OML option it can't make sense of.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>name of the application </td></tr>
    <tr><td class="paramname">pargc</td><td>argc of the command line of the application </td></tr>
    <tr><td class="paramname">argv</td><td>argv of the command line of the application </td></tr>
    <tr><td class="paramname">custom_oml_log</td><td>custom format-based logging function </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on failure, 1 when OML is disabled.</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="omlc_8h.html#a13e1026b136bfacfbb3764d454241db0">omlc_add_mp</a>, <a class="el" href="omlc_8h.html#a954c3f97690fa905e2559845248278ab">omlc_start</a>, <a class="el" href="omlc_8h.html#a5870e99b923df20b3d7c16397bb88d87">omlc_close</a> </dd>
<dd>
<a class="el" href="o__log_8h.html#a69596e3d9e045591318cfc6d660c8f64">o_log_fn</a>, <a class="el" href="o__log_8h.html#aebb476e9552e608a745ab5ac53cacc56">o_set_log</a> </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l00096">96</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="client_8h_source.html#l00036">OmlClient::app_name</a>, <a class="el" href="client_8h_source.html#l00080">OmlClient::client_instr</a>, <a class="el" href="client_8h_source.html#l00048">OmlClient::collection_uri</a>, <a class="el" href="client_8h_source.html#l00026">COLLECTION_URI_MAX_LENGTH</a>, <a class="el" href="client_8h_source.html#l00054">OmlClient::config_file</a>, <a class="el" href="client_8h_source.html#l00069">OmlClient::default_encoding</a>, <a class="el" href="client_8h_source.html#l00038">OmlClient::domain</a>, <a class="el" href="client_8h_source.html#l00086">OmlClient::instr_interval</a>, <a class="el" href="client_8h_source.html#l00083">OmlClient::instr_time</a>, <a class="el" href="log_8c_source.html#l00297">logerror()</a>, <a class="el" href="log_8c_source.html#l00321">loginfo()</a>, <a class="el" href="log_8c_source.html#l00309">logwarn()</a>, <a class="el" href="client_8h_source.html#l00067">OmlClient::max_queue</a>, <a class="el" href="init_8c_source.html#l01493">name</a>, <a class="el" href="client_8h_source.html#l00040">OmlClient::node_name</a>, <a class="el" href="o__log_8h_source.html#l00025">O_LOG_INFO</a>, <a class="el" href="log_8c_source.html#l00106">o_set_log()</a>, <a class="el" href="log_8c_source.html#l00057">o_set_log_file()</a>, <a class="el" href="log_8c_source.html#l00083">o_set_log_level()</a>, <a class="el" href="mem_8c_source.html#l00157">oml_malloc()</a>, <a class="el" href="oml__writer_8h_source.html#l00030">OML_PROTOCOL_VERSION</a>, <a class="el" href="init_8c_source.html#l00365">omlc_add_mp()</a>, <a class="el" href="init_8c_source.html#l00637">omlc_close()</a>, <a class="el" href="init_8c_source.html#l00038">OMLC_COPYRIGHT</a>, <a class="el" href="factory_8c_source.html#l00270">register_builtin_filters()</a>, <a class="el" href="client_8h_source.html#l00063">OmlClient::sample_count</a>, <a class="el" href="client_8h_source.html#l00065">OmlClient::sample_interval</a>, <a class="el" href="oml__writer_8h_source.html#l00128">SE_Binary</a>, <a class="el" href="oml__writer_8h_source.html#l00126">SE_None</a>, <a class="el" href="oml__writer_8h_source.html#l00127">SE_Text</a>, <a class="el" href="init_8c_source.html#l01473">validate_app_name()</a>, and <a class="el" href="config_8h_source.html#l00164">VERSION</a>.</p>

<p>Referenced by <a class="el" href="blobgen_8c_source.html#l00216">main()</a>, <a class="el" href="monitoring__server_8c_source.html#l00036">oml_setup()</a>, and <a class="el" href="check__liboml2__api_8c_source.html#l00084">START_TEST()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *app_name = <a class="code" href="client_8h.html#a4412addfb041b81d8b5dd6ce44153952">validate_app_name</a> (application);</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = NULL;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* domain = NULL;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* config_file = NULL;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* local_data_file = NULL;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* collection_uri = NULL;</div>
<div class="line">  <span class="keywordtype">char</span> *start = NULL, *end = NULL; <span class="comment">/* For strtoX(3) */</span></div>
<div class="line">  <span class="keyword">enum</span> <a class="code" href="oml__writer_8h.html#a959172e0c35e858e1ade72178cf27173">StreamEncoding</a> default_encoding = <a class="code" href="oml__writer_8h.html#a959172e0c35e858e1ade72178cf27173aedbfd5c057213d683dab8b73f2c0d8a1">SE_None</a>;</div>
<div class="line">  <span class="keywordtype">int</span> sample_count = 0;</div>
<div class="line">  <span class="keywordtype">double</span> sample_interval = 0.0;</div>
<div class="line">  <span class="keywordtype">int</span> max_queue = 0;</div>
<div class="line">  uint32_t instr_interval = 1;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>** arg = argv;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (!app_name) {</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Illegal application name &#39;%s&#39;: missing or containing whitespaces or dashes\n&quot;</span>, application);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a> = NULL;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="log_8c.html#add76efe2ed8cc1b5444092218e2ee6c6">o_set_log_level</a>(<a class="code" href="o__log_8h.html#aa867321b24d858837927a020a40e30af">O_LOG_INFO</a>);</div>
<div class="line">  <span class="keywordflow">if</span> (custom_oml_log)</div>
<div class="line">    <a class="code" href="log_8c.html#ac4060a8c43276317f46ee183cba8ee7e">o_set_log</a> (custom_oml_log);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (pargc &amp;&amp; arg) {</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    <span class="keywordflow">for</span> (i = *pargc; i &gt; 0; i--, arg++) {</div>
<div class="line">      <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-id&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (--i &lt;= 0) {</div>
<div class="line">          <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Missing argument for &#39;--oml-id&#39;\n&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        name = *++arg;</div>
<div class="line">        *pargc -= 2;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-domain&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (--i &lt;= 0) {</div>
<div class="line">          <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Missing argument for &#39;--oml-domain&#39;\n&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        domain = *++arg;</div>
<div class="line">        *pargc -= 2;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-exp-id&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (--i &lt;= 0) {</div>
<div class="line">          <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Missing argument for &#39;--oml-exp-id&#39;\n&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        domain = *++arg;</div>
<div class="line">        <a class="code" href="log_8c.html#ac65b3f90d3228474368b2b48a488cd44">logwarn</a>(<span class="stringliteral">&quot;Option --oml-exp-id is getting deprecated; please use &#39;--oml-domain %s&#39; instead\n&quot;</span>, domain);</div>
<div class="line">        *pargc -= 2;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-file&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (--i &lt;= 0) {</div>
<div class="line">          <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Missing argument for &#39;--oml-file&#39;\n&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        local_data_file = *++arg;</div>
<div class="line">        <a class="code" href="log_8c.html#ac65b3f90d3228474368b2b48a488cd44">logwarn</a>(<span class="stringliteral">&quot;Option --oml-file is getting deprecated; please use &#39;--oml-collect file:%s&#39; instead\n&quot;</span>, local_data_file);</div>
<div class="line">        *pargc -= 2;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-collect&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (--i &lt;= 0) {</div>
<div class="line">          <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Missing argument for &#39;--oml-collect&#39;\n&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        collection_uri = (<span class="keywordtype">char</span>*)*++arg;</div>
<div class="line">        *pargc -= 2;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-config&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (--i &lt;= 0) {</div>
<div class="line">          <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Missing argument for &#39;--oml-config&#39;\n&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        config_file = *++arg;</div>
<div class="line">        *pargc -= 2;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-samples&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (--i &lt;= 0) {</div>
<div class="line">          <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Missing argument to &#39;--oml-samples&#39;\n&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        sample_count = atoi(*++arg);</div>
<div class="line">        *pargc -= 2;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-interval&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (--i &lt;= 0) {</div>
<div class="line">          <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Missing argument to &#39;--oml-interval&#39;\n&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        sample_interval = atof(*++arg);</div>
<div class="line">        *pargc -= 2;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-log-file&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (--i &lt;= 0) {</div>
<div class="line">          <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Missing argument to &#39;--oml-log-file&#39;\n&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="log_8c.html#a7bf16653217eb39ef83311178236705b">o_set_log_file</a>((<span class="keywordtype">char</span>*)*++arg);</div>
<div class="line">        *pargc -= 2;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-log-level&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (--i &lt;= 0) {</div>
<div class="line">          <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Missing argument to &#39;--oml-log-level&#39;\n&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="log_8c.html#add76efe2ed8cc1b5444092218e2ee6c6">o_set_log_level</a>(atoi(*++arg));</div>
<div class="line">        *pargc -= 2;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-server&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (--i &lt;= 0) {</div>
<div class="line">          <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Missing argument for &#39;--oml-server&#39;\n&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        collection_uri = (<span class="keywordtype">char</span>*)*++arg;</div>
<div class="line">        <a class="code" href="log_8c.html#ac65b3f90d3228474368b2b48a488cd44">logwarn</a>(<span class="stringliteral">&quot;Option --oml-server is getting deprecated; please use &#39;--oml-collect %s&#39; instead\n&quot;</span>, collection_uri);</div>
<div class="line">        *pargc -= 2;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (*arg, <span class="stringliteral">&quot;--oml-text&quot;</span>) == 0) {</div>
<div class="line">        *pargc -= 1;</div>
<div class="line">        default_encoding = <a class="code" href="oml__writer_8h.html#a959172e0c35e858e1ade72178cf27173a69ceab39b4642dd473e40f96f3abcddc">SE_Text</a>;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (*arg, <span class="stringliteral">&quot;--oml-binary&quot;</span>) == 0) {</div>
<div class="line">        *pargc -= 1;</div>
<div class="line">        default_encoding = <a class="code" href="oml__writer_8h.html#a959172e0c35e858e1ade72178cf27173a4fe1ba3f0e240b2e7ea8e0513e5c0212">SE_Binary</a>;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-bufsize&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (--i &lt;= 0) {</div>
<div class="line">          <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Missing argument to &#39;--oml-bufsize&#39;\n&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        max_queue = atoi(*++arg);</div>
<div class="line">        *pargc -= 2;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-instr-interval&quot;</span>) == 0) {</div>
<div class="line">        start = (<span class="keywordtype">char</span> *)*++arg; <span class="comment">/* XXX: Drop arg&#39;s const */</span></div>
<div class="line">        end = NULL;</div>
<div class="line">        <span class="keywordflow">if</span> (--i &lt;= 0) {</div>
<div class="line">          <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Missing argument to &#39;--oml-instr-interval&#39;\n&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        instr_interval = strtoul(start, &amp;end, 10);</div>
<div class="line">        <span class="keywordflow">if</span>(end == *arg || *end != <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line">          <a class="code" href="log_8c.html#ac65b3f90d3228474368b2b48a488cd44">logwarn</a>(<span class="stringliteral">&quot;Invalid argument to &#39;--oml-instr-interval&#39;\n&quot;</span>);</div>
<div class="line">          instr_interval = 0;</div>
<div class="line">        }</div>
<div class="line">        *pargc -= 2;</div>
<div class="line">        <span class="keywordflow">if</span>(0 == instr_interval) {</div>
<div class="line">          <a class="code" href="log_8c.html#aea4dca1a8e24794377ba1bf45fbbfce8">loginfo</a>(<span class="stringliteral">&quot;Client instrumentation disabled\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-noop&quot;</span>) == 0) {</div>
<div class="line">        *pargc -= 1;</div>
<div class="line">        <a class="code" href="init_8c.html#a5870e99b923df20b3d7c16397bb88d87">omlc_close</a>();</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-help&quot;</span>) == 0) {</div>
<div class="line">        usage();</div>
<div class="line">        *pargc -= 1;</div>
<div class="line">        exit(0);</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(*arg, <span class="stringliteral">&quot;--oml-list-filters&quot;</span>) == 0) {</div>
<div class="line">        print_filters();</div>
<div class="line">        *pargc -= 1;</div>
<div class="line">        exit(0);</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        *argv++ = *arg;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (name == NULL) {</div>
<div class="line">    name = getenv(<span class="stringliteral">&quot;OML_NAME&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (domain == NULL) {</div>
<div class="line">    <span class="keywordflow">if</span>(!(domain = getenv(<span class="stringliteral">&quot;OML_DOMAIN&quot;</span>))) {</div>
<div class="line">      <span class="keywordflow">if</span> ((domain= getenv(<span class="stringliteral">&quot;OML_EXP_ID&quot;</span>))) {</div>
<div class="line">        <a class="code" href="log_8c.html#ac65b3f90d3228474368b2b48a488cd44">logwarn</a>(<span class="stringliteral">&quot;Enviromnent variable OML_EXP_ID is getting deprecated; please use &#39;OML_DOMAIN=\&quot;%s\&quot;&#39; instead\n&quot;</span>,</div>
<div class="line">            domain);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (config_file == NULL) {</div>
<div class="line">    config_file = getenv(<span class="stringliteral">&quot;OML_CONFIG&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (local_data_file == NULL &amp;&amp; collection_uri == NULL) {</div>
<div class="line">    <span class="keywordflow">if</span>(!(collection_uri = getenv(<span class="stringliteral">&quot;OML_COLLECT&quot;</span>))) {</div>
<div class="line">      <span class="keywordflow">if</span> ((collection_uri = getenv(<span class="stringliteral">&quot;OML_SERVER&quot;</span>))) {</div>
<div class="line">        <a class="code" href="log_8c.html#ac65b3f90d3228474368b2b48a488cd44">logwarn</a>(<span class="stringliteral">&quot;Enviromnent variable OML_SERVER is getting deprecated; please use &#39;OML_COLLECT=\&quot;%s\&quot;&#39; instead\n&quot;</span>,</div>
<div class="line">            collection_uri);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(collection_uri == NULL) {</div>
<div class="line">    collection_uri = default_uri(app_name, name, domain);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  setup_features (getenv (<span class="stringliteral">&quot;OML_FEATURES&quot;</span>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a> = <a class="code" href="omlc_8h.html#a8616cb714d6589098267bba8fc7b48c2">oml_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structOmlClient.html">OmlClient</a>));</div>
<div class="line">  memset(<a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="structOmlClient.html">OmlClient</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a892c8aaacb821f1c3e90285ab97dce1b">app_name</a> = app_name;</div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a4190f5fc636fde56eae321f0f39c07ba">node_name</a> = <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>;</div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#adc89fb9df041d3e5c14ebf4df6f856c4">domain</a> = domain;</div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a6a1e7783b73a5c3c927faac1952b9df0">sample_count</a> = sample_count;</div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a653012b8d0c03c8fbdc72f61a6cfe25b">sample_interval</a> = sample_interval;</div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a3c4e2a12844675cdcc6e66274fa6de5e">default_encoding</a> = default_encoding;</div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#abfc08a3aa1c2c3d81dcb7580d14ee95b">max_queue</a> = max_queue;</div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#af593694695f0cceba6b1883bff63312a">instr_time</a> = 0;</div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#ab926bac3c12f3771f37c2271f825bcc9">instr_interval</a> = instr_interval;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (local_data_file != NULL) {</div>
<div class="line">    <span class="comment">// dump every sample into local_data_file</span></div>
<div class="line">    <span class="keywordflow">if</span> (local_data_file[0] == <span class="charliteral">&#39;-&#39;</span>)</div>
<div class="line">      local_data_file = <span class="stringliteral">&quot;stdout&quot;</span>;</div>
<div class="line">    snprintf(<a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a9dc20980bd95e7e9c85f9d281dfd49ab">collection_uri</a>, <a class="code" href="client_8h.html#a5be3da2fcc3e91c1d5acbaa8349804a7">COLLECTION_URI_MAX_LENGTH</a>, <span class="stringliteral">&quot;file:%s&quot;</span>, local_data_file);</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (collection_uri != NULL) {</div>
<div class="line">    strncpy(<a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a9dc20980bd95e7e9c85f9d281dfd49ab">collection_uri</a>, collection_uri, <a class="code" href="client_8h.html#a5be3da2fcc3e91c1d5acbaa8349804a7">COLLECTION_URI_MAX_LENGTH</a>);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a789509a110c6eedee3c363070e5f9fbe">config_file</a> = config_file;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="factory_8c.html#a95cd16d40158b8222e35231be1931723">register_builtin_filters</a> ();</div>
<div class="line"></div>
<div class="line">  <a class="code" href="api_8c.html#ab37d06b7aa57f34099a4dbcff29635b7">schema0</a> = <a class="code" href="init_8c.html#a13e1026b136bfacfbb3764d454241db0">omlc_add_mp</a>(<span class="stringliteral">&quot;_experiment_metadata&quot;</span>, _experiment_metadata);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a301a86e1b0438b15f455f15e56111677">client_instr</a> = <a class="code" href="init_8c.html#a13e1026b136bfacfbb3764d454241db0">omlc_add_mp</a>(<span class="stringliteral">&quot;_client_instrumentation&quot;</span>, _client_instrumentation);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="log_8c.html#aea4dca1a8e24794377ba1bf45fbbfce8">loginfo</a> (<span class="stringliteral">&quot;OML Client %s [OMSPv%d] %s\n&quot;</span>,</div>
<div class="line">           <a class="code" href="config_8h.html#a1c6d5de492ac61ad29aec7aa9a436bbf">VERSION</a>,</div>
<div class="line">           <a class="code" href="oml__writer_8h.html#af75a169577e29521487110b60fa97c9f">OML_PROTOCOL_VERSION</a>,</div>
<div class="line">           <a class="code" href="init_8c.html#ab32f71cc3deb43c84b63074fb3fe99cb">OMLC_COPYRIGHT</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2e2497cb5b09c1c6d9b634d2d60db587"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int omlc_start </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get ready to start the measurement collection.</p>
<p>This function must be called after omlc_init and after any calls to <a class="el" href="init_8c.html#a13e1026b136bfacfbb3764d454241db0">omlc_add_mp()</a>. It finalises the initialisation process and initialises filters on all measurement points, according to the current configuration (based on either command line options or the XML config file named by the &ndash;oml-config command line option).</p>
<p>It also registers a termination handler.</p>
<p>Once this function has been called, and if it succeeds, the application is free to start creating measurement samples by calling <a class="el" href="api_8c.html#ac714a82b22dfcc34a6b6130e047f2ab7">omlc_inject()</a>.</p>
<p>If this function fails, subsequent calls to <a class="el" href="api_8c.html#ac714a82b22dfcc34a6b6130e047f2ab7">omlc_inject()</a> will result in undefined behaviour.</p>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on failure</dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="omlc_8h.html#aa686fff2f026c0aab59c9e62e2a3e892">omlc_init</a>, <a class="el" href="omlc_8h.html#a13e1026b136bfacfbb3764d454241db0">omlc_add_mp</a>, <a class="el" href="omlc_8h.html#a5870e99b923df20b3d7c16397bb88d87">omlc_close</a> </dd>
<dd>
install_close_handler, termination_handler </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l00539">539</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="client_8h_source.html#l00048">OmlClient::collection_uri</a>, <a class="el" href="client_8h_source.html#l00054">OmlClient::config_file</a>, <a class="el" href="log_8c_source.html#l00297">logerror()</a>, <a class="el" href="init_8c_source.html#l00637">omlc_close()</a>, <a class="el" href="parse__config_8c_source.html#l00223">parse_config()</a>, and <a class="el" href="client_8h_source.html#l00057">OmlClient::start_time</a>.</p>

<p>Referenced by <a class="el" href="blobgen_8c_source.html#l00216">main()</a>, <a class="el" href="monitoring__server_8c_source.html#l00036">oml_setup()</a>, and <a class="el" href="check__liboml2__api_8c_source.html#l00143">START_TEST()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a> == NULL) { <span class="keywordflow">return</span> -1; }</div>
<div class="line"></div>
<div class="line">  <span class="keyword">struct </span>timeval tv;</div>
<div class="line">  gettimeofday(&amp;tv, NULL);</div>
<div class="line">  <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a89d86ad01212dc1bcde47399d890fa2e">start_time</a> = tv.tv_sec;</div>
<div class="line"></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* config_file = <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a789509a110c6eedee3c363070e5f9fbe">config_file</a>;</div>
<div class="line">  <span class="keywordflow">if</span> (config_file) {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="init_8c.html#a364a05acae7db3091162b661cf0ed245">parse_config</a>((<span class="keywordtype">char</span>*)config_file)) {</div>
<div class="line">      <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Error while parsing configuration &#39;%s&#39;\n&quot;</span>, config_file);</div>
<div class="line">      <a class="code" href="init_8c.html#a5870e99b923df20b3d7c16397bb88d87">omlc_close</a>();</div>
<div class="line">      <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a9dc20980bd95e7e9c85f9d281dfd49ab">collection_uri</a> == NULL) {</div>
<div class="line">      <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Missing --oml-collect declaration.\n&quot;</span>);</div>
<div class="line">      <a class="code" href="init_8c.html#a5870e99b923df20b3d7c16397bb88d87">omlc_close</a>();</div>
<div class="line">      <span class="keywordflow">return</span> -2;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (default_configuration()) {</div>
<div class="line">      <a class="code" href="init_8c.html#a5870e99b923df20b3d7c16397bb88d87">omlc_close</a>();</div>
<div class="line">      <span class="keywordflow">return</span> -3;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  install_close_handler(termination_handler);</div>
<div class="line">  <span class="keywordflow">if</span> (write_meta() == -1) {</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a364a05acae7db3091162b661cf0ed245"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int parse_config </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>configFile</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Parse the config file to configure liboml2. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">configFile</td><td>the name of the config file </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if successful &lt;0 otherwise </dd></dl>

<p>Definition at line <a class="el" href="parse__config_8c_source.html#l00223">223</a> of file <a class="el" href="parse__config_8c_source.html">parse_config.c</a>.</p>

<p>References <a class="el" href="parse__config_8c_source.html#l00030">CT_COLLECT</a>, <a class="el" href="parse__config_8c_source.html#l00029">CT_EXP</a>, <a class="el" href="parse__config_8c_source.html#l00028">CT_NODE</a>, <a class="el" href="parse__config_8c_source.html#l00027">CT_ROOT</a>, <a class="el" href="client_8h_source.html#l00038">OmlClient::domain</a>, <a class="el" href="log_8c_source.html#l00333">logdebug()</a>, <a class="el" href="log_8c_source.html#l00297">logerror()</a>, <a class="el" href="client_8h_source.html#l00040">OmlClient::node_name</a>, and <a class="el" href="init_8c_source.html#l00040">omlc_instance</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00539">omlc_start()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  xmlDocPtr doc;</div>
<div class="line">  xmlNodePtr cur;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="log_8c.html#a1db1902215b0897e1ec8c2a8766465b2">logdebug</a>(<span class="stringliteral">&quot;Using configuration file &#39;%s&#39;\n&quot;</span>, configFile);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> ((doc = xmlParseFile(configFile)) == NULL) {</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Config file &#39;%s&#39; not parsed successfully.\n&quot;</span>,</div>
<div class="line">      configFile);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> ((cur = xmlDocGetRootElement(doc)) == NULL) {</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Config file &#39;%s&#39; is empty.\n&quot;</span>, configFile);</div>
<div class="line">    xmlFreeDoc(doc);</div>
<div class="line">    <span class="keywordflow">return</span> -2;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (!match_xml_elt (cur, <a class="code" href="parse__config_8c.html#a2bbc369f5bb70686ffc23968bc543a1ba2c6a98130c624629f66b868711a5147a">CT_ROOT</a>)) {</div>
<div class="line">    <a class="code" href="log_8c.html#a0548af6117bef6d5c78d45a36ab7013b">logerror</a>(<span class="stringliteral">&quot;Config file has incorrect root &#39;%s&#39;, should be &#39;%s&#39;.\n&quot;</span>,</div>
<div class="line">             cur-&gt;name, canonical_name (<a class="code" href="parse__config_8c.html#a2bbc369f5bb70686ffc23968bc543a1ba2c6a98130c624629f66b868711a5147a">CT_ROOT</a>));</div>
<div class="line">    xmlFreeDoc(doc);</div>
<div class="line">    <span class="keywordflow">return</span> -3;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a4190f5fc636fde56eae321f0f39c07ba">node_name</a> == NULL) {</div>
<div class="line">    <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#a4190f5fc636fde56eae321f0f39c07ba">node_name</a> = get_xml_attr(cur, <a class="code" href="parse__config_8c.html#a2bbc369f5bb70686ffc23968bc543a1ba4d61b4203900dc2b2e397ff2dad6baf7">CT_NODE</a>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#adc89fb9df041d3e5c14ebf4df6f856c4">domain</a> == NULL) {</div>
<div class="line">    <a class="code" href="client_8h.html#ae265e6c78eb3c0a1f4fdb40fe894394e">omlc_instance</a>-&gt;<a class="code" href="structOmlClient.html#adc89fb9df041d3e5c14ebf4df6f856c4">domain</a> = get_xml_attr(cur, <a class="code" href="parse__config_8c.html#a2bbc369f5bb70686ffc23968bc543a1ba21353a7d5cc9ecb0a70d6614eddbf4bf">CT_EXP</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  cur = cur-&gt;xmlChildrenNode;</div>
<div class="line">  <span class="keywordflow">while</span> (cur != NULL) {</div>
<div class="line">    <span class="keywordflow">if</span> (match_xml_elt(cur, <a class="code" href="parse__config_8c.html#a2bbc369f5bb70686ffc23968bc543a1ba445fa28fcc822538bd86eb50b03dc0f6">CT_COLLECT</a>)) {</div>
<div class="line">      <span class="keywordflow">if</span> (parse_collector(cur)) {</div>
<div class="line">        xmlFreeDoc(doc);</div>
<div class="line">        <span class="keywordflow">return</span> -4;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    cur = cur-&gt;next;</div>
<div class="line">  }</div>
<div class="line">  xmlFreeDoc(doc);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4412addfb041b81d8b5dd6ce44153952"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* validate_app_name </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Validate the name of the application.</p>
<p>If the application name contains a '/', it is truncated to the sub-string following the final '/'. If the application name contains any characters other than alphanumeric characters or an underscore, it is declared invalid. The first character must not be a digit. Whitespace is not allowed. An empty string is also not allowed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>the name of the application.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>If the application name is valid, a pointer to the application name, possibly truncated, is returned. If the application name is not valid, returns NULL. If the returned pointer is not NULL, it may be different from name. </dd></dl>

<p>Definition at line <a class="el" href="init_8c_source.html#l01473">1473</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="validate_8c_source.html#l00036">validate_name()</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00096">omlc_init()</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> len = strlen (<a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* p = <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> + len - 1;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span> (p &gt;= <a class="code" href="init_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>) {</div>
<div class="line">    <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;/&#39;</span>)</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    p--;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">/* Either 1 character before name, or &#39;/&#39;: need to move forward 1 character */</span></div>
<div class="line">  p++;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="validate_8c.html#a85934d9b2c3cfbeb3f718b179a2fb596">validate_name</a> (p))</div>
<div class="line">    <span class="keywordflow">return</span> p;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<h2>Variable Documentation</h2>
<a class="anchor" id="a12a9bf14173588fa7642590319b3d29c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* enable)(void)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="init_8c_source.html#l01494">1494</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8f8f80d37794cde9472343e4487ba3eb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* name</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="init_8c_source.html#l01493">1493</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l01224">create_default_filter()</a>, <a class="el" href="database_8c_source.html#l00196">database_create_function()</a>, <a class="el" href="fuseki__adapter_8c_source.html#l00201">free_list()</a>, <a class="el" href="init_8c_source.html#l00889">mp_fields_summary()</a>, <a class="el" href="factory_8c_source.html#l00041">next_filter_name()</a>, <a class="el" href="oml__value_8c_source.html#l00325">oml_type_from_s()</a>, <a class="el" href="oml__value_8c_source.html#l00298">oml_type_to_s()</a>, <a class="el" href="init_8c_source.html#l00096">omlc_init()</a>, <a class="el" href="testclient_8c_source.html#l00378">read_mp()</a>, <a class="el" href="testclient_8c_source.html#l00258">read_mp_def()</a>, <a class="el" href="schema_8c_source.html#l00490">schema_from_sql()</a>, <a class="el" href="schema_8c_source.html#l00398">schema_to_sql()</a>, <a class="el" href="check__liboml2__api_8c_source.html#l00084">START_TEST()</a>, <a class="el" href="table__descr_8c_source.html#l00076">table_descr_array_free()</a>, <a class="el" href="headers_8c_source.html#l00209">tag_from_string()</a>, and <a class="el" href="validate_8c_source.html#l00036">validate_name()</a>.</p>

</div>
</div>
<a class="anchor" id="ae265e6c78eb3c0a1f4fdb40fe894394e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOmlClient.html">OmlClient</a>* omlc_instance = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Global <a class="el" href="structOmlClient.html">OmlClient</a> instance </p>

<p>Definition at line <a class="el" href="init_8c_source.html#l00040">40</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>Referenced by <a class="el" href="bin__writer_8c_source.html#l00091">bin_writer_new()</a>, <a class="el" href="api_8c_source.html#l00149">omlc_inject()</a>, <a class="el" href="api_8c_source.html#l00218">omlc_inject_metadata()</a>, <a class="el" href="parse__config_8c_source.html#l00223">parse_config()</a>, <a class="el" href="check__liboml2__api_8c_source.html#l00084">START_TEST()</a>, and <a class="el" href="text__writer_8c_source.html#l00083">text_writer_new()</a>.</p>

</div>
</div>
<a class="anchor" id="ab37d06b7aa57f34099a4dbcff29635b7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structOmlMP.html">OmlMP</a>* schema0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="init_8c_source.html#l00050">50</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_faf4e77b1ae3fad210f246d6190ea8fa.html">client</a></li><li class="navelem"><a class="el" href="init_8c.html">init.c</a></li>
    <li class="footer">Generated on Thu Jun 25 2015 15:31:55 for oml2 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
