<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>oml2: OML Timestamping</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="oml_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">oml2
   &#160;<span id="projectnumber">2.12.0pre.79-58cf-dirty</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('timestamps.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">OML Timestamping </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Process a single key/value pair contained in the header.</p>
<p>XXX: This function actively does text protocol interpretation, see #1088</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td>ClientHandler </td></tr>
    <tr><td class="paramname">key</td><td>key </td></tr>
    <tr><td class="paramname">value</td><td>value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if meta was processed successfully, &lt;0 on error, or &gt;0 if key was not recognised \ page oml2-server XXX: Broken section ordering</dd></dl>
<p>OML provides a timestamping mechanism based on each reporting node's clock (<code>oml_ts_client</code>) at injection time. Upon processing a sample, the server timestamps it a second time (<code>oml_ts_server</code>), according to its own clock. Before storage in the database, all timestamps are rebased to the experiment-wide timebase (see below).</p>
<p>The rebasing works as follows.</p>
<p>Upon connection, the clients send headers to the server as key&ndash;value pairs. One of the keys is the <code>start-time</code> which indicates the client timestamp at which their first message has been generated (<code>oml_ts_client</code> of the sample, <img class="formulaInl" alt="$s_\mathrm{client}^0$" src="form_10.png"/> in the following). For new experiments, this <code>start-time</code> is used as the base: <img class="formulaInl" alt="$s_\mathrm{experiment}=s_\mathrm{client}^0$" src="form_11.png"/>.</p>
<p>All timestamps will be rebased to this reference before being stored in the database. The server's timestamp, <img class="formulaInl" alt="$ts_\mathrm{server}$" src="form_12.png"/> simply get this base subtracted, </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[\mathtt{oml\_ts\_server} = ts_\mathrm{server} - s_\mathrm{experiment}.\]" src="form_13.png"/>
</p>
<p>For subsequently-connecting clients, an offset of their <code>start-time</code> ( <img class="formulaInl" alt="$s_\mathrm{client}^i$" src="form_14.png"/>) to that of the experiment, </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[\delta_i = s_\mathrm{client}^i - s_\mathrm{experiment},\]" src="form_15.png"/>
</p>
<p> is recorded; it is simply 0 for the first client. The timestamp of each sample, <img class="formulaInl" alt="$ts_\mathrm{client}^i$" src="form_16.png"/>, is then rebased as </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[\mathtt{oml\_ts\_client} = ts_\mathrm{client}^i + \delta_i\]" src="form_17.png"/>
</p>
<p> (recall that the client already rebases its <img class="formulaInl" alt="$ts_\mathrm{client}^i$" src="form_16.png"/> to its own <img class="formulaInl" alt="$s_\mathrm{client}^i$" src="form_14.png"/> before sending it over the network.</p>
<p>The key observation is that the exact reference datum on the client and server doesn't matter; all that matters is that the server knows what the client's date is (the client tells the server in its headers when it connects). Then the client specifies measurement packet timestamps relative to the datum. In our case the datum is <img class="formulaInl" alt="$\mathtt{tv\_sec} + 1e^{-6}\times\mathtt{tv\_usec}$" src="form_18.png"/>, where <code>tv_sec</code> and <code>tv_usec</code> are the corresponding members of the <code>struct timeval</code> that <code>gettimeofday</code>(2) fills in.</p>
<p>For this scheme to provide accurate time measurements, the clocks of the client and server must be synchronized to the same reference (and timezone). The precision of the time measurements is then governed by the precision of <code>gettimeofday</code>(2).</p>
<p>This means that the comparison of <code>oml_ts_client</code> from different nodes can be assumed to have the half the precision of the time synchronisation system running on the nodes. Comparing <code>oml_ts_server</code> values should also take into account the network delays from each node to the server. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="oml2-server.html">The oml2-server Collection Point</a></li>
    <li class="footer">Generated on Thu Jun 25 2015 15:31:56 for oml2 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
